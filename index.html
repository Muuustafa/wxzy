<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Python - Licence 2</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
      @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      
      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
        50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
      }
      
      @keyframes slideIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .gradient-bg {
        background: linear-gradient(-45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
      }
      
      .float-animation { animation: float 3s ease-in-out infinite; }
      .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
      .slide-in { animation: slideIn 0.5s ease-out; }
      .code-editor { font-family: 'Fira Code', 'Consolas', 'Monaco', monospace; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ðŸ”¥ CONFIGURATION FIREBASE
        const firebaseConfig = {
          apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
          authDomain: "quiz-python-isikm.firebaseapp.com",
          projectId: "quiz-python-isikm",
          storageBucket: "quiz-python-isikm.firebasestorage.app",
          messagingSenderId: "559369640769",
          appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        // Initialiser Firebase
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // ðŸ” CODE D'ACCÃˆS QUIZ
        const ACCESS_CODE = "QZ2025PYTH";
        const RECOVERY_CODE = "QZ2025PYTH"; // MÃªme code pour la reprise

        // Configuration du quiz - 50 QUESTIONS
        const QUIZ_CONFIG = {
          title: "Quiz Python - Licence 2",
          duration: 3600,
          penaltyPerWarning: 2,
          questions: [
            // Questions Faciles (1-10) - 1 point
            { id: 1, code: `x = int(4.9)\nprint(x)`, question: "Quelle est la sortie ? (conversion float vers int)", options: ["4.9", "4", "5", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 2, code: `texte = "Python"\nprint(len(texte))`, question: "Quelle est la longueur de la chaîne ?", options: ["5", "6", "7", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 3, code: `x = True\nprint(int(x))`, question: "Que retourne int(True) ?", options: ["True", "1", "0", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 4, code: `liste = [10, 20, 30]\nprint(liste[-1])`, question: "Quelle est la sortie ?", options: ["10", "30", "-1", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 5, code: `print(type(3.14))`, question: "Quel est le type de 3.14 ?", options: ["<class 'int'>", "<class 'float'>", "<class 'str'>", "<class 'decimal'>"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 6, code: `x = 10\nprint(x // 3)`, question: "Quelle est la sortie de la division entière ?", options: ["3.33", "3", "4", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 7, code: `liste = [1, 2, 3]\nliste.append(4)\nprint(len(liste))`, question: "Quelle est la longueur finale ?", options: ["3", "4", "5", "7"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 8, code: `x = "hello"\nprint(x.upper())`, question: "Quelle est la sortie ?", options: ["hello", "HELLO", "Hello", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 9, code: `print(10 % 3)`, question: "Que retourne l'opérateur modulo ?", options: ["3", "10", "1", "0"], correct: 2, points: 1, difficulty: "Facile" },
            { id: 10, code: `x = [5, 2, 8, 1]\nprint(max(x))`, question: "Quelle est la sortie ?", options: ["5", "2", "8", "1"], correct: 2, points: 1, difficulty: "Facile" },
            
            // Questions Assez Faciles (11-20) - 1.25 points
            { id: 11, code: `mots = "Python est super".split()\nprint(len(mots))`, question: "Combien de mots dans la liste ?", options: ["1", "2", "3", "4"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
            { id: 12, code: `x = "123"\ny = int(x)\nprint(y + 7)`, question: "Quelle est la sortie ?", options: ["1237", "130", "Erreur", "123+7"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 13, code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, question: "Que retourne le slicing ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3, 4, 5]"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 14, code: `x = "bonjour"\nprint(x[0] + x[-1])`, question: "Quelle est la sortie ?", options: ["br", "jr", "bn", "bonjourr"], correct: 0, points: 1.25, difficulty: "Assez Facile" },
            { id: 15, code: `for i in range(3):\n    print(i, end="")`, question: "Quelle est la sortie complète ?", options: ["123", "012", "0 1 2", "321"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 16, code: `x = 15\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["Pair", "Impair", "True", "False"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 17, code: `x = [1, 2, 3]\nx.extend([4, 5])\nprint(len(x))`, question: "Quelle est la longueur finale ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 18, code: `texte = "  Python  "\nprint(len(texte.strip()))`, question: "Quelle est la longueur après strip() ?", options: ["10", "8", "6", "Erreur"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
            { id: 19, code: `x = [5, 2, 8, 1]\nx.sort()\nprint(x[0])`, question: "Quel est le premier élément après tri ?", options: ["5", "2", "8", "1"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
            { id: 20, code: `print("abc" * 3)`, question: "Quelle est la sortie ?", options: ["abc3", "abcabcabc", "aaa bbb ccc", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            
            // Questions Moyennes (21-30) - 1.5 points
            { id: 21, code: `liste = [1, 2, 3, 2, 1]\nprint(liste.count(2))`, question: "Combien de fois 2 apparaît ?", options: ["1", "2", "3", "5"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 22, code: `x = 5\ny = 2\nprint(x ** y)`, question: "Que retourne l'opérateur ** (puissance) ?", options: ["7", "10", "25", "52"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 23, code: `def somme(a, b):\n    return a + b\nprint(somme(3, 4))`, question: "Quelle est la sortie ?", options: ["34", "7", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 24, code: `texte = "nom,age,ville"\nelements = texte.split(',')\nprint(len(elements))`, question: "Combien d'éléments dans la liste ?", options: ["1", "2", "3", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 25, code: `x = [1, 2, 3]\nx[1] = 10\nprint(x)`, question: "Quelle est la sortie ?", options: ["[1, 10, 3]", "[10, 2, 3]", "[1, 2, 10]", "Erreur"], correct: 0, points: 1.5, difficulty: "Moyen" },
            { id: 26, code: `liste = [1, 2]\ny = [3, 4]\nz = liste + y\nprint(len(z))`, question: "Quelle est la longueur de z ?", options: ["2", "3", "4", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 27, code: `mots = ["a", "b", "c"]\nresultat = "-".join(mots)\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["abc", "a-b-c", "a b c", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 28, code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end=" ")`, question: "Quelle est la sortie ?", options: ["0 1 2 3 4", "0 1 3 4", "0 1 2", "3 4"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 29, code: `x = "abc"\ny = x.replace("b", "X")\nprint(y)`, question: "Quelle est la sortie ?", options: ["abc", "aXc", "Xbc", "abX"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 30, code: `x = 3\ny = 5\nx, y = y, x\nprint(x)`, question: "Que vaut x après l'échange ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            
            // Questions Assez Difficiles (31-40) - 1.75 points
            { id: 31, code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, question: "Quelle est la valeur finale de i ?", options: ["0", "2", "3", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 32, code: `x = 5\nfor i in range(3):\n    x += i\nprint(x)`, question: "Quelle est la valeur finale de x ? (x=5, puis +0, +1, +2)", options: ["5", "6", "8", "11"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 33, code: `x = 10\nwhile x > 0:\n    x -= 3\n    if x == 4:\n        break\nprint(x)`, question: "Quelle est la valeur de x à la sortie ?", options: ["1", "4", "0", "7"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 34, code: `def test(n):\n    if n > 0:\n        return n\n    return 0\nprint(test(-5))`, question: "Quelle est la sortie ?", options: ["-5", "5", "0", "None"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 35, code: `texte = "je suis ingenieur"\nprint(texte.title())`, question: "Quelle est la sortie ?", options: ["je suis ingenieur", "Je Suis Ingenieur", "JE SUIS INGENIEUR", "Je suis ingenieur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 36, code: `liste = [5, 10, 15, 20]\nprint(liste[-2])`, question: "Quelle est la sortie avec l'index négatif ?", options: ["20", "15", "10", "5"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 37, code: `x = [1, 2, 3, 4, 5]\nprint(x[::2])`, question: "Que retourne le slicing avec pas de 2 ?", options: ["[1, 2, 3]", "[1, 3, 5]", "[2, 4]", "[1, 2]"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 38, code: `x = "123"\nprint(x * 2)`, question: "Quelle est la sortie ?", options: ["246", "123123", "6", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 39, code: `nums = [1, 2, 3]\nprint(sum(nums) / len(nums))`, question: "Quelle est la moyenne calculée ?", options: ["1", "2", "2.0", "6"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 40, code: `x = [3, 1, 4, 1, 5]\nx.reverse()\nprint(x[0])`, question: "Quel est le premier élément après reverse() ?", options: ["3", "1", "5", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            
            // Questions Difficiles (41-50) - 2 points
            { id: 41, code: `for i in range(2, 10, 3):\n    print(i, end=" ")`, question: "Quelle est la sortie du range avec pas de 3 ?", options: ["2 5 8", "2 5 8 11", "3 6 9", "2 3 4"], correct: 0, points: 2, difficulty: "Difficile" },
            { id: 42, code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (référence)", options: ["3", "4", "7", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 43, code: `texte = "Python"\nprint(texte[1:4])`, question: "Que retourne ce slicing ?", options: ["Pyt", "yth", "ytho", "Pyth"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 44, code: `x = [1, 2, 3, 4, 5]\nprint(x[::-1])`, question: "Que fait le slicing avec pas -1 ?", options: ["[1, 2, 3, 4, 5]", "[5, 4, 3, 2, 1]", "[2, 4]", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 45, code: `x = "a,b,c"\ny = x.split(',')\nz = "-".join(y)\nprint(z)`, question: "Quelle transformation est effectuée ?", options: ["a,b,c", "a-b-c", "abc", "a b c"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 46, code: `x = 0\nfor i in range(4):\n    if i % 2 == 0:\n        x += i\nprint(x)`, question: "Quelle est la somme des nombres pairs ?", options: ["0", "2", "4", "6"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 47, code: `liste = [5, 2, 8, 1, 9]\nliste.sort()\nprint(liste[2])`, question: "Quel est l'élément du milieu après tri ?", options: ["8", "5", "2", "9"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 48, code: `x = "ingenieur logiciel"\ny = x.replace("logiciel", "civil")\nprint(y)`, question: "Quelle est la chaîne finale ?", options: ["ingenieur logiciel", "ingenieur civil", "civil logiciel", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 49, code: `x = [1, 2, 3]\ny = x[:]\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (copie superficielle)", options: ["3", "4", "7", "Erreur"], correct: 0, points: 2, difficulty: "Difficile" },
            { id: 50, code: `nombres = [10, 20, 30]\nsomme = sum(nombres)\nmoyenne = somme / len(nombres)\nprint(int(moyenne))`, question: "Quelle est la moyenne convertie en entier ?", options: ["10", "15", "20", "60"], correct: 2, points: 2, difficulty: "Difficile" },
          ]
        };

        function PythonQuizApp() {
          const [screen, setScreen] = useState('access');
          const [accessCodeInput, setAccessCodeInput] = useState('');
          const [studentInfo, setStudentInfo] = useState({ nom: '', prenom: '', classe: '' });
          const [currentQuestion, setCurrentQuestion] = useState(0);
          const [answers, setAnswers] = useState({});
          const [timeLeft, setTimeLeft] = useState(QUIZ_CONFIG.duration);
          const [tabSwitches, setTabSwitches] = useState(0);
          const [warnings, setWarnings] = useState([]);
          const [showNotification, setShowNotification] = useState(false);
          const [sessionId, setSessionId] = useState(null);
          const [isBlocked, setIsBlocked] = useState(false);
          const [showDetailedResults, setShowDetailedResults] = useState(false);

          useEffect(() => {
            if (screen === 'quiz' && timeLeft > 0 && !isBlocked) {
              const timer = setInterval(() => {
                setTimeLeft(prev => {
                  if (prev <= 1) {
                    handleSubmitQuiz();
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
              return () => clearInterval(timer);
            }
          }, [screen, timeLeft, isBlocked]);

          useEffect(() => {
            if (screen === 'quiz' && !isBlocked) {
              const handleVisibilityChange = async () => {
                if (document.hidden) {
                  const newCount = tabSwitches + 1;
                  setTabSwitches(newCount);
                  const warning = `Changement d'onglet Ã  ${formatTime(QUIZ_CONFIG.duration - timeLeft)}`;
                  setWarnings(prev => [...prev, warning]);
                  
                  if (sessionId) {
                    await db.collection('quiz_sessions').doc(sessionId).update({
                      tabSwitches: newCount,
                      lastWarning: warning,
                      warnings: firebase.firestore.FieldValue.arrayUnion(warning),
                      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                  }

                  setIsBlocked(true);
                  
                  const { value: code } = await Swal.fire({
                    icon: 'error',
                    title: 'âš ï¸ QUIZ BLOQUÃ‰ !',
                    html: `
                      <p class="mb-4 text-red-600 font-bold">Vous avez changÃ© d'onglet !</p>
                      <p class="mb-4">Le quiz est maintenant bloquÃ©.</p>
                      <p class="mb-4">Demandez le <strong>code de reprise</strong> Ã  votre enseignant.</p>
                      <p class="text-sm text-gray-600">PÃ©nalitÃ© : -${QUIZ_CONFIG.penaltyPerWarning} points</p>
                    `,
                    input: 'password',
                    inputLabel: 'Code de reprise',
                    inputPlaceholder: 'Entrez le code',
                    showCancelButton: false,
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    inputValidator: (value) => {
                      if (!value) {
                        return 'Vous devez entrer le code !';
                      }
                    }
                  });

                  if (code === RECOVERY_CODE) {
                    setIsBlocked(false);
                    Swal.fire({
                      icon: 'success',
                      title: 'Code acceptÃ©',
                      text: 'Vous pouvez continuer le quiz.',
                      timer: 2000,
                      showConfirmButton: false
                    });
                  } else {
                    setIsBlocked(true);
                    Swal.fire({
                      icon: 'error',
                      title: 'Code incorrect !',
                      text: 'Demandez le bon code Ã  votre enseignant.',
                      allowOutsideClick: false
                    }).then(() => {
                      window.location.reload();
                    });
                  }
                }
              };

              document.addEventListener('visibilitychange', handleVisibilityChange);

              return () => {
                document.removeEventListener('visibilitychange', handleVisibilityChange);
              };
            }
          }, [screen, tabSwitches, timeLeft, isBlocked, sessionId]);

          const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          const normalizeString = (str) => {
            return str.toLowerCase().trim().replace(/\s+/g, ' ');
          };

          const checkIfAlreadyTaken = async (nom, prenom, classe) => {
            const normalizedNom = normalizeString(nom);
            const normalizedPrenom = normalizeString(prenom);
            const normalizedClasse = normalizeString(classe);

            try {
              const snapshot = await db.collection('results').get();
              return snapshot.docs.some(doc => {
                const result = doc.data();
                const resultParts = result.etudiant.split(' ');
                const resultPrenom = normalizeString(resultParts[0] || '');
                const resultNom = normalizeString(resultParts.slice(1).join(' ') || '');
                const resultClasse = normalizeString(result.classe);

                return resultNom === normalizedNom && 
                       resultPrenom === normalizedPrenom && 
                       resultClasse === normalizedClasse;
              });
            } catch (error) {
              console.error("Erreur vÃ©rification doublon:", error);
              return false;
            }
          };

          const handleAccessCodeSubmit = () => {
            if (accessCodeInput === ACCESS_CODE) {
              setScreen('start');
              Swal.fire({
                icon: 'success',
                title: 'AccÃ¨s autorisÃ© !',
                text: 'Vous pouvez maintenant commencer le quiz.',
                timer: 2000,
                showConfirmButton: false
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Code incorrect !',
                text: 'Demandez le code d\'accÃ¨s Ã  votre enseignant.',
                confirmButtonColor: '#DC2626'
              });
              setAccessCodeInput('');
            }
          };

          const handleStartQuiz = async () => {
            if (!studentInfo.nom || !studentInfo.prenom || !studentInfo.classe) {
              Swal.fire({
                icon: 'warning',
                title: 'Informations manquantes',
                text: 'Veuillez remplir tous les champs obligatoires.',
                confirmButtonColor: '#4F46E5'
              });
              return;
            }

            const alreadyTaken = await checkIfAlreadyTaken(studentInfo.nom, studentInfo.prenom, studentInfo.classe);
            
            if (alreadyTaken) {
              Swal.fire({
                icon: 'error',
                title: 'Test dÃ©jÃ  effectuÃ© !',
                html: `<p><strong>${studentInfo.prenom} ${studentInfo.nom}</strong> de la classe <strong>${studentInfo.classe}</strong></p><p>Vous avez dÃ©jÃ  passÃ© ce test.</p>`,
                confirmButtonColor: '#DC2626'
              });
              return;
            }

            const result = await Swal.fire({
              icon: 'info',
              title: 'PrÃªt Ã  commencer ?',
              html: `
                <div class="text-left">
                  <p class="mb-2"><strong>Nom :</strong> ${studentInfo.nom}</p>
                  <p class="mb-2"><strong>PrÃ©nom :</strong> ${studentInfo.prenom}</p>
                  <p class="mb-4"><strong>Classe :</strong> ${studentInfo.classe}</p>
                  <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm">
                    <p class="font-semibold text-yellow-800">âš ï¸ Rappels :</p>
                    <ul class="list-disc list-inside mt-2 text-yellow-700">
                      <li>60 minutes - 50 questions</li>
                      <li>NE changez PAS d'onglet !</li>
                      <li>Quiz bloquÃ© si changement</li>
                    </ul>
                  </div>
                </div>
              `,
              showCancelButton: true,
              confirmButtonColor: '#4F46E5',
              confirmButtonText: 'Commencer',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              try {
                const sessionRef = await db.collection('quiz_sessions').add({
                  etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
                  classe: studentInfo.classe,
                  status: 'started',
                  startTime: firebase.firestore.FieldValue.serverTimestamp(),
                  tabSwitches: 0,
                  warnings: [],
                  currentQuestion: 0
                });
                setSessionId(sessionRef.id);
              } catch (error) {
                console.error("Erreur crÃ©ation session:", error);
              }

              setScreen('quiz');
              if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => {});
              }
            }
          };

          const handleAnswer = async (questionId, answerIndex) => {
            setAnswers(prev => ({ ...prev, [questionId]: answerIndex }));
            
            if (sessionId) {
              await db.collection('quiz_sessions').doc(sessionId).update({
                currentQuestion: currentQuestion + 1,
                answeredQuestions: Object.keys(answers).length + 1,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
              });
            }
          };

          const calculateScore = () => {
            let totalPoints = 0;
            let maxPoints = 0;
            
            QUIZ_CONFIG.questions.forEach(q => {
              maxPoints += q.points;
              if (answers[q.id] === q.correct) {
                totalPoints += q.points;
              }
            });

            let noteSur20 = (totalPoints / maxPoints) * 20;
            const penalty = tabSwitches * QUIZ_CONFIG.penaltyPerWarning;
            noteSur20 = Math.max(0, noteSur20 - penalty);

            let correct = 0;
            QUIZ_CONFIG.questions.forEach(q => {
              if (answers[q.id] === q.correct) {
                correct++;
              }
            });

            return {
              correct,
              total: QUIZ_CONFIG.questions.length,
              totalPoints: totalPoints.toFixed(2),
              maxPoints: maxPoints,
              noteSur20: noteSur20.toFixed(2),
              penalty: penalty,
              percentage: ((correct / QUIZ_CONFIG.questions.length) * 100).toFixed(2)
            };
          };

          const handleSubmitQuiz = async () => {
            setScreen('results');
            if (document.exitFullscreen && document.fullscreenElement) {
              document.exitFullscreen();
            }

            const results = calculateScore();
            const exportData = {
              etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
              classe: studentInfo.classe,
              note: results.noteSur20,
              pourcentage: results.percentage,
              correct: results.correct,
              total: results.total,
              points: results.totalPoints,
              maxPoints: results.maxPoints,
              tentativesTriche: tabSwitches,
              penalite: results.penalty,
              dateTest: new Date().toLocaleString('fr-FR'),
              timestamp: firebase.firestore.FieldValue.serverTimestamp(),
              duree: formatTime(QUIZ_CONFIG.duration - timeLeft),
              avertissements: warnings,
              detailsReponses: QUIZ_CONFIG.questions.map(q => ({
                question: q.id,
                reponse: answers[q.id] !== undefined ? answers[q.id] : -1,
                correct: q.correct,
                estCorrecte: answers[q.id] === q.correct,
                points: answers[q.id] === q.correct ? q.points : 0,
                difficulte: q.difficulty
              }))
            };

            try {
              await db.collection('results').add(exportData);
              
              if (sessionId) {
                await db.collection('quiz_sessions').doc(sessionId).update({
                  status: 'completed',
                  endTime: firebase.firestore.FieldValue.serverTimestamp(),
                  finalNote: results.noteSur20
                });
              }
            } catch (error) {
              console.error('Erreur Firebase:', error);
            }

            setTimeout(() => {
              Swal.fire({
                icon: results.noteSur20 >= 10 ? 'success' : 'info',
                title: 'Quiz terminÃ© !',
                text: `Note : ${results.noteSur20}/20`,
                timer: 3000
              });
            }, 500);
          };

          if (screen === 'access') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full">
                  <div className="text-center mb-6">
                    <div className="bg-indigo-100 rounded-full w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center mx-auto mb-4">
                      <svg className="w-8 h-8 sm:w-10 sm:h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                      </svg>
                    </div>
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Quiz Python SÃ©curisÃ©</h1>
                    <p className="text-sm sm:text-base text-gray-600">Entrez le code d'accÃ¨s pour commencer</p>
                  </div>

                  <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 sm:p-4 mb-6">
                    <p className="text-xs sm:text-sm text-yellow-700">
                      <strong>ðŸ” Code requis</strong> : Demandez le code Ã  votre enseignant
                    </p>
                  </div>

                  <div className="space-y-4">
                    <input
                      type="password"
                      value={accessCodeInput}
                      onChange={(e) => setAccessCodeInput(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleAccessCodeSubmit()}
                      className="w-full px-4 py-3 text-center text-lg font-mono border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                      maxLength="10"
                    />
                    <button
                      onClick={handleAccessCodeSubmit}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg"
                    >
                      AccÃ©der au Quiz
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'start') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full">
                  <div className="text-center mb-6">
                    <svg className="w-12 h-12 sm:w-16 sm:h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                    </svg>
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">{QUIZ_CONFIG.title}</h1>
                    <p className="text-sm sm:text-base text-gray-600">50 Questions - 60 minutes</p>
                  </div>

                  <div className="bg-red-50 border-l-4 border-red-400 p-3 sm:p-4 mb-6">
                    <div className="flex">
                      <svg className="h-5 w-5 text-red-400 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                      </svg>
                      <div className="text-xs sm:text-sm text-red-700">
                        <p className="font-semibold mb-2">âš ï¸ ATTENTION :</p>
                        <ul className="list-disc list-inside space-y-1">
                          <li>NE changez PAS d'onglet</li>
                          <li>Quiz BLOQUÃ‰ si changement</li>
                          <li>-2 points par tentative</li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">PrÃ©nom *</label>
                      <input
                        type="text"
                        value={studentInfo.prenom}
                        onChange={(e) => setStudentInfo(prev => ({ ...prev, prenom: e.target.value }))}
                        className="w-full px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        placeholder="Votre prÃ©nom"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
                      <input
                        type="text"
                        value={studentInfo.nom}
                        onChange={(e) => setStudentInfo(prev => ({ ...prev, nom: e.target.value }))}
                        className="w-full px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        placeholder="Votre nom"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Classe *</label>
                      <select
                        value={studentInfo.classe}
                        onChange={(e) => setStudentInfo(prev => ({ ...prev, classe: e.target.value }))}
                        className="w-full px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                      >
                        <option value="">SÃ©lectionnez</option>
                        <option value="L2-IAGE">L2 - IAGE</option>
                        <option value="L2-GL">L2 - GL</option>
                      </select>
                    </div>

                    <button
                      onClick={handleStartQuiz}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg"
                    >
                      Commencer le Quiz
                    </button>

                    <div className="mt-6 pt-4 border-t border-gray-200 text-center">
                      <a 
                        href="admin.html" 
                        className="text-xs text-gray-400 hover:text-indigo-600 transition-colors inline-flex items-center gap-1"
                      >
                        <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        Administration
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            );
          }
          
          if (screen === 'quiz') {
            const question = QUIZ_CONFIG.questions[currentQuestion];
            const progress = ((currentQuestion + 1) / QUIZ_CONFIG.questions.length) * 100;

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-2 sm:p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-lg shadow-lg p-3 sm:p-4 mb-4">
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
                      <div>
                        <h2 className="text-lg sm:text-xl font-bold text-gray-800">{studentInfo.prenom} {studentInfo.nom}</h2>
                        <p className="text-xs sm:text-sm text-gray-600">{studentInfo.classe}</p>
                      </div>
                      <div className="flex items-center gap-2 sm:gap-4">
                        {tabSwitches > 0 && (
                          <div className="flex items-center text-red-600 bg-red-50 px-2 py-1 rounded-full text-xs sm:text-sm">
                            <svg className="w-4 h-4 sm:w-5 sm:h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="font-semibold">{tabSwitches} Ã— (-2pts)</span>
                          </div>
                        )}
                        <div className={`flex items-center ${timeLeft < 60 ? 'text-red-600 animate-pulse' : 'text-indigo-600'}`}>
                          <svg className="w-5 h-5 sm:w-6 sm:h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-xl sm:text-2xl font-bold">{formatTime(timeLeft)}</span>
                        </div>
                      </div>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div className="bg-indigo-600 h-2 rounded-full transition-all" style={{ width: `${progress}%` }} />
                    </div>
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mt-2">
                      <p className="text-xs sm:text-sm text-gray-600">Question {currentQuestion + 1}/{QUIZ_CONFIG.questions.length}</p>
                      <p className="text-xs sm:text-sm font-semibold text-indigo-600">{question.points} pt - {question.difficulty}</p>
                    </div>
                  </div>

                  <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                    <h3 className="text-base sm:text-lg font-semibold text-gray-800 mb-4">{question.question}</h3>
                    <div className="bg-gray-900 text-green-400 p-3 sm:p-4 rounded-lg font-mono text-xs sm:text-sm overflow-x-auto mb-6">
                      <pre>{question.code}</pre>
                    </div>

                    <div className="space-y-2 sm:space-y-3">
                      {question.options.map((option, index) => (
                        <button
                          key={index}
                          onClick={() => handleAnswer(question.id, index)}
                          className={`w-full text-left p-3 sm:p-4 rounded-lg border-2 transition-all ${
                            answers[question.id] === index ? 'border-indigo-600 bg-indigo-50' : 'border-gray-200 hover:border-indigo-300'
                          }`}
                        >
                          <span className="font-semibold text-gray-700">{String.fromCharCode(65 + index)}.</span>{' '}
                          <span className="text-sm sm:text-base text-gray-800 font-mono">{option}</span>
                        </button>
                      ))}
                    </div>

                    <div className="flex justify-between mt-6">
                      <button
                        onClick={() => setCurrentQuestion(prev => Math.max(0, prev - 1))}
                        disabled={currentQuestion === 0}
                        className="px-4 sm:px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 disabled:opacity-50 text-sm sm:text-base"
                      >
                        PrÃ©cÃ©dent
                      </button>

                      {currentQuestion < QUIZ_CONFIG.questions.length - 1 ? (
                        <button
                          onClick={() => setCurrentQuestion(prev => prev + 1)}
                          className="px-4 sm:px-6 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 text-sm sm:text-base"
                        >
                          Suivant
                        </button>
                      ) : (
                        <button
                          onClick={handleSubmitQuiz}
                          className="px-4 sm:px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 text-sm sm:text-base"
                        >
                          Terminer
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'results') {
            const score = calculateScore();
            const correctQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] === q.correct);
            const incorrectQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] !== q.correct && answers[q.id] !== undefined);
            const unansweredQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] === undefined);

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 mb-6">
                    <div className="text-center mb-6 sm:mb-8">
                      {score.noteSur20 >= 10 ? (
                        <svg className="w-16 h-16 sm:w-20 sm:h-20 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      ) : (
                        <svg className="w-16 h-16 sm:w-20 sm:h-20 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      )}
                      <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Quiz TerminÃ© !</h1>
                      <p className="text-sm sm:text-base text-gray-600">{studentInfo.prenom} {studentInfo.nom} - {studentInfo.classe}</p>
                    </div>

                    <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6 mb-6">
                      <div className="text-center">
                        <p className="text-sm opacity-90 mb-2">Note Finale</p>
                        <p className="text-5xl sm:text-6xl font-bold mb-2">{score.noteSur20}/20</p>
                        <p className="text-sm opacity-90">{score.correct} bonnes rÃ©ponses sur {score.total}</p>
                        {score.penalty > 0 && (
                          <p className="text-sm mt-2 bg-red-500 bg-opacity-30 py-2 px-4 rounded">
                            PÃ©nalitÃ© : -{score.penalty} points
                          </p>
                        )}
                      </div>
                    </div>

                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
                      <div className="bg-green-50 p-4 rounded-lg">
                        <p className="text-xs sm:text-sm text-gray-600">Correctes</p>
                        <p className="text-xl sm:text-2xl font-bold text-green-600">{correctQuestions.length}</p>
                      </div>
                      <div className="bg-red-50 p-4 rounded-lg">
                        <p className="text-xs sm:text-sm text-gray-600">Incorrectes</p>
                        <p className="text-xl sm:text-2xl font-bold text-red-600">{incorrectQuestions.length}</p>
                      </div>
                      <div className="bg-gray-50 p-4 rounded-lg">
                        <p className="text-xs sm:text-sm text-gray-600">Non rÃ©pondues</p>
                        <p className="text-xl sm:text-2xl font-bold text-gray-600">{unansweredQuestions.length}</p>
                      </div>
                      <div className="bg-blue-50 p-4 rounded-lg">
                        <p className="text-xs sm:text-sm text-gray-600">Points</p>
                        <p className="text-xl sm:text-2xl font-bold text-blue-600">{score.totalPoints}/{score.maxPoints}</p>
                      </div>
                    </div>

                    <button
                      onClick={() => setShowDetailedResults(!showDetailedResults)}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors mb-4 flex items-center justify-center gap-2"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                      {showDetailedResults ? 'Masquer' : 'Voir'} les dÃ©tails des rÃ©ponses
                    </button>

                    <button
                      onClick={() => window.location.reload()}
                      className="w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
                    >
                      Retour Ã  l'accueil
                    </button>
                  </div>

                  {showDetailedResults && (
                    <div className="space-y-4">
                      {/* Questions correctes */}
                      {correctQuestions.length > 0 && (
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                          <h3 className="text-lg sm:text-xl font-bold text-green-600 mb-4 flex items-center gap-2">
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            RÃ©ponses Correctes ({correctQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {correctQuestions.map((q) => (
                              <div key={q.id} className="border-l-4 border-green-500 bg-green-50 p-3 sm:p-4 rounded">
                                <div className="flex justify-between items-start mb-2">
                                  <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                  <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">{q.points} pts</span>
                                </div>
                                <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                  <pre>{q.code}</pre>
                                </div>
                                <div className="flex items-center gap-2 text-green-700 text-sm">
                                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                  </svg>
                                  <span className="font-semibold">{q.options[q.correct]}</span>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* Questions incorrectes */}
                      {incorrectQuestions.length > 0 && (
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                          <h3 className="text-lg sm:text-xl font-bold text-red-600 mb-4 flex items-center gap-2">
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            RÃ©ponses Incorrectes ({incorrectQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {incorrectQuestions.map((q) => (
                              <div key={q.id} className="border-l-4 border-red-500 bg-red-50 p-3 sm:p-4 rounded">
                                <div className="flex justify-between items-start mb-2">
                                  <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                  <span className="text-xs bg-red-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                </div>
                                <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                  <pre>{q.code}</pre>
                                </div>
                                <div className="space-y-2">
                                  <div className="flex items-center gap-2 text-red-700 text-sm">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                    <div>
                                      <span className="font-semibold">Votre rÃ©ponse : </span>
                                      <span>{q.options[answers[q.id]]}</span>
                                    </div>
                                  </div>
                                  <div className="flex items-center gap-2 text-green-700 text-sm">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                    </svg>
                                    <div>
                                      <span className="font-semibold">Bonne rÃ©ponse : </span>
                                      <span>{q.options[q.correct]}</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* Questions non rÃ©pondues */}
                      {unansweredQuestions.length > 0 && (
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                          <h3 className="text-lg sm:text-xl font-bold text-gray-600 mb-4 flex items-center gap-2">
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Questions Non RÃ©pondues ({unansweredQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {unansweredQuestions.map((q) => (
                              <div key={q.id} className="border-l-4 border-gray-400 bg-gray-50 p-3 sm:p-4 rounded">
                                <div className="flex justify-between items-start mb-2">
                                  <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                  <span className="text-xs bg-gray-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                </div>
                                <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                  <pre>{q.code}</pre>
                                </div>
                                <div className="flex items-center gap-2 text-green-700 text-sm">
                                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                  </svg>
                                  <div>
                                    <span className="font-semibold">Bonne rÃ©ponse : </span>
                                    <span>{q.options[q.correct]}</span>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </div>
            );
          }

          return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PythonQuizApp />);
    </script>
</body>
</html>
