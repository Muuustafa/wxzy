<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Python - ISI Keur Massar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .gradient-bg {
      background: linear-gradient(-45deg, #1e3a8a, #3b82f6, #06b6d4, #8b5cf6);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }
    .code-block {
      background: #1e293b;
      color: #10b981;
      font-family: 'Courier New', monospace;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      font-size: 0.875rem;
    }
    .pulse-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCcWSHWLTFPE3ixU6PBNL3jGmcbI4FoMuo",
      authDomain: "quizpython-8d65a.firebaseapp.com",
      databaseURL: "https://quizpython-8d65a-default-rtdb.firebaseio.com",
      projectId: "quizpython-8d65a",
      storageBucket: "quizpython-8d65a.firebasestorage.app",
      messagingSenderId: "297624690086",
      appId: "1:297624690086:web:3ecae0b3da6ad3aa2e906e"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    // Configuration du Quiz - 50 QUESTIONS basées sur les cours
    const QUIZ_CONFIG = {
      tempsTotal: 40 * 60, // 40 minutes en secondes
      questions: [
        // NIVEAU FACILE (1 point) - Questions 1-10
        { 
          id: 1, 
          code: `x = 10\ny = 20\nprint(x + y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1020", "30", "Erreur", "xy"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Variables"
        },
        { 
          id: 2, 
          code: `nom = "Python"\nprint(type(nom))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["<class 'int'>", "<class 'str'>", "str", "string"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Types"
        },
        { 
          id: 3, 
          code: `liste = [1, 2, 3, 4, 5]\nprint(len(liste))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["4", "5", "15", "Erreur"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Listes"
        },
        { 
          id: 4, 
          code: `x = 15\nprint(x % 4)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3", "3.75", "4", "0"], 
          correct: 0, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Opérateurs"
        },
        { 
          id: 5, 
          code: `texte = "PYTHON"\nprint(texte.lower())`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["PYTHON", "python", "Python", "pYTHON"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Méthodes string"
        },
        { 
          id: 6, 
          code: `x = 7\nif x > 5:\n    print("Oui")`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Oui", "Non", "7", "Rien"], 
          correct: 0, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 2 - if"
        },
        { 
          id: 7, 
          code: `print(10 - 7)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["17", "3", "10", "-7"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Opérations"
        },
        { 
          id: 8, 
          code: `x = True\nprint(x)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1", "True", "true", "Vrai"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Booléens"
        },
        { 
          id: 9, 
          code: `liste = [10, 20, 30]\nprint(liste[0])`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["0", "10", "20", "[10]"], 
          correct: 1, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Indexation"
        },
        { 
          id: 10, 
          code: `x = 3\ny = 4\nprint(x * y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["34", "7", "12", "Erreur"], 
          correct: 2, 
          points: 1, 
          difficulty: "Facile",
          chapitre: "Chapitre 1 - Multiplication"
        },

        // NIVEAU ASSEZ FACILE (1.25 points) - Questions 11-20
        { 
          id: 11, 
          code: `for i in range(3):\n    print(i, end=" ")`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1 2 3", "0 1 2", "0 1 2 3", "1 2"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 2 - Boucle for"
        },
        { 
          id: 12, 
          code: `x = "Hello"\ny = "World"\nprint(x + " " + y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["HelloWorld", "Hello World", "Hello+World", "Erreur"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Concaténation"
        },
        { 
          id: 13, 
          code: `liste = [5, 2, 8, 1]\nliste.sort()\nprint(liste)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["[5, 2, 8, 1]", "[1, 2, 5, 8]", "[8, 5, 2, 1]", "Erreur"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Méthode sort"
        },
        { 
          id: 14, 
          code: `x = 17\nprint(x // 5)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3.4", "3", "4", "2"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Division entière"
        },
        { 
          id: 15, 
          code: `x = 10\nif x > 20:\n    print("A")\nelse:\n    print("B")`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["A", "B", "AB", "Rien"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 2 - if/else"
        },
        { 
          id: 16, 
          code: `texte = "python"\nprint(texte.upper())`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["python", "PYTHON", "Python", "pYTHON"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Méthode upper"
        },
        { 
          id: 17, 
          code: `x = [1, 2, 3]\nx.append(4)\nprint(len(x))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3", "4", "7", "Erreur"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Méthode append"
        },
        { 
          id: 18, 
          code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["0", "2", "3", "4"], 
          correct: 2, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 2 - Boucle while"
        },
        { 
          id: 19, 
          code: `x = 5 < 10\nprint(x)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["False", "True", "5", "10"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 2 - Comparaison"
        },
        { 
          id: 20, 
          code: `texte = "Bonjour"\nprint(len(texte))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["6", "7", "8", "Erreur"], 
          correct: 1, 
          points: 1.25, 
          difficulty: "Assez Facile",
          chapitre: "Chapitre 1 - Fonction len"
        },

        // NIVEAU MOYEN (1.5 points) - Questions 21-30
        { 
          id: 21, 
          code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3]"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Slicing"
        },
        { 
          id: 22, 
          code: `phrase = "apprendre python"\nmots = phrase.split()\nprint(len(mots))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1", "2", "16", "Erreur"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Méthode split"
        },
        { 
          id: 23, 
          code: `x = 5\ny = 2\nprint(x ** y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["7", "10", "25", "52"], 
          correct: 2, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Puissance"
        },
        { 
          id: 24, 
          code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end="")`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["01234", "0134", "234", "012"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 2 - continue"
        },
        { 
          id: 25, 
          code: `liste = [10, 20, 30]\nliste.insert(1, 15)\nprint(liste)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["[15, 10, 20, 30]", "[10, 15, 20, 30]", "[10, 20, 15, 30]", "Erreur"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Méthode insert"
        },
        { 
          id: 26, 
          code: `x = 12\nif x > 5 and x < 15:\n    print("Vrai")\nelse:\n    print("Faux")`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Vrai", "Faux", "True", "12"], 
          correct: 0, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 2 - Opérateur and"
        },
        { 
          id: 27, 
          code: `texte = "ISI"\nprint(texte * 2)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["ISI ISI", "ISIISI", "Erreur", "2ISI"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Répétition string"
        },
        { 
          id: 28, 
          code: `liste = [1, 2, 3]\nliste.reverse()\nprint(liste)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["[1, 2, 3]", "[3, 2, 1]", "None", "Erreur"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Méthode reverse"
        },
        { 
          id: 29, 
          code: `def calculer(a, b):\n    return a + b\nprint(calculer(5, 3))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["53", "8", "None", "Erreur"], 
          correct: 1, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 1 - Fonctions"
        },
        { 
          id: 30, 
          code: `x = 8\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Pair", "Impair", "8", "True"], 
          correct: 0, 
          points: 1.5, 
          difficulty: "Moyen",
          chapitre: "Chapitre 2 - Opérateur ternaire"
        },

        // NIVEAU ASSEZ DIFFICILE (1.75 points) - Questions 31-40
        { 
          id: 31, 
          code: `liste = [1, 2, 3]\nliste.extend([4, 5])\nprint(len(liste))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3", "4", "5", "2"], 
          correct: 2, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Méthode extend"
        },
        { 
          id: 32, 
          code: `x = "42"\ny = int(x) + 8\nprint(y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["428", "50", "Erreur", "42"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Conversion int"
        },
        { 
          id: 33, 
          code: `somme = 0\nfor i in range(1, 4):\n    somme += i\nprint(somme)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["4", "6", "10", "0"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 2 - Boucle accumulateur"
        },
        { 
          id: 34, 
          code: `phrase = "a,b,c,d"\nelements = phrase.split(',')\nprint(len(elements))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1", "3", "4", "7"], 
          correct: 2, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Split avec séparateur"
        },
        { 
          id: 35, 
          code: `x = 10\nwhile x > 5:\n    x -= 2\n    if x == 6:\n        break\nprint(x)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["5", "6", "4", "8"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 2 - break"
        },
        { 
          id: 36, 
          code: `def test(n):\n    if n > 10:\n        return "Grand"\n    return "Petit"\nprint(test(5))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Grand", "Petit", "5", "None"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Return conditionnel"
        },
        { 
          id: 37, 
          code: `mots = ["bon", "jour"]\nphrase = " ".join(mots)\nprint(phrase)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["bonjour", "bon jour", "['bon', 'jour']", "Erreur"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Méthode join"
        },
        { 
          id: 38, 
          code: `x = "Python"\ny = x.replace("th", "TH")\nprint(y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Python", "PyTHon", "python", "PYTHON"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Méthode replace"
        },
        { 
          id: 39, 
          code: `liste = [5, 2, 8, 1, 9]\nprint(max(liste) - min(liste))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["4", "7", "8", "10"], 
          correct: 2, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Fonctions min/max"
        },
        { 
          id: 40, 
          code: `x = 3\ny = 5\nx, y = y, x\nprint(x, y)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3 5", "5 3", "8 8", "Erreur"], 
          correct: 1, 
          points: 1.75, 
          difficulty: "Assez Difficile",
          chapitre: "Chapitre 1 - Swap de variables"
        },

        // NIVEAU DIFFICILE/TRÈS DIFFICILE (2 points) - Questions 41-50
        { 
          id: 41, 
          code: `texte = "Python"\nprint(texte[::-1])`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["Python", "nohtyP", "Pyth", "thon"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Slicing inverse"
        },
        { 
          id: 42, 
          code: `def factorielle(n):\n    if n <= 1:\n        return 1\n    return n * factorielle(n - 1)\nprint(factorielle(4))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["4", "10", "24", "Erreur"], 
          correct: 2, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Récursion"
        },
        { 
          id: 43, 
          code: `nombres = [1, 2, 3, 4, 5]\nresultat = [x * 2 for x in nombres if x % 2 == 0]\nprint(resultat)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["[2, 4, 6, 8, 10]", "[4, 8]", "[2, 4]", "[1, 2, 3, 4, 5]"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - List comprehension"
        },
        { 
          id: 44, 
          code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, 
          question: "Quelle est la sortie ? (Attention au piège!)", 
          options: ["3", "4", "7", "Erreur"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Référence vs copie"
        },
        { 
          id: 45, 
          code: `def fonction(a, b=5, c=10):\n    return a + b + c\nprint(fonction(2, c=3))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["10", "15", "20", "Erreur"], 
          correct: 0, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Arguments nommés"
        },
        { 
          id: 46, 
          code: `matrice = [[1, 2], [3, 4]]\nprint(matrice[1][0])`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["1", "2", "3", "4"], 
          correct: 2, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Liste de listes"
        },
        { 
          id: 47, 
          code: `compteur = 0\nfor i in range(10):\n    if i % 3 == 0:\n        compteur += 1\nprint(compteur)`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3", "4", "5", "10"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 2 - Compteur conditionnel"
        },
        { 
          id: 48, 
          code: `def modifier(liste):\n    liste.append(100)\n\nma_liste = [1, 2, 3]\nmodifier(ma_liste)\nprint(len(ma_liste))`, 
          question: "Quelle est la sortie de ce code ?", 
          options: ["3", "4", "100", "Erreur"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "Chapitre 1 - Passage par référence"
        },
        { 
          id: 49, 
          code: `nombres = [3, 1, 4, 1, 5, 9, 2]\nprint(sum(nombres) / len(nombres))`, 
          question: "Quelle est la sortie de ce code (arrondie) ?", 
          options: ["3.5", "3.57", "4.0", "25"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "TP1 - Moyenne"
        },
        { 
          id: 50, 
          code: `liste = [5, 2, 8, 1, 9]\nliste_triee = sorted(liste)\nprint(liste_triee[len(liste_triee)//2])`, 
          question: "Quelle est la sortie de ce code (médiane) ?", 
          options: ["2", "5", "8", "9"], 
          correct: 1, 
          points: 2, 
          difficulty: "Très Difficile",
          chapitre: "TP1 - Médiane"
        }
      ]
    };

    function QuizApp() {
      const [etape, setEtape] = useState('accueil');
      const [nom, setNom] = useState('');
      const [prenom, setPrenom] = useState('');
      const [classe, setClasse] = useState('');
      const [tempsRestant, setTempsRestant] = useState(QUIZ_CONFIG.tempsTotal);
      const [questionActuelle, setQuestionActuelle] = useState(0);
      const [reponses, setReponses] = useState({});
      const [score, setScore] = useState(0);
      const [showResults, setShowResults] = useState(false);
      const [detailsReponses, setDetailsReponses] = useState([]);
      const [showDetailedAnswers, setShowDetailedAnswers] = useState(false);
      const [sessionId, setSessionId] = useState(null);
      const timerRef = useRef(null);

      useEffect(() => {
        if (etape === 'quiz' && tempsRestant > 0) {
          timerRef.current = setInterval(() => {
            setTempsRestant(prev => {
              if (prev <= 1) {
                clearInterval(timerRef.current);
                terminerQuiz();
                return 0;
              }
              return prev - 1;
            });
          }, 1000);

          return () => clearInterval(timerRef.current);
        }
      }, [etape, tempsRestant]);

      const formatTemps = (secondes) => {
        const mins = Math.floor(secondes / 60);
        const secs = secondes % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const demarrerQuiz = () => {
        if (!nom.trim() || !prenom.trim() || !classe.trim()) {
          alert("Veuillez remplir tous les champs !");
          return;
        }

        const newSessionId = `${nom}_${prenom}_${Date.now()}`;
        setSessionId(newSessionId);

        database.ref(`sessions/${newSessionId}`).set({
          nom,
          prenom,
          classe,
          dateDebut: new Date().toISOString(),
          statut: 'en_cours'
        });

        setEtape('quiz');
      };

      const selectionnerReponse = (indexReponse) => {
        setReponses({
          ...reponses,
          [questionActuelle]: indexReponse
        });
      };

      const questionSuivante = () => {
        if (questionActuelle < QUIZ_CONFIG.questions.length - 1) {
          setQuestionActuelle(questionActuelle + 1);
        }
      };

      const questionPrecedente = () => {
        if (questionActuelle > 0) {
          setQuestionActuelle(questionActuelle - 1);
        }
      };

      const terminerQuiz = () => {
        clearInterval(timerRef.current);
        
        let scoreTotal = 0;
        const details = QUIZ_CONFIG.questions.map(q => {
          const reponseEtudiant = reponses[QUIZ_CONFIG.questions.indexOf(q)] ?? -1;
          const estCorrecte = reponseEtudiant === q.correct;
          if (estCorrecte) scoreTotal += q.points;
          
          return {
            question: q.id,
            reponse: reponseEtudiant,
            estCorrecte: estCorrecte,
            pointsObtenus: estCorrecte ? q.points : 0
          };
        });

        setScore(scoreTotal);
        setDetailsReponses(details);
        setShowResults(true);
        setEtape('resultats');

        if (sessionId) {
          database.ref(`resultats/${sessionId}`).set({
            nom,
            prenom,
            classe,
            score: scoreTotal,
            scoreMax: 75,
            pourcentage: ((scoreTotal / 75) * 100).toFixed(2),
            nombreReponses: Object.keys(reponses).length,
            detailsReponses: details,
            dateFin: new Date().toISOString(),
            tempsUtilise: QUIZ_CONFIG.tempsTotal - tempsRestant
          });

          database.ref(`sessions/${sessionId}`).update({
            statut: 'termine',
            dateFin: new Date().toISOString()
          });
        }
      };

      if (etape === 'accueil') {
        return (
          <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-8 md:p-12">
              {/* Header avec logos */}
              <div className="flex justify-between items-center mb-8">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center">
                    <i className="fas fa-graduation-cap text-white text-2xl"></i>
                  </div>
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">Quiz Python</h1>
                    <p className="text-gray-600">Chapitres 1 & 2</p>
                  </div>
                </div>
                <div className="w-16 h-16 bg-yellow-400 rounded-full flex items-center justify-center">
                  <i className="fab fa-python text-blue-600 text-3xl"></i>
                </div>
              </div>

              {/* Conseils et instructions */}
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-8">
                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <i className="fas fa-lightbulb text-yellow-500"></i>
                  Conseils Importants
                </h2>
                <div className="grid md:grid-cols-2 gap-4 text-sm">
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Lisez attentivement</strong> chaque question et le code associé</p>
                  </div>
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Analysez le code</strong> ligne par ligne avant de répondre</p>
                  </div>
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Gérez votre temps</strong> : 40 minutes pour 50 questions</p>
                  </div>
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Ne paniquez pas</strong> face aux questions difficiles</p>
                  </div>
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Révisez vos réponses</strong> avant de terminer</p>
                  </div>
                  <div className="flex items-start gap-3">
                    <i className="fas fa-check-circle text-green-500 mt-1"></i>
                    <p><strong>Testez mentalement</strong> le code si nécessaire</p>
                  </div>
                </div>
              </div>

              {/* Informations du quiz */}
              <div className="bg-gray-50 rounded-xl p-6 mb-8">
                <div className="grid md:grid-cols-3 gap-4 text-center">
                  <div className="bg-white p-4 rounded-lg shadow">
                    <i className="fas fa-question-circle text-blue-600 text-3xl mb-2"></i>
                    <p className="text-2xl font-bold text-gray-800">50</p>
                    <p className="text-sm text-gray-600">Questions</p>
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <i className="fas fa-clock text-purple-600 text-3xl mb-2"></i>
                    <p className="text-2xl font-bold text-gray-800">40 min</p>
                    <p className="text-sm text-gray-600">Temps total</p>
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <i className="fas fa-star text-yellow-500 text-3xl mb-2"></i>
                    <p className="text-2xl font-bold text-gray-800">75 pts</p>
                    <p className="text-sm text-gray-600">Score max</p>
                  </div>
                </div>
              </div>

              {/* Formulaire */}
              <div className="space-y-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    <i className="fas fa-user mr-2"></i>Nom
                  </label>
                  <input
                    type="text"
                    value={nom}
                    onChange={(e) => setNom(e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    placeholder="Entrez votre nom"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    <i className="fas fa-user mr-2"></i>Prénom
                  </label>
                  <input
                    type="text"
                    value={prenom}
                    onChange={(e) => setPrenom(e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    placeholder="Entrez votre prénom"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    <i className="fas fa-school mr-2"></i>Classe
                  </label>
                  <select
                    value={classe}
                    onChange={(e) => setClasse(e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                  >
                    <option value="">Sélectionnez votre classe</option>
                    <option value="L2 GL">L2 GL</option>
                    <option value="L2 IAGE">L2 IAGE</option>
                    <option value="L2 SR">L2 RI</option>
                    <option value="L2 IA">L2 CS</option>
                  </select>
                </div>
              </div>

              <button
                onClick={demarrerQuiz}
                className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition transform hover:scale-105 shadow-lg"
              >
                <i className="fas fa-rocket mr-2"></i>
                Commencer le Quiz
              </button>
            </div>
          </div>
        );
      }

      if (etape === 'quiz') {
        const question = QUIZ_CONFIG.questions[questionActuelle];
        const progression = ((questionActuelle + 1) / QUIZ_CONFIG.questions.length) * 100;

        return (
          <div className="min-h-screen bg-gray-50 py-8 px-4">
            <div className="max-w-4xl mx-auto">
              {/* Header */}
              <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <div className="flex items-center gap-4">
                    <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center">
                      <i className="fas fa-user text-white"></i>
                    </div>
                    <div>
                      <p className="font-bold text-gray-800">{prenom} {nom}</p>
                      <p className="text-sm text-gray-600">{classe}</p>
                    </div>
                  </div>
                  <div className={`text-2xl font-bold ${tempsRestant < 300 ? 'text-red-600 pulse-animation' : 'text-blue-600'}`}>
                    <i className="far fa-clock mr-2"></i>
                    {formatTemps(tempsRestant)}
                  </div>
                </div>

                {/* Barre de progression */}
                <div className="mb-2">
                  <div className="flex justify-between text-sm text-gray-600 mb-1">
                    <span>Question {questionActuelle + 1} / {QUIZ_CONFIG.questions.length}</span>
                    <span>{progression.toFixed(0)}%</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div
                      className="bg-gradient-to-r from-blue-600 to-purple-600 h-3 rounded-full transition-all duration-300"
                      style={{ width: `${progression}%` }}
                    ></div>
                  </div>
                </div>
              </div>

              {/* Question */}
              <div className="bg-white rounded-xl shadow-lg p-6 md:p-8">
                <div className="flex items-center gap-3 mb-4">
                  <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">
                    {question.difficulty}
                  </span>
                  <span className="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">
                    {question.points} point{question.points > 1 ? 's' : ''}
                  </span>
                </div>

                <p className="text-sm text-gray-600 mb-4">
                  <i className="fas fa-book mr-2"></i>{question.chapitre}
                </p>

                <div className="code-block mb-6">
                  <pre>{question.code}</pre>
                </div>

                <h3 className="text-xl font-bold text-gray-800 mb-6">{question.question}</h3>

                <div className="space-y-3">
                  {question.options.map((option, index) => (
                    <button
                      key={index}
                      onClick={() => selectionnerReponse(index)}
                      className={`w-full p-4 rounded-lg border-2 text-left transition transform hover:scale-102 ${
                        reponses[questionActuelle] === index
                          ? 'border-blue-600 bg-blue-50'
                          : 'border-gray-300 hover:border-blue-400'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                          reponses[questionActuelle] === index
                            ? 'border-blue-600 bg-blue-600'
                            : 'border-gray-400'
                        }`}>
                          {reponses[questionActuelle] === index && (
                            <i className="fas fa-check text-white text-xs"></i>
                          )}
                        </div>
                        <span className="font-semibold text-gray-700">{String.fromCharCode(65 + index)}.</span>
                        <span className="text-gray-800">{option}</span>
                      </div>
                    </button>
                  ))}
                </div>

                {/* Navigation */}
                <div className="flex gap-4 mt-8">
                  <button
                    onClick={questionPrecedente}
                    disabled={questionActuelle === 0}
                    className="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition"
                  >
                    <i className="fas fa-arrow-left mr-2"></i>
                    Précédent
                  </button>

                  {questionActuelle < QUIZ_CONFIG.questions.length - 1 ? (
                    <button
                      onClick={questionSuivante}
                      className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition"
                    >
                      Suivant
                      <i className="fas fa-arrow-right ml-2"></i>
                    </button>
                  ) : (
                    <button
                      onClick={terminerQuiz}
                      className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition"
                    >
                      <i className="fas fa-check-circle mr-2"></i>
                      Terminer
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (etape === 'resultats') {
        const pourcentage = ((score / 75) * 100).toFixed(2);
        const correctes = detailsReponses.filter(d => d.estCorrecte).length;
        const incorrectes = detailsReponses.filter(d => !d.estCorrecte && d.reponse !== -1).length;
        const nonRepondues = detailsReponses.filter(d => d.reponse === -1).length;

        return (
          <div className="min-h-screen bg-gray-50 py-8 px-4">
            <div className="max-w-4xl mx-auto">
              {/* Résultats principaux */}
              <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                <div className="text-center mb-8">
                  <div className="w-24 h-24 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i className="fas fa-trophy text-white text-4xl"></i>
                  </div>
                  <h2 className="text-3xl font-bold text-gray-800 mb-2">Quiz Terminé !</h2>
                  <p className="text-gray-600">{prenom} {nom} - {classe}</p>
                </div>

                <div className="grid md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-blue-50 p-6 rounded-lg text-center">
                    <p className="text-5xl font-bold text-blue-600 mb-2">{score.toFixed(2)}</p>
                    <p className="text-gray-600">sur 75 points</p>
                  </div>
                  <div className="bg-purple-50 p-6 rounded-lg text-center">
                    <p className="text-5xl font-bold text-purple-600 mb-2">{pourcentage}%</p>
                    <p className="text-gray-600">Score final</p>
                  </div>
                </div>

                <div className="grid grid-cols-3 gap-4 mb-6">
                  <div className="bg-green-50 p-4 rounded-lg text-center">
                    <i className="fas fa-check-circle text-green-600 text-2xl mb-2"></i>
                    <p className="text-2xl font-bold text-green-600">{correctes}</p>
                    <p className="text-sm text-gray-600">Correctes</p>
                  </div>
                  <div className="bg-red-50 p-4 rounded-lg text-center">
                    <i className="fas fa-times-circle text-red-600 text-2xl mb-2"></i>
                    <p className="text-2xl font-bold text-red-600">{incorrectes}</p>
                    <p className="text-sm text-gray-600">Incorrectes</p>
                  </div>
                  <div className="bg-gray-50 p-4 rounded-lg text-center">
                    <i className="fas fa-question-circle text-gray-600 text-2xl mb-2"></i>
                    <p className="text-2xl font-bold text-gray-600">{nonRepondues}</p>
                    <p className="text-sm text-gray-600">Non répondues</p>
                  </div>
                </div>

                <button
                  onClick={() => setShowDetailedAnswers(!showDetailedAnswers)}
                  className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition mb-4"
                >
                  <i className={`fas fa-eye${showDetailedAnswers ? '-slash' : ''} mr-2`}></i>
                  {showDetailedAnswers ? 'Masquer' : 'Voir'} les détails des réponses
                </button>
              </div>

              {/* Détails des réponses */}
              {showDetailedAnswers && (
                <div className="space-y-6">
                  {/* Réponses correctes */}
                  {correctes > 0 && (
                    <div className="bg-green-50 rounded-xl p-6 border-2 border-green-200">
                      <h3 className="text-xl font-bold text-green-600 mb-4 flex items-center gap-2">
                        <i className="fas fa-check-circle"></i>
                        Réponses Correctes ({correctes})
                      </h3>
                      <div className="space-y-4">
                        {detailsReponses.filter(d => d.estCorrecte).map((detail) => {
                          const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                          return (
                            <div key={detail.question} className="bg-white border-l-4 border-green-500 p-4 rounded">
                              <div className="flex justify-between items-start mb-2">
                                <p className="font-semibold text-gray-800">Question {q.id}</p>
                                <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">{q.points} pts</span>
                              </div>
                              <p className="text-sm text-gray-700 mb-2">{q.question}</p>
                              <div className="code-block mb-2">
                                <pre className="text-xs">{q.code}</pre>
                              </div>
                              <div className="flex items-center gap-2 text-green-700 text-sm">
                                <i className="fas fa-check"></i>
                                <span className="font-semibold">{q.options[q.correct]}</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {/* Réponses incorrectes */}
                  {incorrectes > 0 && (
                    <div className="bg-red-50 rounded-xl p-6 border-2 border-red-200">
                      <h3 className="text-xl font-bold text-red-600 mb-4 flex items-center gap-2">
                        <i className="fas fa-times-circle"></i>
                        Réponses Incorrectes ({incorrectes})
                      </h3>
                      <div className="space-y-4">
                        {detailsReponses.filter(d => !d.estCorrecte && d.reponse !== -1).map((detail) => {
                          const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                          return (
                            <div key={detail.question} className="bg-white border-l-4 border-red-500 p-4 rounded">
                              <div className="flex justify-between items-start mb-2">
                                <p className="font-semibold text-gray-800">Question {q.id}</p>
                                <span className="text-xs bg-red-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                              </div>
                              <p className="text-sm text-gray-700 mb-2">{q.question}</p>
                              <div className="code-block mb-2">
                                <pre className="text-xs">{q.code}</pre>
                              </div>
                              <div className="space-y-2">
                                <div className="flex items-center gap-2 text-red-700 text-sm">
                                  <i className="fas fa-times"></i>
                                  <div>
                                    <span className="font-semibold">Votre réponse : </span>
                                    <span>{q.options[detail.reponse]}</span>
                                  </div>
                                </div>
                                <div className="flex items-center gap-2 text-green-700 text-sm">
                                  <i className="fas fa-check"></i>
                                  <div>
                                    <span className="font-semibold">Bonne réponse : </span>
                                    <span>{q.options[q.correct]}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {/* Questions non répondues */}
                  {nonRepondues > 0 && (
                    <div className="bg-gray-50 rounded-xl p-6 border-2 border-gray-300">
                      <h3 className="text-xl font-bold text-gray-600 mb-4 flex items-center gap-2">
                        <i className="fas fa-question-circle"></i>
                        Questions Non Répondues ({nonRepondues})
                      </h3>
                      <div className="space-y-4">
                        {detailsReponses.filter(d => d.reponse === -1).map((detail) => {
                          const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                          return (
                            <div key={detail.question} className="bg-white border-l-4 border-gray-400 p-4 rounded">
                              <div className="flex justify-between items-start mb-2">
                                <p className="font-semibold text-gray-800">Question {q.id}</p>
                                <span className="text-xs bg-gray-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                              </div>
                              <p className="text-sm text-gray-700 mb-2">{q.question}</p>
                              <div className="code-block mb-2">
                                <pre className="text-xs">{q.code}</pre>
                              </div>
                              <div className="flex items-center gap-2 text-green-700 text-sm">
                                <i className="fas fa-check"></i>
                                <div>
                                  <span className="font-semibold">Bonne réponse : </span>
                                  <span>{q.options[q.correct]}</span>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<QuizApp />, document.getElementById('root'));
  </script>
</body>
</html>

