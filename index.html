<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Python - ISI Keur Massar | Licence 2</title>
    
    <!-- React et ReactDOM (CRITIQUE : DOIT ÊTRE EN PREMIER) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.8);
                transform: scale(1.02);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        .code-editor {
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
            authDomain: "quiz-python-isikm.firebaseapp.com",
            projectId: "quiz-python-isikm",
            storageBucket: "quiz-python-isikm.firebasestorage.app",
            messagingSenderId: "559369640769",
            appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ACCESS_CODE = "QZ2025PYTH";
        const RECOVERY_CODE = "QZ2025PYTH";

        const QUIZ_CONFIG = {
            title: "Quiz Python - Licence 2 ISI Keur Massar",
            duration: 1800, // 30 minutes pour 80 questions
            penaltyPerWarning: 2,
            questions: [
                // QUESTIONS 1-50 (ORIGINALES)
                { id: 1, code: `x = int(4.9)\nprint(x)`, question: "Quelle est la sortie ? (conversion float vers int)", options: ["4.9", "4", "5", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 2, code: `texte = "Python"\nprint(len(texte))`, question: "Quelle est la longueur de la chaîne ?", options: ["5", "6", "7", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 3, code: `x = True\nprint(int(x))`, question: "Que retourne int(True) ?", options: ["True", "1", "0", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 4, code: `liste = [10, 20, 30]\nprint(liste[-1])`, question: "Quelle est la sortie ?", options: ["10", "30", "-1", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 5, code: `print(type(3.14))`, question: "Quel est le type de 3.14 ?", options: ["<class 'int'>", "<class 'float'>", "<class 'str'>", "<class 'decimal'>"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 6, code: `x = 10\nprint(x // 3)`, question: "Quelle est la sortie de la division entière ?", options: ["3.33", "3", "4", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 7, code: `liste = [1, 2, 3]\nliste.append(4)\nprint(len(liste))`, question: "Quelle est la longueur finale ?", options: ["3", "4", "5", "7"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 8, code: `x = "hello"\nprint(x.upper())`, question: "Quelle est la sortie ?", options: ["hello", "HELLO", "Hello", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 9, code: `print(10 % 3)`, question: "Que retourne l'opérateur modulo ?", options: ["3", "10", "1", "0"], correct: 2, points: 1, difficulty: "Facile" },
                { id: 10, code: `x = [5, 2, 8, 1]\nprint(max(x))`, question: "Quelle est la sortie ?", options: ["5", "2", "8", "1"], correct: 2, points: 1, difficulty: "Facile" },
                { id: 11, code: `mots = "Python est super".split()\nprint(len(mots))`, question: "Combien de mots dans la liste ?", options: ["1", "2", "3", "4"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
                { id: 12, code: `x = "123"\ny = int(x)\nprint(y + 7)`, question: "Quelle est la sortie ?", options: ["1237", "130", "Erreur", "123+7"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 13, code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, question: "Que retourne le slicing ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3, 4, 5]"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 14, code: `x = "bonjour"\nprint(x[0] + x[-1])`, question: "Quelle est la sortie ?", options: ["br", "jr", "bn", "bonjourr"], correct: 0, points: 1.25, difficulty: "Assez Facile" },
                { id: 15, code: `for i in range(3):\n    print(i, end="")`, question: "Quelle est la sortie complète ?", options: ["123", "012", "0 1 2", "321"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 16, code: `x = 15\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["Pair", "Impair", "True", "False"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 17, code: `x = [1, 2, 3]\nx.extend([4, 5])\nprint(len(x))`, question: "Quelle est la longueur finale ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 18, code: `texte = "  Python  "\nprint(len(texte.strip()))`, question: "Quelle est la longueur après strip() ?", options: ["10", "8", "6", "Erreur"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
                { id: 19, code: `x = [5, 2, 8, 1]\nx.sort()\nprint(x[0])`, question: "Quel est le premier élément après tri ?", options: ["5", "2", "8", "1"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
                { id: 20, code: `print("abc" * 3)`, question: "Quelle est la sortie ?", options: ["abc3", "abcabcabc", "aaa bbb ccc", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 21, code: `liste = [1, 2, 3, 2, 1]\nprint(liste.count(2))`, question: "Combien de fois 2 apparaît ?", options: ["1", "2", "3", "5"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 22, code: `x = 5\ny = 2\nprint(x ** y)`, question: "Que retourne l'opérateur ** (puissance) ?", options: ["7", "10", "25", "52"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 23, code: `def somme(a, b):\n    return a + b\nprint(somme(3, 4))`, question: "Quelle est la sortie ?", options: ["34", "7", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 24, code: `texte = "nom,age,ville"\nelements = texte.split(',')\nprint(len(elements))`, question: "Combien d'éléments dans la liste ?", options: ["1", "2", "3", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 25, code: `x = [1, 2, 3]\nx[1] = 10\nprint(x)`, question: "Quelle est la sortie ?", options: ["[1, 10, 3]", "[10, 2, 3]", "[1, 2, 10]", "Erreur"], correct: 0, points: 1.5, difficulty: "Moyen" },
                { id: 26, code: `liste = [1, 2]\ny = [3, 4]\nz = liste + y\nprint(len(z))`, question: "Quelle est la longueur de z ?", options: ["2", "3", "4", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 27, code: `mots = ["a", "b", "c"]\nresultat = "-".join(mots)\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["abc", "a-b-c", "a b c", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 28, code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end=" ")`, question: "Quelle est la sortie ?", options: ["0 1 2 3 4", "0 1 3 4", "0 1 2", "3 4"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 29, code: `x = "abc"\ny = x.replace("b", "X")\nprint(y)`, question: "Quelle est la sortie ?", options: ["abc", "aXc", "Xbc", "abX"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 30, code: `x = 3\ny = 5\nx, y = y, x\nprint(x)`, question: "Que vaut x après l'échange ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 31, code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, question: "Quelle est la valeur finale de i ?", options: ["0", "2", "3", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 32, code: `x = 5\nfor i in range(3):\n    x += i\nprint(x)`, question: "Quelle est la valeur finale de x ? (x=5, puis +0, +1, +2)", options: ["5", "6", "8", "11"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 33, code: `x = 10\nwhile x > 0:\n    x -= 3\n    if x == 4:\n        break\nprint(x)`, question: "Quelle est la valeur de x à la sortie ?", options: ["1", "4", "0", "7"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 34, code: `def test(n):\n    if n > 0:\n        return n\n    return 0\nprint(test(-5))`, question: "Quelle est la sortie ?", options: ["-5", "5", "0", "None"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 35, code: `texte = "je suis ingenieur"\nprint(texte.title())`, question: "Quelle est la sortie ?", options: ["je suis ingenieur", "Je Suis Ingenieur", "JE SUIS INGENIEUR", "Je suis ingenieur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 36, code: `liste = [5, 10, 15, 20]\nprint(liste[-2])`, question: "Quelle est la sortie avec l'index négatif ?", options: ["20", "15", "10", "5"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 37, code: `x = [1, 2, 3, 4, 5]\nprint(x[::2])`, question: "Que retourne le slicing avec pas de 2 ?", options: ["[1, 2, 3]", "[1, 3, 5]", "[2, 4]", "[1, 2]"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 38, code: `x = "123"\nprint(x * 2)`, question: "Quelle est la sortie ?", options: ["246", "123123", "6", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 39, code: `nums = [1, 2, 3]\nprint(sum(nums) / len(nums))`, question: "Quelle est la moyenne calculée ?", options: ["1", "2", "2.0", "6"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 40, code: `x = [3, 1, 4, 1, 5]\nx.reverse()\nprint(x[0])`, question: "Quel est le premier élément après reverse() ?", options: ["3", "1", "5", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 41, code: `for i in range(2, 10, 3):\n    print(i, end=" ")`, question: "Quelle est la sortie du range avec pas de 3 ?", options: ["2 5 8", "2 5 8 11", "3 6 9", "2 3 4"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 42, code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (référence)", options: ["3", "4", "7", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 43, code: `texte = "Python"\nprint(texte[1:4])`, question: "Que retourne ce slicing ?", options: ["Pyt", "yth", "ytho", "Pyth"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 44, code: `x = [1, 2, 3, 4, 5]\nprint(x[::-1])`, question: "Que fait le slicing avec pas -1 ?", options: ["[1, 2, 3, 4, 5]", "[5, 4, 3, 2, 1]", "[2, 4]", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 45, code: `x = "a,b,c"\ny = x.split(',')\nz = "-".join(y)\nprint(z)`, question: "Quelle transformation est effectuée ?", options: ["a,b,c", "a-b-c", "abc", "a b c"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 46, code: `x = 0\nfor i in range(4):\n    if i % 2 == 0:\n        x += i\nprint(x)`, question: "Quelle est la somme des nombres pairs ?", options: ["0", "2", "4", "6"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 47, code: `liste = [5, 2, 8, 1, 9]\nliste.sort()\nprint(liste[2])`, question: "Quel est l'élément du milieu après tri ?", options: ["8", "5", "2", "9"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 48, code: `x = "ingenieur logiciel"\ny = x.replace("logiciel", "civil")\nprint(y)`, question: "Quelle est la chaîne finale ?", options: ["ingenieur logiciel", "ingenieur civil", "civil logiciel", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 49, code: `x = [1, 2, 3]\ny = x[:]\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (copie superficielle)", options: ["3", "4", "7", "Erreur"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 50, code: `nombres = [10, 20, 30]\nsomme = sum(nombres)\nmoyenne = somme / len(nombres)\nprint(int(moyenne))`, question: "Quelle est la moyenne convertie en entier ?", options: ["10", "15", "20", "60"], correct: 2, points: 2, difficulty: "Difficile" },
                
                // NOUVELLES QUESTIONS 51-80 (IF/ELSE, BOUCLES, FONCTIONS)
                { id: 51, code: `x = 7\nif x > 5:\n    print("A")\nelse:\n    print("B")`, question: "Quelle est la sortie ?", options: ["A", "B", "AB", "Rien"], correct: 0, points: 1.5, difficulty: "Moyen" },
                { id: 52, code: `n = 10\nif n % 2 == 0 and n > 5:\n    print("Oui")\nelse:\n    print("Non")`, question: "Quelle est la sortie ?", options: ["Oui", "Non", "True", "False"], correct: 0, points: 1.5, difficulty: "Moyen" },
                { id: 53, code: `age = 17\nif age >= 18:\n    print("Majeur")\nelif age >= 13:\n    print("Ado")\nelse:\n    print("Enfant")`, question: "Quelle est la sortie ?", options: ["Majeur", "Ado", "Enfant", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 54, code: `x = 0\nfor i in range(1, 6):\n    x += i\nprint(x)`, question: "Quelle est la valeur finale de x ?", options: ["10", "15", "21", "6"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 55, code: `compteur = 0\nfor i in range(10):\n    if i > 5:\n        compteur += 1\nprint(compteur)`, question: "Combien de fois la condition est vraie ?", options: ["3", "4", "5", "6"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 56, code: `resultat = 1\nfor i in range(1, 5):\n    resultat *= i\nprint(resultat)`, question: "Quelle est la valeur de resultat ? (factorielle de 4)", options: ["10", "20", "24", "120"], correct: 2, points: 2, difficulty: "Difficile" },
                { id: 57, code: `i = 1\nwhile i <= 5:\n    i += 1\nprint(i)`, question: "Quelle est la valeur finale de i ?", options: ["5", "6", "4", "Boucle infinie"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 58, code: `x = 0\ni = 0\nwhile i < 4:\n    x += i\n    i += 1\nprint(x)`, question: "Quelle est la valeur finale de x ?", options: ["4", "6", "10", "0"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 59, code: `n = 15\nwhile n > 10:\n    n -= 2\nprint(n)`, question: "Quelle est la valeur finale de n ?", options: ["9", "10", "11", "8"], correct: 0, points: 1.75, difficulty: "Assez Difficile" },
                { id: 60, code: `for i in range(3):\n    for j in range(2):\n        print("*", end="")\n    print()`, question: "Combien d'étoiles sont affichées au total ?", options: ["5", "6", "3", "2"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 61, code: `def double(n):\n    return n * 2\nprint(double(5))`, question: "Quelle est la sortie ?", options: ["5", "10", "25", "None"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 62, code: `def test(nom):\n    return "Bonjour " + nom\nprint(test("Ali"))`, question: "Quelle est la sortie ?", options: ["Bonjour", "Ali", "Bonjour Ali", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 63, code: `def est_pair(n):\n    return n % 2 == 0\nprint(est_pair(7))`, question: "Quelle est la sortie ?", options: ["True", "False", "1", "0"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 64, code: `def test(a, b):\n    if a > b:\n        return a\n    return b\nprint(test(8, 5))`, question: "Quelle est la sortie ?", options: ["5", "8", "13", "None"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 65, code: `def calculer(x, y):\n    return x + y, x - y\na, b = calculer(10, 3)\nprint(a)`, question: "Quelle est la valeur de a ?", options: ["10", "3", "13", "7"], correct: 2, points: 2, difficulty: "Difficile" },
                { id: 66, code: `def test(n=5):\n    return n + 1\nprint(test())`, question: "Quelle est la sortie ? (paramètre par défaut)", options: ["5", "6", "1", "None"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 67, code: `liste = [1, 2, 3, 4, 5]\nfor i in liste:\n    if i == 3:\n        break\n    print(i, end="")`, question: "Quelle est la sortie ?", options: ["123", "12", "12345", "345"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 68, code: `x = 20\nif x > 10:\n    if x > 15:\n        print("Grand")\n    else:\n        print("Moyen")\nelse:\n    print("Petit")`, question: "Quelle est la sortie ? (if imbriqués)", options: ["Grand", "Moyen", "Petit", "Erreur"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 69, code: `def test(liste):\n    count = 0\n    for n in liste:\n        if n > 0:\n            count += 1\n    return count\nprint(test([1, -2, 3, -4, 5]))`, question: "Quelle est la sortie ?", options: ["2", "3", "5", "0"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 70, code: `for i in range(5):\n    if i % 2 != 0:\n        continue\n    print(i, end="")`, question: "Quelle est la sortie ?", options: ["024", "135", "01234", "12345"], correct: 0, points: 1.75, difficulty: "Assez Difficile" },
                { id: 71, code: `def test(base, exp):\n    resultat = 1\n    for i in range(exp):\n        resultat *= base\n    return resultat\nprint(test(2, 3))`, question: "Quelle est la sortie ?", options: ["6", "8", "9", "5"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 72, code: `x = 5\nwhile x > 0:\n    if x == 2:\n        break\n    x -= 1\nprint(x)`, question: "Quelle est la valeur finale de x ?", options: ["0", "1", "2", "-1"], correct: 2, points: 2, difficulty: "Difficile" },
                { id: 73, code: `def test(lst):\n    total = 0\n    for num in lst:\n        total += num\n    return total\nprint(test([2, 4, 6]))`, question: "Quelle est la sortie ?", options: ["6", "12", "246", "0"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 74, code: `note = 12\nif note >= 16:\n    mention = "TB"\nelif note >= 14:\n    mention = "B"\nelif note >= 12:\n    mention = "AB"\nelse:\n    mention = "Passable"\nprint(mention)`, question: "Quelle est la sortie ?", options: ["TB", "B", "AB", "Passable"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 75, code: `def test(n, min_val, max_val):\n    return n >= min_val and n <= max_val\nprint(test(15, 10, 20))`, question: "Quelle est la sortie ?", options: ["True", "False", "15", "None"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 76, code: `for i in range(3):\n    print(i)\n    if i == 1:\n        break`, question: "Combien de nombres sont affichés ?", options: ["1", "2", "3", "0"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 77, code: `def test(lst, facteur):\n    resultat = []\n    for val in lst:\n        resultat.append(val * facteur)\n    return resultat\nprint(test([1, 2, 3], 2))`, question: "Quelle est la sortie ?", options: ["[1, 2, 3]", "[2, 4, 6]", "[3, 6, 9]", "6"], correct: 1, points: 2.5, difficulty: "Difficile" },
                { id: 78, code: `x = 100\nwhile x >= 90:\n    x -= 3\nprint(x)`, question: "Quelle est la valeur finale de x ?", options: ["87", "88", "89", "90"], correct: 2, points: 2, difficulty: "Difficile" },
                { id: 79, code: `def test(texte):\n    voyelles = "aeiou"\n    count = 0\n    for char in texte.lower():\n        if char in voyelles:\n            count += 1\n    return count\nprint(test("Python"))`, question: "Quelle est la sortie ?", options: ["1", "2", "3", "0"], correct: 1, points: 2.5, difficulty: "Difficile" },
                { id: 80, code: `def test(lst):\n    resultat = []\n    for i in range(len(lst) - 1, -1, -1):\n        resultat.append(lst[i])\n    return resultat\nprint(test([1, 2, 3, 4]))`, question: "Quelle est la sortie ? (inversion de liste)", options: ["[1, 2, 3, 4]", "[4, 3, 2, 1]", "[4, 3, 2]", "Erreur"], correct: 1, points: 2.5, difficulty: "Difficile" },
            ]
        };

        function PythonQuizApp() {
            const [screen, setScreen] = useState('access');
            const [accessCodeInput, setAccessCodeInput] = useState('');
            const [studentInfo, setStudentInfo] = useState({ nom: '', prenom: '', classe: '' });
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState({});
            const [timeLeft, setTimeLeft] = useState(QUIZ_CONFIG.duration);
            const [tabSwitches, setTabSwitches] = useState(0);
            const [warnings, setWarnings] = useState([]);
            const [sessionId, setSessionId] = useState(null);
            const [isBlocked, setIsBlocked] = useState(false);
            const [showDetailedResults, setShowDetailedResults] = useState(false);

            useEffect(() => {
                if (screen === 'quiz' && timeLeft > 0 && !isBlocked) {
                    const timer = setInterval(() => {
                        setTimeLeft(prev => {
                            if (prev <= 1) {
                                handleSubmitQuiz();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [screen, timeLeft, isBlocked]);

            useEffect(() => {
                if (screen === 'quiz' && !isBlocked) {
                    const handleVisibilityChange = async () => {
                        if (document.hidden) {
                            const newCount = tabSwitches + 1;
                            setTabSwitches(newCount);
                            const warning = `Changement d'onglet à ${formatTime(QUIZ_CONFIG.duration - timeLeft)}`;
                            setWarnings(prev => [...prev, warning]);
                            
                            if (sessionId) {
                                await db.collection('quiz_sessions').doc(sessionId).update({
                                    tabSwitches: newCount,
                                    lastWarning: warning,
                                    warnings: firebase.firestore.FieldValue.arrayUnion(warning)
                                });
                            }

                            setIsBlocked(true);
                            
                            const { value: code } = await Swal.fire({
                                icon: 'error',
                                title: '⚠️ QUIZ BLOQUÉ !',
                                html: `
                                    <div class="text-center">
                                        <i class="fas fa-ban text-6xl text-red-500 mb-4"></i>
                                        <p class="text-xl font-bold text-red-600 mb-2">Changement d'onglet détecté !</p>
                                        <p class="text-gray-600 mb-4">Le quiz est temporairement bloqué.</p>
                                        <p class="text-sm text-gray-500">Demandez le code de reprise à votre enseignant</p>
                                    </div>
                                `,
                                input: 'password',
                                inputLabel: 'Code de déblocage',
                                inputPlaceholder: 'Entrez le code fourni',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                inputValidator: (value) => {
                                    if (!value) return 'Le code est requis pour continuer';
                                }
                            });

                            if (code === RECOVERY_CODE) {
                                setIsBlocked(false);
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Quiz débloqué',
                                    text: 'Vous pouvez reprendre le quiz',
                                    timer: 2000,
                                    showConfirmButton: false
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Code incorrect',
                                    text: 'Veuillez contacter votre enseignant',
                                    allowOutsideClick: false
                                }).then(() => window.location.reload());
                            }
                        }
                    };

                    document.addEventListener('visibilitychange', handleVisibilityChange);
                    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);
                }
            }, [screen, tabSwitches, timeLeft, isBlocked, sessionId]);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const handleAccessCodeSubmit = () => {
                if (accessCodeInput === ACCESS_CODE) {
                    setScreen('start');
                    Swal.fire({
                        icon: 'success',
                        title: 'Accès autorisé',
                        text: 'Vous pouvez maintenant entrer vos informations',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Code incorrect',
                        text: 'Veuillez vérifier le code fourni par votre enseignant'
                    });
                }
            };

            const handleStartQuiz = async () => {
                if (!studentInfo.nom || !studentInfo.prenom || !studentInfo.classe) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Informations incomplètes',
                        text: 'Veuillez remplir tous les champs obligatoires'
                    });
                    return;
                }

                const result = await Swal.fire({
                    icon: 'info',
                    title: 'Confirmation',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-play-circle text-5xl text-indigo-500 mb-4"></i>
                            <p class="text-lg font-semibold mb-4">Prêt à commencer ?</p>
                            <div class="bg-yellow-50 rounded-lg p-4 text-left">
                                <p class="font-semibold text-yellow-800 mb-2">⚠️ Règles importantes :</p>
                                <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                    <li>30 minutes - 80 questions</li>
                                    <li>Ne pas changer d'onglet</li>
                                    <li>-2 points par tentative</li>
                                    <li>Quiz bloqué en cas de changement</li>
                                </ul>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Commencer le quiz',
                    cancelButtonText: 'Annuler'
                });

                if (result.isConfirmed) {
                    try {
                        const sessionRef = await db.collection('quiz_sessions').add({
                            etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
                            classe: studentInfo.classe,
                            status: 'started',
                            startTime: firebase.firestore.FieldValue.serverTimestamp(),
                            tabSwitches: 0,
                            warnings: [],
                            currentQuestion: 0
                        });
                        setSessionId(sessionRef.id);
                    } catch (error) {
                        console.error("Erreur création session:", error);
                    }

                    setScreen('quiz');
                }
            };

            const handleAnswer = (questionId, answerIndex) => {
                setAnswers(prev => ({ ...prev, [questionId]: answerIndex }));
                
                if (sessionId) {
                    db.collection('quiz_sessions').doc(sessionId).update({
                        currentQuestion: currentQuestion + 1,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            };

            const calculateScore = () => {
                let totalPoints = 0;
                let maxPoints = 0;
                let correct = 0;
                
                QUIZ_CONFIG.questions.forEach(q => {
                    maxPoints += q.points;
                    if (answers[q.id] === q.correct) {
                        totalPoints += q.points;
                        correct++;
                    }
                });

                let noteSur20 = (totalPoints / maxPoints) * 20;
                const penalty = tabSwitches * QUIZ_CONFIG.penaltyPerWarning;
                noteSur20 = Math.max(0, noteSur20 - penalty);

                return {
                    correct,
                    total: QUIZ_CONFIG.questions.length,
                    totalPoints: totalPoints.toFixed(2),
                    maxPoints: maxPoints,
                    noteSur20: noteSur20.toFixed(2),
                    penalty: penalty,
                    percentage: ((correct / QUIZ_CONFIG.questions.length) * 100).toFixed(2)
                };
            };

            const handleSubmitQuiz = async () => {
                setScreen('results');
                
                const results = calculateScore();
                const exportData = {
                    etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
                    classe: studentInfo.classe,
                    note: results.noteSur20,
                    pourcentage: results.percentage,
                    correct: results.correct,
                    total: results.total,
                    points: results.totalPoints,
                    maxPoints: results.maxPoints,
                    tentativesTriche: tabSwitches,
                    penalite: results.penalty,
                    dateTest: new Date().toLocaleString('fr-FR'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    duree: formatTime(QUIZ_CONFIG.duration - timeLeft),
                    avertissements: warnings,
                    detailsReponses: QUIZ_CONFIG.questions.map(q => ({
                        question: q.id,
                        code: q.code,
                        questionText: q.question,
                        reponse: answers[q.id] !== undefined ? answers[q.id] : -1,
                        reponseText: answers[q.id] !== undefined ? q.options[answers[q.id]] : "Non répondue",
                        correct: q.correct,
                        correctText: q.options[q.correct],
                        estCorrecte: answers[q.id] === q.correct,
                        points: answers[q.id] === q.correct ? q.points : 0,
                        difficulte: q.difficulty
                    }))
                };

                try {
                    await db.collection('results').add(exportData);
                    
                    if (sessionId) {
                        await db.collection('quiz_sessions').doc(sessionId).update({
                            status: 'completed',
                            endTime: firebase.firestore.FieldValue.serverTimestamp(),
                            finalNote: results.noteSur20
                        });
                    }
                } catch (error) {
                    console.error('Erreur Firebase:', error);
                }
            };

            // ÉCRAN D'ACCÈS
            if (screen === 'access') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="slide-in glass-effect rounded-3xl shadow-2xl p-8 md:p-12 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-32 h-32 bg-white bg-opacity-20 rounded-full mb-6 float-animation overflow-hidden p-2">
                                    <img src="isi_logo.png" alt="ISI KM Logo" className="w-full h-full object-contain" />
                                </div>
                                <h1 className="text-4xl font-bold text-white mb-3">Quiz Python</h1>
                                <p className="text-white text-opacity-90 text-lg mb-2">ISI Keur  - Licence 2</p>
                                <p className="text-white text-opacity-70">Code d'accès requis</p>
                            </div>

                            <div className="space-y-6">
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i className="fas fa-key text-white text-opacity-50"></i>
                                    </div>
                                    <input
                                        type="password"
                                        value={accessCodeInput}
                                        onChange={(e) => setAccessCodeInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAccessCodeSubmit()}
                                        className="w-full pl-12 pr-4 py-4 bg-white bg-opacity-20 border-2 border-white border-opacity-30 rounded-xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:border-opacity-60 transition"
                                        placeholder="Entrez le code d'accès"
                                    />
                                </div>

                                <button
                                    onClick={handleAccessCodeSubmit}
                                    className="w-full bg-white text-indigo-600 py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 transform hover:scale-105 transition-all duration-300 shadow-xl pulse-glow"
                                >
                                    <i className="fas fa-unlock mr-2"></i>
                                    Accéder au Quiz
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-white border-opacity-20">
                                <div className="flex items-center justify-center space-x-4 text-white text-opacity-70 text-sm">
                                    <div className="flex items-center">
                                        <i className="fas fa-shield-alt mr-2"></i>
                                        <span>Sécurisé</span>
                                    </div>
                                    <div className="w-1 h-1 bg-white bg-opacity-50 rounded-full"></div>
                                    <div className="flex items-center">
                                        <i className="fas fa-clock mr-2"></i>
                                        <span>30 min</span>
                                    </div>
                                    <div className="w-1 h-1 bg-white bg-opacity-50 rounded-full"></div>
                                    <div className="flex items-center">
                                        <i className="fas fa-question-circle mr-2"></i>
                                        <span>80 questions</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ÉCRAN D'INSCRIPTION
            if (screen === 'start') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="slide-in bg-white bg-opacity-95 backdrop-blur-xl rounded-3xl shadow-2xl p-8 md:p-12 max-w-lg w-full">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mb-6 float-animation">
                                    <i className="fab fa-python text-4xl text-white"></i>
                                </div>
                                <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
                                    {QUIZ_CONFIG.title}
                                </h1>
                                <p className="text-gray-600 flex items-center justify-center gap-4">
                                    <span><i className="far fa-clock mr-1"></i> 30 minutes</span>
                                    <span><i className="fas fa-question-circle mr-1"></i> 80 questions</span>
                                </p>
                            </div>

                            <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-500 rounded-xl p-4 mb-6">
                                <div className="flex">
                                    <i className="fas fa-exclamation-triangle text-yellow-600 text-xl mr-3 mt-1"></i>
                                    <div>
                                        <p className="font-bold text-yellow-800 mb-2">Règles importantes</p>
                                        <ul className="text-sm text-yellow-700 space-y-1">
                                            <li>• Ne pas changer d'onglet pendant le quiz</li>
                                            <li>• Le quiz se bloque automatiquement</li>
                                            <li>• Pénalité de 2 points par tentative</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-5">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-user mr-2 text-indigo-500"></i>
                                        Prénom
                                    </label>
                                    <input
                                        type="text"
                                        value={studentInfo.prenom}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, prenom: e.target.value }))}
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                        placeholder="Votre prénom"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-id-card mr-2 text-indigo-500"></i>
                                        Nom
                                    </label>
                                    <input
                                        type="text"
                                        value={studentInfo.nom}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, nom: e.target.value }))}
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                        placeholder="Votre nom"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-graduation-cap mr-2 text-indigo-500"></i>
                                        Classe
                                    </label>
                                    <select
                                        value={studentInfo.classe}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, classe: e.target.value }))}
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                    >
                                        <option value="">Sélectionnez votre classe</option>
                                        <option value="L2-IAGE">L2 - IAGE</option>
                                        <option value="L2-GL">L2 - GL</option>
                                    </select>
                                </div>

                                <button
                                    onClick={handleStartQuiz}
                                    className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-300 shadow-xl pulse-glow"
                                >
                                    <i className="fas fa-rocket mr-2"></i>
                                    Commencer le Quiz
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-gray-200 text-center">
                                <a href="admin.html" className="text-sm text-gray-500 hover:text-indigo-600 transition-colors inline-flex items-center">
                                    <i className="fas fa-user-shield mr-1"></i>
                                    Espace administration
                                </a>
                            </div>
                        </div>
                    </div>
                );
            }

            // ÉCRAN DU QUIZ
            if (screen === 'quiz') {
                const question = QUIZ_CONFIG.questions[currentQuestion];
                const progress = ((currentQuestion + 1) / QUIZ_CONFIG.questions.length) * 100;
                const difficultyColors = {
                    'Facile': 'bg-green-100 text-green-700 border-green-300',
                    'Assez Facile': 'bg-blue-100 text-blue-700 border-blue-300',
                    'Moyen': 'bg-yellow-100 text-yellow-700 border-yellow-300',
                    'Assez Difficile': 'bg-orange-100 text-orange-700 border-orange-300',
                    'Difficile': 'bg-red-100 text-red-700 border-red-300'
                };

                return (
                    <div className="min-h-screen">
                        {/* HEADER */}
                        <div className="bg-white bg-opacity-95 backdrop-blur-xl shadow-lg sticky top-0 z-50">
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                            <i className="fas fa-user-graduate text-2xl text-white"></i>
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">{studentInfo.prenom} {studentInfo.nom}</h2>
                                            <p className="text-gray-600 text-sm">
                                                <i className="fas fa-graduation-cap mr-1"></i>
                                                {studentInfo.classe}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        {tabSwitches > 0 && (
                                            <div className="flex items-center bg-red-50 px-4 py-2 rounded-xl border-2 border-red-200">
                                                <i className="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                                <span className="font-bold text-red-600">{tabSwitches} avertissement(s)</span>
                                            </div>
                                        )}
                                        
                                        <div className={`flex items-center gap-3 px-4 py-2 rounded-xl ${timeLeft < 300 ? 'bg-red-50 border-2 border-red-200' : 'bg-indigo-50 border-2 border-indigo-200'}`}>
                                            <i className={`far fa-clock text-2xl ${timeLeft < 300 ? 'text-red-500 animate-pulse' : 'text-indigo-500'}`}></i>
                                            <div>
                                                <div className={`text-2xl font-bold ${timeLeft < 300 ? 'text-red-600' : 'text-gray-800'}`}>
                                                    {formatTime(timeLeft)}
                                                </div>
                                                <div className="text-xs text-gray-500">Temps restant</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Barre de progression */}
                                <div className="mt-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-semibold text-gray-700">
                                            <i className="fas fa-list mr-1"></i>
                                            Question {currentQuestion + 1} sur {QUIZ_CONFIG.questions.length}
                                        </span>
                                        <div className="flex items-center gap-2">
                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold border-2 ${difficultyColors[question.difficulty]}`}>
                                                {question.difficulty}
                                            </span>
                                            <span className="px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700 border-2 border-purple-300">
                                                <i className="fas fa-star mr-1"></i>
                                                {question.points} pt
                                            </span>
                                        </div>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                        <div 
                                            className="bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"
                                            style={{ width: `${progress}%` }}
                                        ></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* QUESTION */}
                        <div className="max-w-6xl mx-auto px-4 py-8">
                            <div className="slide-in bg-white bg-opacity-95 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-10">
                                <h3 className="text-2xl md:text-3xl font-bold text-gray-800 mb-8">
                                    <i className="fas fa-code text-indigo-500 mr-3"></i>
                                    {question.question}
                                </h3>
                                
                                {/* CODE EDITOR */}
                                <div className="code-editor rounded-2xl overflow-hidden mb-8 shadow-xl">
                                    <div className="bg-gray-800 px-6 py-3 flex items-center justify-between">
                                        <div className="flex items-center space-x-2">
                                            <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                                            <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                                        </div>
                                        <div className="flex items-center text-gray-400 text-sm">
                                            <i className="fab fa-python mr-2"></i>
                                            Python 3
                                        </div>
                                    </div>
                                    <div className="bg-gray-900 px-6 py-6">
                                        <pre className="text-green-400 text-base md:text-lg overflow-x-auto">{question.code}</pre>
                                    </div>
                                </div>

                                {/* OPTIONS */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {question.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleAnswer(question.id, index)}
                                            className={`group p-6 rounded-2xl border-2 transition-all duration-300 transform hover:-translate-y-1 ${
                                                answers[question.id] === index 
                                                    ? 'border-indigo-500 bg-gradient-to-r from-indigo-50 to-purple-50 shadow-xl' 
                                                    : 'border-gray-200 hover:border-indigo-300 hover:shadow-lg bg-white'
                                            }`}
                                        >
                                            <div className="flex items-center">
                                                <div className={`w-12 h-12 rounded-xl flex items-center justify-center mr-4 transition-all ${
                                                    answers[question.id] === index 
                                                        ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg' 
                                                        : 'bg-gray-100 text-gray-600 group-hover:bg-indigo-100 group-hover:text-indigo-600'
                                                }`}>
                                                    <span className="font-bold text-lg">{String.fromCharCode(65 + index)}</span>
                                                </div>
                                                <div className="flex-1 text-left">
                                                    <p className="text-base md:text-lg font-medium text-gray-800">{option}</p>
                                                </div>
                                                {answers[question.id] === index && (
                                                    <i className="fas fa-check-circle text-indigo-500 text-2xl"></i>
                                                )}
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* NAVIGATION */}
                            <div className="flex justify-between mt-8">
                                <button
                                    onClick={() => setCurrentQuestion(prev => Math.max(0, prev - 1))}
                                    disabled={currentQuestion === 0}
                                    className="px-6 py-3 bg-white bg-opacity-90 backdrop-blur text-gray-700 rounded-xl font-semibold hover:bg-opacity-100 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg flex items-center"
                                >
                                    <i className="fas fa-arrow-left mr-2"></i>
                                    Précédent
                                </button>

                                {currentQuestion < QUIZ_CONFIG.questions.length - 1 ? (
                                    <button
                                        onClick={() => setCurrentQuestion(prev => prev + 1)}
                                        className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold hover:from-indigo-600 hover:to-purple-700 transition shadow-lg flex items-center"
                                    >
                                        Suivant
                                        <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                ) : (
                                    <button
                                        onClick={handleSubmitQuiz}
                                        className="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition shadow-lg flex items-center pulse-glow"
                                    >
                                        <i className="fas fa-flag-checkered mr-2"></i>
                                        Terminer
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // ÉCRAN DES RÉSULTATS
            if (screen === 'results') {
                const score = calculateScore();
                const isPassed = parseFloat(score.noteSur20) >= 10;
                const correctQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] === q.correct);
                const incorrectQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] !== undefined && answers[q.id] !== q.correct);
                const unansweredQuestions = QUIZ_CONFIG.questions.filter(q => answers[q.id] === undefined);

                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-5xl mx-auto">
                            <div className="slide-in bg-white bg-opacity-95 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
                                {/* HEADER RÉSULTATS */}
                                <div className={`${isPassed ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 'bg-gradient-to-r from-orange-500 to-red-600'} text-white p-8 md:p-12 text-center`}>
                                    <div className="inline-flex items-center justify-center w-28 h-28 bg-white bg-opacity-20 rounded-full mb-6 float-animation">
                                        <i className={`fas ${isPassed ? 'fa-trophy' : 'fa-chart-line'} text-5xl`}></i>
                                    </div>
                                    <h1 className="text-4xl md:text-5xl font-bold mb-3">
                                        {isPassed ? 'Félicitations !' : 'Quiz Terminé'}
                                    </h1>
                                    <p className="text-white text-opacity-90 text-lg">
                                        {studentInfo.prenom} {studentInfo.nom} • {studentInfo.classe}
                                    </p>
                                </div>

                                {/* SCORE PRINCIPAL */}
                                <div className="p-8 md:p-12">
                                    <div className="text-center mb-12">
                                        <div className="inline-flex items-baseline justify-center mb-4">
                                            <span className="text-7xl md:text-8xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                                {score.noteSur20}
                                            </span>
                                            <span className="text-4xl text-gray-400 ml-3">/20</span>
                                        </div>
                                        <p className="text-xl text-gray-600 mb-6">
                                            <i className="fas fa-check-circle text-green-500 mr-2"></i>
                                            {score.correct} réponses correctes sur {score.total}
                                        </p>

                                        {score.penalty > 0 && (
                                            <div className="inline-flex items-center bg-red-50 px-6 py-3 rounded-2xl border-2 border-red-200 mb-8">
                                                <i className="fas fa-exclamation-triangle text-red-500 mr-2 text-xl"></i>
                                                <span className="text-red-600 font-bold">Pénalité appliquée : -{score.penalty} points</span>
                                            </div>
                                        )}
                                    </div>

                                    {/* STATISTIQUES */}
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
                                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl border-2 border-blue-200">
                                            <div className="text-4xl font-bold text-blue-600 mb-2">{score.percentage}%</div>
                                            <div className="text-gray-700 text-sm font-semibold">Taux de réussite</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl border-2 border-green-200">
                                            <div className="text-4xl font-bold text-green-600 mb-2">{score.correct}</div>
                                            <div className="text-gray-700 text-sm font-semibold">Correctes</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-2xl border-2 border-red-200">
                                            <div className="text-4xl font-bold text-red-600 mb-2">{incorrectQuestions.length}</div>
                                            <div className="text-gray-700 text-sm font-semibold">Incorrectes</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl border-2 border-purple-200">
                                            <div className="text-4xl font-bold text-purple-600 mb-2">{score.totalPoints}</div>
                                            <div className="text-gray-700 text-sm font-semibold">Points obtenus</div>
                                        </div>
                                    </div>

                                    {/* ACTIONS */}
                                    <div className="space-y-4">
                                        <button
                                            onClick={() => setShowDetailedResults(!showDetailedResults)}
                                            className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transition-all shadow-xl flex items-center justify-center"
                                        >
                                            <i className={`fas ${showDetailedResults ? 'fa-eye-slash' : 'fa-chart-bar'} mr-2`}></i>
                                            {showDetailedResults ? 'Masquer les détails' : 'Voir les détails des réponses'}
                                        </button>

                                        <button
                                            onClick={() => window.location.reload()}
                                            className="w-full bg-white border-2 border-gray-200 text-gray-700 py-4 rounded-xl font-bold text-lg hover:bg-gray-50 transition-all shadow-lg"
                                        >
                                            <i className="fas fa-home mr-2"></i>
                                            Retour à l'accueil
                                        </button>
                                    </div>

                                    {/* DÉTAILS DES RÉPONSES */}
                                    {showDetailedResults && (
                                        <div className="mt-10 space-y-6">
                                            <h3 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                                <i className="fas fa-list-ul mr-3 text-indigo-500"></i>
                                                Détails des Réponses
                                            </h3>

                                            {correctQuestions.length > 0 && (
                                                <div className="bg-green-50 rounded-2xl p-6 border-2 border-green-200">
                                                    <h4 className="text-xl font-bold text-green-700 mb-4 flex items-center">
                                                        <i className="fas fa-check-circle mr-2"></i>
                                                        Réponses Correctes ({correctQuestions.length})
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {correctQuestions.map((q) => (
                                                            <div key={q.id} className="bg-white rounded-xl p-4 border-l-4 border-green-500">
                                                                <div className="flex justify-between items-start mb-2">
                                                                    <span className="font-semibold text-gray-800">Question {q.id}</span>
                                                                    <span className="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                                        +{q.points} pts
                                                                    </span>
                                                                </div>
                                                                <p className="text-sm text-gray-700 mb-2">{q.question}</p>
                                                                <div className="bg-gray-900 rounded-lg p-3 mb-2">
                                                                    <pre className="text-green-400 text-xs overflow-x-auto">{q.code}</pre>
                                                                </div>
                                                                <div className="text-sm text-green-600 flex items-center">
                                                                    <i className="fas fa-check mr-2"></i>
                                                                    <span><strong>Votre réponse :</strong> {q.options[answers[q.id]]}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {incorrectQuestions.length > 0 && (
                                                <div className="bg-red-50 rounded-2xl p-6 border-2 border-red-200">
                                                    <h4 className="text-xl font-bold text-red-700 mb-4 flex items-center">
                                                        <i className="fas fa-times-circle mr-2"></i>
                                                        Réponses Incorrectes ({incorrectQuestions.length})
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {incorrectQuestions.map((q) => (
                                                            <div key={q.id} className="bg-white rounded-xl p-4 border-l-4 border-red-500">
                                                                <div className="flex justify-between items-start mb-3">
                                                                    <span className="font-semibold text-gray-800">Question {q.id}</span>
                                                                    <span className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                                        0 pts
                                                                    </span>
                                                                </div>
                                                                <p className="text-sm text-gray-700 mb-3">{q.question}</p>
                                                                <div className="bg-gray-900 rounded-lg p-3 mb-3">
                                                                    <pre className="text-green-400 text-xs overflow-x-auto">{q.code}</pre>
                                                                </div>
                                                                <div className="space-y-2 text-sm">
                                                                    <div className="flex items-center text-red-600">
                                                                        <i className="fas fa-times mr-2"></i>
                                                                        <span><strong>Votre réponse :</strong> {q.options[answers[q.id]]}</span>
                                                                    </div>
                                                                    <div className="flex items-center text-green-600">
                                                                        <i className="fas fa-check mr-2"></i>
                                                                        <span><strong>Bonne réponse :</strong> {q.options[q.correct]}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {unansweredQuestions.length > 0 && (
                                                <div className="bg-gray-50 rounded-2xl p-6 border-2 border-gray-200">
                                                    <h4 className="text-xl font-bold text-gray-700 mb-4 flex items-center">
                                                        <i className="fas fa-question-circle mr-2"></i>
                                                        Questions Non Répondues ({unansweredQuestions.length})
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {unansweredQuestions.map((q) => (
                                                            <div key={q.id} className="bg-white rounded-xl p-4 border-l-4 border-gray-400">
                                                                <div className="flex justify-between items-start mb-2">
                                                                    <span className="font-semibold text-gray-800">Question {q.id}</span>
                                                                    <span className="bg-gray-400 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                                        0 pts
                                                                    </span>
                                                                </div>
                                                                <p className="text-sm text-gray-700 mb-2">{q.question}</p>
                                                                <div className="bg-gray-900 rounded-lg p-3 mb-2">
                                                                    <pre className="text-green-400 text-xs overflow-x-auto">{q.code}</pre>
                                                                </div>
                                                                <div className="text-sm text-green-600 flex items-center">
                                                                    <i className="fas fa-check mr-2"></i>
                                                                    <span><strong>Bonne réponse :</strong> {q.options[q.correct]}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PythonQuizApp />);
    </script>
</body>
</html>
