<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Python - Licence 2</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
        .code-editor {
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            background: #1a1a1a;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
            authDomain: "quiz-python-isikm.firebaseapp.com",
            projectId: "quiz-python-isikm",
            storageBucket: "quiz-python-isikm.firebasestorage.app",
            messagingSenderId: "559369640769",
            appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Codes d'accès
        const ACCESS_CODE = "QZ2025PYTH";
        const RECOVERY_CODE = "QZ2025PYTH";

        // Configuration du quiz - 30 minutes
        const QUIZ_CONFIG = {
            title: "Quiz Python - Licence 2",
            duration: 1800, // 30 minutes
            penaltyPerWarning: 2,
            questions: [
                // Les 50 questions restent identiques
                { id: 1, code: `x = int(4.9)\nprint(x)`, question: "Quelle est la sortie ?", options: ["4.9", "4", "5", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                // ... les autres questions
            ]
        };

        function PythonQuizApp() {
            const [screen, setScreen] = useState('access');
            const [accessCodeInput, setAccessCodeInput] = useState('');
            const [studentInfo, setStudentInfo] = useState({ nom: '', prenom: '', classe: '' });
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState({});
            const [timeLeft, setTimeLeft] = useState(QUIZ_CONFIG.duration);
            const [tabSwitches, setTabSwitches] = useState(0);
            const [warnings, setWarnings] = useState([]);
            const [sessionId, setSessionId] = useState(null);
            const [isBlocked, setIsBlocked] = useState(false);
            const [showDetailedResults, setShowDetailedResults] = useState(false);

            // Timer
            useEffect(() => {
                if (screen === 'quiz' && timeLeft > 0 && !isBlocked) {
                    const timer = setInterval(() => {
                        setTimeLeft(prev => {
                            if (prev <= 1) {
                                handleSubmitQuiz();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [screen, timeLeft, isBlocked]);

            // Surveillance des changements d'onglet
            useEffect(() => {
                if (screen === 'quiz' && !isBlocked) {
                    const handleVisibilityChange = async () => {
                        if (document.hidden) {
                            const newCount = tabSwitches + 1;
                            setTabSwitches(newCount);
                            const warning = `Changement d'onglet à ${formatTime(QUIZ_CONFIG.duration - timeLeft)}`;
                            setWarnings(prev => [...prev, warning]);
                            
                            if (sessionId) {
                                await db.collection('quiz_sessions').doc(sessionId).update({
                                    tabSwitches: newCount,
                                    lastWarning: warning,
                                    warnings: firebase.firestore.FieldValue.arrayUnion(warning)
                                });
                            }

                            setIsBlocked(true);
                            
                            const { value: code } = await Swal.fire({
                                icon: 'error',
                                title: '⚠️ QUIZ BLOQUÉ !',
                                html: `
                                    <div class="text-center">
                                        <i class="fas fa-ban text-5xl text-red-500 mb-4"></i>
                                        <p class="text-xl font-bold text-red-600 mb-2">Changement d'onglet détecté !</p>
                                        <p class="text-gray-600 mb-4">Le quiz est temporairement bloqué.</p>
                                        <p class="text-sm text-gray-500">Demandez le code de reprise à votre enseignant</p>
                                    </div>
                                `,
                                input: 'password',
                                inputLabel: 'Code de déblocage',
                                inputPlaceholder: 'Entrez le code fourni',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                inputValidator: (value) => {
                                    if (!value) return 'Le code est requis pour continuer';
                                }
                            });

                            if (code === RECOVERY_CODE) {
                                setIsBlocked(false);
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Quiz débloqué',
                                    text: 'Vous pouvez reprendre le quiz',
                                    timer: 2000,
                                    showConfirmButton: false
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Code incorrect',
                                    text: 'Veuillez contacter votre enseignant',
                                    allowOutsideClick: false
                                }).then(() => window.location.reload());
                            }
                        }
                    };

                    document.addEventListener('visibilitychange', handleVisibilityChange);
                    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);
                }
            }, [screen, tabSwitches, timeLeft, isBlocked, sessionId]);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const handleAccessCodeSubmit = () => {
                if (accessCodeInput === ACCESS_CODE) {
                    setScreen('start');
                    Swal.fire({
                        icon: 'success',
                        title: 'Accès autorisé',
                        text: 'Vous pouvez maintenant entrer vos informations',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Code incorrect',
                        text: 'Veuillez vérifier le code fourni par votre enseignant',
                        confirmButtonColor: '#ef4444'
                    });
                }
            };

            const handleStartQuiz = async () => {
                if (!studentInfo.nom || !studentInfo.prenom || !studentInfo.classe) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Informations incomplètes',
                        text: 'Veuillez remplir tous les champs obligatoires',
                        confirmButtonColor: '#f59e0b'
                    });
                    return;
                }

                const result = await Swal.fire({
                    icon: 'info',
                    title: 'Confirmation',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-play-circle text-4xl text-indigo-500 mb-4"></i>
                            <p class="text-lg font-semibold mb-2">Prêt à commencer ?</p>
                            <div class="bg-yellow-50 rounded-lg p-4 text-left mb-4">
                                <p class="font-semibold text-yellow-800 mb-2">⚠️ Règles importantes :</p>
                                <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                    <li>30 minutes - 50 questions</li>
                                    <li>Ne pas changer d'onglet ou d'application</li>
                                    <li>-2 points par tentative de triche</li>
                                    <li>Le quiz se bloque en cas de changement</li>
                                </ul>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Commencer le quiz',
                    cancelButtonText: 'Annuler',
                    confirmButtonColor: '#10b981',
                    cancelButtonColor: '#ef4444'
                });

                if (result.isConfirmed) {
                    try {
                        const sessionRef = await db.collection('quiz_sessions').add({
                            etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
                            classe: studentInfo.classe,
                            status: 'started',
                            startTime: firebase.firestore.FieldValue.serverTimestamp(),
                            tabSwitches: 0,
                            warnings: [],
                            currentQuestion: 0
                        });
                        setSessionId(sessionRef.id);
                    } catch (error) {
                        console.error("Erreur création session:", error);
                    }

                    setScreen('quiz');
                }
            };

            const handleAnswer = (questionId, answerIndex) => {
                setAnswers(prev => ({ ...prev, [questionId]: answerIndex }));
                
                if (sessionId) {
                    db.collection('quiz_sessions').doc(sessionId).update({
                        currentQuestion: currentQuestion + 1,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            };

            const calculateScore = () => {
                let totalPoints = 0;
                let maxPoints = 0;
                let correct = 0;
                
                QUIZ_CONFIG.questions.forEach(q => {
                    maxPoints += q.points;
                    if (answers[q.id] === q.correct) {
                        totalPoints += q.points;
                        correct++;
                    }
                });

                let noteSur20 = (totalPoints / maxPoints) * 20;
                const penalty = tabSwitches * QUIZ_CONFIG.penaltyPerWarning;
                noteSur20 = Math.max(0, noteSur20 - penalty);

                return {
                    correct,
                    total: QUIZ_CONFIG.questions.length,
                    totalPoints: totalPoints.toFixed(2),
                    maxPoints: maxPoints,
                    noteSur20: noteSur20.toFixed(2),
                    penalty: penalty,
                    percentage: ((correct / QUIZ_CONFIG.questions.length) * 100).toFixed(2)
                };
            };

            const handleSubmitQuiz = async () => {
                setScreen('results');
                
                const results = calculateScore();
                const exportData = {
                    etudiant: `${studentInfo.prenom} ${studentInfo.nom}`,
                    classe: studentInfo.classe,
                    note: results.noteSur20,
                    pourcentage: results.percentage,
                    correct: results.correct,
                    total: results.total,
                    points: results.totalPoints,
                    maxPoints: results.maxPoints,
                    tentativesTriche: tabSwitches,
                    penalite: results.penalty,
                    dateTest: new Date().toLocaleString('fr-FR'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    duree: formatTime(QUIZ_CONFIG.duration - timeLeft),
                    avertissements: warnings,
                    detailsReponses: QUIZ_CONFIG.questions.map(q => ({
                        question: q.id,
                        reponse: answers[q.id] !== undefined ? answers[q.id] : -1,
                        correct: q.correct,
                        estCorrecte: answers[q.id] === q.correct,
                        points: answers[q.id] === q.correct ? q.points : 0,
                        difficulte: q.difficulty
                    }))
                };

                try {
                    await db.collection('results').add(exportData);
                    
                    if (sessionId) {
                        await db.collection('quiz_sessions').doc(sessionId).update({
                            status: 'completed',
                            endTime: firebase.firestore.FieldValue.serverTimestamp(),
                            finalNote: results.noteSur20
                        });
                    }
                } catch (error) {
                    console.error('Erreur Firebase:', error);
                }
            };

            // Écran d'accès
            if (screen === 'access') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center p-4">
                        <div className="glass-effect rounded-3xl shadow-2xl p-8 max-w-md w-full animate-float">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-20 h-20 bg-white rounded-full mb-6">
                                    <i className="fas fa-lock text-3xl text-indigo-600"></i>
                                </div>
                                <h1 className="text-3xl font-bold text-white mb-2">Quiz Python Sécurisé</h1>
                                <p className="text-indigo-100">Entrez le code d'accès pour commencer</p>
                            </div>

                            <div className="mb-6">
                                <div className="bg-yellow-500 bg-opacity-20 border-l-4 border-yellow-400 p-4 rounded-lg">
                                    <div className="flex items-center">
                                        <i className="fas fa-key text-yellow-400 mr-3 text-xl"></i>
                                        <div>
                                            <p className="font-semibold text-yellow-100">Code requis</p>
                                            <p className="text-yellow-200 text-sm">Demandez le code à votre enseignant</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-6">
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i className="fas fa-lock text-gray-400"></i>
                                    </div>
                                    <input
                                        type="password"
                                        value={accessCodeInput}
                                        onChange={(e) => setAccessCodeInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAccessCodeSubmit()}
                                        className="w-full pl-10 pr-4 py-4 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"
                                        placeholder="Entrez le code d'accès"
                                    />
                                </div>

                                <button
                                    onClick={handleAccessCodeSubmit}
                                    className="w-full bg-white text-indigo-600 py-4 rounded-xl font-bold text-lg hover:bg-gray-100 transform hover:-translate-y-1 transition-all duration-300 shadow-lg"
                                >
                                    <i className="fas fa-arrow-right mr-2"></i>
                                    Accéder au quiz
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-white border-opacity-20 text-center">
                                <p className="text-white text-opacity-70 text-sm">
                                    <i className="fas fa-shield-alt mr-1"></i>
                                    Système sécurisé avec surveillance anti-triche
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // Écran d'inscription
            if (screen === 'start') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full mb-6">
                                    <i className="fas fa-code text-3xl text-white"></i>
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">{QUIZ_CONFIG.title}</h1>
                                <p className="text-gray-600">
                                    <i className="far fa-clock mr-1"></i>
                                    50 Questions - 30 minutes
                                </p>
                            </div>

                            <div className="mb-6">
                                <div className="bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-400 p-4 rounded-lg">
                                    <div className="flex">
                                        <i className="fas fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
                                        <div>
                                            <p className="font-bold text-red-800 mb-2">⚠️ ATTENTION IMPORTANTE</p>
                                            <ul className="text-sm text-red-700 space-y-1">
                                                <li><i className="fas fa-ban mr-1"></i> Ne pas changer d'onglet</li>
                                                <li><i className="fas fa-lock mr-1"></i> Quiz bloqué en cas de changement</li>
                                                <li><i className="fas fa-minus-circle mr-1"></i> -2 points par tentative</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-5">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-user mr-2 text-indigo-500"></i>
                                        Prénom
                                    </label>
                                    <input
                                        type="text"
                                        value={studentInfo.prenom}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, prenom: e.target.value }))}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                        placeholder="Votre prénom"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-id-card mr-2 text-indigo-500"></i>
                                        Nom
                                    </label>
                                    <input
                                        type="text"
                                        value={studentInfo.nom}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, nom: e.target.value }))}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                        placeholder="Votre nom"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        <i className="fas fa-graduation-cap mr-2 text-indigo-500"></i>
                                        Classe
                                    </label>
                                    <select
                                        value={studentInfo.classe}
                                        onChange={(e) => setStudentInfo(prev => ({ ...prev, classe: e.target.value }))}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                    >
                                        <option value="">Sélectionnez votre classe</option>
                                        <option value="L2-IAGE">L2 - IAGE</option>
                                        <option value="L2-GL">L2 - GL</option>
                                    </select>
                                </div>

                                <button
                                    onClick={handleStartQuiz}
                                    className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transform hover:-translate-y-1 transition-all duration-300 shadow-lg"
                                >
                                    <i className="fas fa-play mr-2"></i>
                                    Commencer le quiz
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-gray-200 text-center">
                                <a href="admin.html" className="text-sm text-gray-500 hover:text-indigo-600 transition-colors inline-flex items-center">
                                    <i className="fas fa-user-shield mr-1"></i>
                                    Espace administration
                                </a>
                            </div>
                        </div>
                    </div>
                );
            }

            // Écran du quiz
            if (screen === 'quiz') {
                const question = QUIZ_CONFIG.questions[currentQuestion];
                const progress = ((currentQuestion + 1) / QUIZ_CONFIG.questions.length) * 100;

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                        {/* Header */}
                        <div className="bg-white shadow-lg">
                            <div className="max-w-6xl mx-auto px-4 py-4">
                                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                                            <i className="fas fa-user-graduate text-xl text-indigo-600"></i>
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">{studentInfo.prenom} {studentInfo.nom}</h2>
                                            <p className="text-gray-600">
                                                <i className="fas fa-graduation-cap mr-1"></i>
                                                {studentInfo.classe}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex items-center space-x-6">
                                        {tabSwitches > 0 && (
                                            <div className="flex items-center bg-red-50 px-4 py-2 rounded-lg">
                                                <i className="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                                <span className="font-bold text-red-600">{tabSwitches} × (-2pts)</span>
                                            </div>
                                        )}
                                        
                                        <div className={`flex items-center ${timeLeft < 300 ? 'text-red-600 animate-pulse-slow' : 'text-gray-800'}`}>
                                            <div className="w-12 h-12 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl flex items-center justify-center mr-3">
                                                <i className="far fa-clock text-xl"></i>
                                            </div>
                                            <div>
                                                <div className="text-2xl font-bold">{formatTime(timeLeft)}</div>
                                                <div className="text-xs text-gray-500">Temps restant</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Barre de progression */}
                                <div className="mt-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm text-gray-600">
                                            Question {currentQuestion + 1} sur {QUIZ_CONFIG.questions.length}
                                        </span>
                                        <span className="text-sm font-semibold text-indigo-600">
                                            <i className="fas fa-star mr-1"></i>
                                            {question.points} point(s) - {question.difficulty}
                                        </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3">
                                        <div 
                                            className="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500"
                                            style={{ width: `${progress}%` }}
                                        ></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Question */}
                        <div className="max-w-6xl mx-auto px-4 py-8">
                            <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <div className="mb-8">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-6">{question.question}</h3>
                                    
                                    <div className="code-editor rounded-xl p-6 mb-8">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center space-x-2">
                                                <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                                                <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                                <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                                            </div>
                                            <span className="text-gray-400 text-sm">
                                                <i className="fas fa-code mr-1"></i>
                                                Python Code
                                            </span>
                                        </div>
                                        <pre className="text-green-400 text-lg overflow-x-auto">{question.code}</pre>
                                    </div>
                                </div>

                                {/* Options */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {question.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleAnswer(question.id, index)}
                                            className={`p-6 rounded-xl border-2 transition-all duration-300 transform hover:-translate-y-1 ${
                                                answers[question.id] === index 
                                                    ? 'border-indigo-500 bg-indigo-50 shadow-lg' 
                                                    : 'border-gray-200 hover:border-indigo-300 hover:shadow-md'
                                            }`}
                                        >
                                            <div className="flex items-start">
                                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center mr-4 ${
                                                    answers[question.id] === index 
                                                        ? 'bg-indigo-500 text-white' 
                                                        : 'bg-gray-100 text-gray-700'
                                                }`}>
                                                    <span className="font-bold">{String.fromCharCode(65 + index)}</span>
                                                </div>
                                                <div className="flex-1 text-left">
                                                    <p className="text-lg font-medium text-gray-800">{option}</p>
                                                </div>
                                                {answers[question.id] === index && (
                                                    <i className="fas fa-check text-indigo-500 text-xl"></i>
                                                )}
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Navigation */}
                            <div className="flex justify-between">
                                <button
                                    onClick={() => setCurrentQuestion(prev => Math.max(0, prev - 1))}
                                    disabled={currentQuestion === 0}
                                    className="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center"
                                >
                                    <i className="fas fa-arrow-left mr-2"></i>
                                    Précédent
                                </button>

                                {currentQuestion < QUIZ_CONFIG.questions.length - 1 ? (
                                    <button
                                        onClick={() => setCurrentQuestion(prev => prev + 1)}
                                        className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg font-semibold hover:from-indigo-600 hover:to-purple-700 transition flex items-center"
                                    >
                                        Suivant
                                        <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                ) : (
                                    <button
                                        onClick={handleSubmitQuiz}
                                        className="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition flex items-center"
                                    >
                                        <i className="fas fa-flag-checkered mr-2"></i>
                                        Terminer le quiz
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Écran des résultats
            if (screen === 'results') {
                const score = calculateScore();
                const isPassed = parseFloat(score.noteSur20) >= 10;

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl overflow-hidden">
                                {/* Header résultats */}
                                <div className={`${isPassed ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 'bg-gradient-to-r from-red-500 to-orange-600'} text-white p-8 text-center`}>
                                    <div className="inline-flex items-center justify-center w-24 h-24 bg-white bg-opacity-20 rounded-full mb-6">
                                        <i className={`fas ${isPassed ? 'fa-trophy' : 'fa-times-circle'} text-4xl`}></i>
                                    </div>
                                    <h1 className="text-4xl font-bold mb-2">Quiz Terminé !</h1>
                                    <p className="text-white text-opacity-90">
                                        {studentInfo.prenom} {studentInfo.nom} - {studentInfo.classe}
                                    </p>
                                </div>

                                {/* Score principal */}
                                <div className="p-8 text-center">
                                    <div className="inline-flex items-baseline justify-center mb-6">
                                        <span className="text-6xl font-bold text-gray-800">{score.noteSur20}</span>
                                        <span className="text-3xl text-gray-600 ml-2">/20</span>
                                    </div>
                                    <p className="text-gray-600 text-lg mb-8">
                                        {score.correct} réponses correctes sur {score.total}
                                    </p>

                                    {score.penalty > 0 && (
                                        <div className="inline-flex items-center bg-red-50 px-6 py-3 rounded-full mb-8">
                                            <i className="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                            <span className="text-red-600 font-semibold">Pénalité : -{score.penalty} points</span>
                                        </div>
                                    )}

                                    {/* Stats détaillées */}
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
                                        <div className="bg-blue-50 p-6 rounded-xl">
                                            <div className="text-3xl font-bold text-blue-600 mb-2">{score.percentage}%</div>
                                            <div className="text-gray-600">Réussite</div>
                                        </div>
                                        <div className="bg-green-50 p-6 rounded-xl">
                                            <div className="text-3xl font-bold text-green-600 mb-2">{score.correct}</div>
                                            <div className="text-gray-600">Correctes</div>
                                        </div>
                                        <div className="bg-purple-50 p-6 rounded-xl">
                                            <div className="text-3xl font-bold text-purple-600 mb-2">{score.total - score.correct}</div>
                                            <div className="text-gray-600">Incorrectes</div>
                                        </div>
                                        <div className="bg-yellow-50 p-6 rounded-xl">
                                            <div className="text-3xl font-bold text-yellow-600 mb-2">{tabSwitches}</div>
                                            <div className="text-gray-600">Tentatives</div>
                                        </div>
                                    </div>

                                    {/* Actions */}
                                    <div className="space-y-4">
                                        <button
                                            onClick={() => setShowDetailedResults(!showDetailedResults)}
                                            className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transition flex items-center justify-center"
                                        >
                                            <i className="fas fa-chart-bar mr-2"></i>
                                            {showDetailedResults ? 'Masquer les détails' : 'Voir les détails des réponses'}
                                        </button>

                                        <button
                                            onClick={() => window.location.reload()}
                                            className="w-full bg-gray-200 text-gray-800 py-4 rounded-xl font-bold text-lg hover:bg-gray-300 transition"
                                        >
                                            <i className="fas fa-home mr-2"></i>
                                            Retour à l'accueil
                                        </button>
                                    </div>
                                </div>

                                {/* Détails des réponses */}
                                {showDetailedResults && (
                                    <div className="px-8 pb-8">
                                        <h3 className="text-2xl font-bold text-gray-800 mb-6">Détails des réponses</h3>
                                        {/* Les sections de détails restent identiques */}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PythonQuizApp />);
    </script>
</body>
</html>
