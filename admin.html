<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Quiz Python ISI Kaolack</title>
    
    <!-- React et ReactDOM (CRITIQUE : DOIT ÊTRE EN PREMIER) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            }
            50% { 
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.8);
            }
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .animate-fadeIn { 
            animation: fadeIn 0.5s ease-out; 
        }
        
        .animate-slideIn { 
            animation: slideIn 0.5s ease-out; 
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-hover {
            transition: all 0.3s ease;
        }
        
        .sidebar-hover:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
            authDomain: "quiz-python-isikm.firebaseapp.com",
            projectId: "quiz-python-isikm",
            storageBucket: "quiz-python-isikm.firebasestorage.app",
            messagingSenderId: "559369640769",
            appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ADMIN_CREDENTIALS = {
            login: 'mustafa',
            password: '14051994'
        };

        const QUIZ_CONFIG = {
            questions: [
                { id: 1, code: `x = int(4.9)\nprint(x)`, question: "Quelle est la sortie ? (conversion float vers int)", options: ["4.9", "4", "5", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 2, code: `texte = "Python"\nprint(len(texte))`, question: "Quelle est la longueur de la chaîne ?", options: ["5", "6", "7", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 3, code: `x = True\nprint(int(x))`, question: "Que retourne int(True) ?", options: ["True", "1", "0", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 4, code: `liste = [10, 20, 30]\nprint(liste[-1])`, question: "Quelle est la sortie ?", options: ["10", "30", "-1", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 5, code: `print(type(3.14))`, question: "Quel est le type de 3.14 ?", options: ["<class 'int'>", "<class 'float'>", "<class 'str'>", "<class 'decimal'>"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 6, code: `x = 10\nprint(x // 3)`, question: "Quelle est la sortie de la division entière ?", options: ["3.33", "3", "4", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 7, code: `liste = [1, 2, 3]\nliste.append(4)\nprint(len(liste))`, question: "Quelle est la longueur finale ?", options: ["3", "4", "5", "7"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 8, code: `x = "hello"\nprint(x.upper())`, question: "Quelle est la sortie ?", options: ["hello", "HELLO", "Hello", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
                { id: 9, code: `print(10 % 3)`, question: "Que retourne l'opérateur modulo ?", options: ["3", "10", "1", "0"], correct: 2, points: 1, difficulty: "Facile" },
                { id: 10, code: `x = [5, 2, 8, 1]\nprint(max(x))`, question: "Quelle est la sortie ?", options: ["5", "2", "8", "1"], correct: 2, points: 1, difficulty: "Facile" },
                { id: 11, code: `mots = "Python est super".split()\nprint(len(mots))`, question: "Combien de mots dans la liste ?", options: ["1", "2", "3", "4"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
                { id: 12, code: `x = "123"\ny = int(x)\nprint(y + 7)`, question: "Quelle est la sortie ?", options: ["1237", "130", "Erreur", "123+7"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 13, code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, question: "Que retourne le slicing ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3, 4, 5]"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 14, code: `x = "bonjour"\nprint(x[0] + x[-1])`, question: "Quelle est la sortie ?", options: ["br", "jr", "bn", "bonjourr"], correct: 0, points: 1.25, difficulty: "Assez Facile" },
                { id: 15, code: `for i in range(3):\n    print(i, end="")`, question: "Quelle est la sortie complète ?", options: ["123", "012", "0 1 2", "321"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 16, code: `x = 15\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["Pair", "Impair", "True", "False"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 17, code: `x = [1, 2, 3]\nx.extend([4, 5])\nprint(len(x))`, question: "Quelle est la longueur finale ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 18, code: `texte = "  Python  "\nprint(len(texte.strip()))`, question: "Quelle est la longueur après strip() ?", options: ["10", "8", "6", "Erreur"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
                { id: 19, code: `x = [5, 2, 8, 1]\nx.sort()\nprint(x[0])`, question: "Quel est le premier élément après tri ?", options: ["5", "2", "8", "1"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
                { id: 20, code: `print("abc" * 3)`, question: "Quelle est la sortie ?", options: ["abc3", "abcabcabc", "aaa bbb ccc", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
                { id: 21, code: `liste = [1, 2, 3, 2, 1]\nprint(liste.count(2))`, question: "Combien de fois 2 apparaît ?", options: ["1", "2", "3", "5"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 22, code: `x = 5\ny = 2\nprint(x ** y)`, question: "Que retourne l'opérateur ** (puissance) ?", options: ["7", "10", "25", "52"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 23, code: `def somme(a, b):\n    return a + b\nprint(somme(3, 4))`, question: "Quelle est la sortie ?", options: ["34", "7", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 24, code: `texte = "nom,age,ville"\nelements = texte.split(',')\nprint(len(elements))`, question: "Combien d'éléments dans la liste ?", options: ["1", "2", "3", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 25, code: `x = [1, 2, 3]\nx[1] = 10\nprint(x)`, question: "Quelle est la sortie ?", options: ["[1, 10, 3]", "[10, 2, 3]", "[1, 2, 10]", "Erreur"], correct: 0, points: 1.5, difficulty: "Moyen" },
                { id: 26, code: `liste = [1, 2]\ny = [3, 4]\nz = liste + y\nprint(len(z))`, question: "Quelle est la longueur de z ?", options: ["2", "3", "4", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
                { id: 27, code: `mots = ["a", "b", "c"]\nresultat = "-".join(mots)\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["abc", "a-b-c", "a b c", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 28, code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end=" ")`, question: "Quelle est la sortie ?", options: ["0 1 2 3 4", "0 1 3 4", "0 1 2", "3 4"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 29, code: `x = "abc"\ny = x.replace("b", "X")\nprint(y)`, question: "Quelle est la sortie ?", options: ["abc", "aXc", "Xbc", "abX"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 30, code: `x = 3\ny = 5\nx, y = y, x\nprint(x)`, question: "Que vaut x après l'échange ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
                { id: 31, code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, question: "Quelle est la valeur finale de i ?", options: ["0", "2", "3", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 32, code: `x = 5\nfor i in range(3):\n    x += i\nprint(x)`, question: "Quelle est la valeur finale de x ? (x=5, puis +0, +1, +2)", options: ["5", "6", "8", "11"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 33, code: `x = 10\nwhile x > 0:\n    x -= 3\n    if x == 4:\n        break\nprint(x)`, question: "Quelle est la valeur de x à la sortie ?", options: ["1", "4", "0", "7"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 34, code: `def test(n):\n    if n > 0:\n        return n\n    return 0\nprint(test(-5))`, question: "Quelle est la sortie ?", options: ["-5", "5", "0", "None"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 35, code: `texte = "je suis ingenieur"\nprint(texte.title())`, question: "Quelle est la sortie ?", options: ["je suis ingenieur", "Je Suis Ingenieur", "JE SUIS INGENIEUR", "Je suis ingenieur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 36, code: `liste = [5, 10, 15, 20]\nprint(liste[-2])`, question: "Quelle est la sortie avec l'index négatif ?", options: ["20", "15", "10", "5"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 37, code: `x = [1, 2, 3, 4, 5]\nprint(x[::2])`, question: "Que retourne le slicing avec pas de 2 ?", options: ["[1, 2, 3]", "[1, 3, 5]", "[2, 4]", "[1, 2]"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 38, code: `x = "123"\nprint(x * 2)`, question: "Quelle est la sortie ?", options: ["246", "123123", "6", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
                { id: 39, code: `nums = [1, 2, 3]\nprint(sum(nums) / len(nums))`, question: "Quelle est la moyenne calculée ?", options: ["1", "2", "2.0", "6"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 40, code: `x = [3, 1, 4, 1, 5]\nx.reverse()\nprint(x[0])`, question: "Quel est le premier élément après reverse() ?", options: ["3", "1", "5", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
                { id: 41, code: `for i in range(2, 10, 3):\n    print(i, end=" ")`, question: "Quelle est la sortie du range avec pas de 3 ?", options: ["2 5 8", "2 5 8 11", "3 6 9", "2 3 4"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 42, code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (référence)", options: ["3", "4", "7", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 43, code: `texte = "Python"\nprint(texte[1:4])`, question: "Que retourne ce slicing ?", options: ["Pyt", "yth", "ytho", "Pyth"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 44, code: `x = [1, 2, 3, 4, 5]\nprint(x[::-1])`, question: "Que fait le slicing avec pas -1 ?", options: ["[1, 2, 3, 4, 5]", "[5, 4, 3, 2, 1]", "[2, 4]", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 45, code: `x = "a,b,c"\ny = x.split(',')\nz = "-".join(y)\nprint(z)`, question: "Quelle transformation est effectuée ?", options: ["a,b,c", "a-b-c", "abc", "a b c"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 46, code: `x = 0\nfor i in range(4):\n    if i % 2 == 0:\n        x += i\nprint(x)`, question: "Quelle est la somme des nombres pairs ?", options: ["0", "2", "4", "6"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 47, code: `liste = [5, 2, 8, 1, 9]\nliste.sort()\nprint(liste[2])`, question: "Quel est l'élément du milieu après tri ?", options: ["8", "5", "2", "9"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 48, code: `x = "ingenieur logiciel"\ny = x.replace("logiciel", "civil")\nprint(y)`, question: "Quelle est la chaîne finale ?", options: ["ingenieur logiciel", "ingenieur civil", "civil logiciel", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
                { id: 49, code: `x = [1, 2, 3]\ny = x[:]\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (copie superficielle)", options: ["3", "4", "7", "Erreur"], correct: 0, points: 2, difficulty: "Difficile" },
                { id: 50, code: `nombres = [10, 20, 30]\nsomme = sum(nombres)\nmoyenne = somme / len(nombres)\nprint(int(moyenne))`, question: "Quelle est la moyenne convertie en entier ?", options: ["10", "15", "20", "60"], correct: 2, points: 2, difficulty: "Difficile" },
            ]
        };

        function AdminDashboard() {
            const [isAuthenticated, setIsAuthenticated] = useState(() => {
                return localStorage.getItem('adminAuthenticated') === 'true';
            });
            const [loginInput, setLoginInput] = useState('');
            const [passwordInput, setPasswordInput] = useState('');
            const [results, setResults] = useState([]);
            const [activeSessions, setActiveSessions] = useState([]);
            const [selectedStudent, setSelectedStudent] = useState(null);
            const [filter, setFilter] = useState('all');
            const [classFilter, setClassFilter] = useState('all');
            const [loading, setLoading] = useState(false);
            const [showSessions, setShowSessions] = useState(false);
            const [showDetailedAnswers, setShowDetailedAnswers] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [stats, setStats] = useState(null);

            useEffect(() => {
                if (isAuthenticated) {
                    setLoading(true);
                    const unsubscribe = db.collection('results')
                        .orderBy('timestamp', 'desc')
                        .onSnapshot((snapshot) => {
                            const resultsData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setResults(resultsData);
                            calculateStats(resultsData);
                            setLoading(false);
                        }, (error) => {
                            console.error('Erreur Firebase:', error);
                            setLoading(false);
                        });

                    return () => unsubscribe();
                }
            }, [isAuthenticated]);

            useEffect(() => {
                if (isAuthenticated) {
                    const unsubscribe = db.collection('quiz_sessions')
                        .where('status', 'in', ['started'])
                        .onSnapshot((snapshot) => {
                            const sessionsData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setActiveSessions(sessionsData);
                        });

                    return () => unsubscribe();
                }
            }, [isAuthenticated]);

            const calculateStats = (data) => {
                if (data.length === 0) return;
                
                const notes = data.map(r => parseFloat(r.note));
                const moyenne = (notes.reduce((a, b) => a + b, 0) / notes.length).toFixed(2);
                const noteMax = Math.max(...notes).toFixed(2);
                const noteMin = Math.min(...notes).toFixed(2);
                const tauxReussite = ((data.filter(r => parseFloat(r.note) >= 10).length / data.length) * 100).toFixed(2);
                const totalTriche = data.reduce((sum, r) => sum + r.tentativesTriche, 0);

                setStats({
                    total: data.length,
                    moyenne,
                    noteMax,
                    noteMin,
                    tauxReussite,
                    totalTriche,
                    totalIAGE: data.filter(r => r.classe === 'L2-IAGE').length,
                    totalGL: data.filter(r => r.classe === 'L2-GL').length,
                    totalAdmis: data.filter(r => parseFloat(r.note) >= 10).length,
                    totalEchec: data.filter(r => parseFloat(r.note) < 10).length
                });
            };

            const handleLogin = () => {
                if (loginInput === ADMIN_CREDENTIALS.login && passwordInput === ADMIN_CREDENTIALS.password) {
                    setIsAuthenticated(true);
                    localStorage.setItem('adminAuthenticated', 'true');
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Connexion réussie',
                        text: 'Bienvenue dans le tableau de bord',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Échec de connexion',
                        text: 'Identifiant ou mot de passe incorrect'
                    });
                }
            };

            const handleLogout = () => {
                Swal.fire({
                    title: 'Déconnexion',
                    text: 'Voulez-vous vraiment vous déconnecter ?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Déconnexion',
                    cancelButtonText: 'Annuler'
                }).then((result) => {
                    if (result.isConfirmed) {
                        setIsAuthenticated(false);
                        localStorage.removeItem('adminAuthenticated');
                        setResults([]);
                        setStats(null);
                    }
                });
            };

            const exportToCSV = () => {
                if (results.length === 0) {
                    Swal.fire({
                        icon: 'info',
                        title: 'Aucune donnée',
                        text: 'Il n\'y a pas de résultats à exporter'
                    });
                    return;
                }

                const csv = [
                    ['Nom', 'Classe', 'Note/20', 'Pourcentage', 'Bonnes réponses', 'Total', 'Points', 'Max points', 'Triche', 'Pénalité', 'Date'],
                    ...results.map(r => [
                        r.etudiant,
                        r.classe,
                        r.note,
                        r.pourcentage + '%',
                        r.correct,
                        r.total,
                        r.points,
                        r.maxPoints,
                        r.tentativesTriche,
                        r.penalite,
                        r.dateTest
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `resultats_quiz_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();

                Swal.fire({
                    icon: 'success',
                    title: 'Export réussi',
                    text: `${results.length} résultats exportés`,
                    timer: 2000,
                    showConfirmButton: false
                });
            };

            const clearAllResults = () => {
                Swal.fire({
                    title: 'Confirmation',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i>
                            <p class="text-xl font-semibold mb-2">Supprimer tous les résultats ?</p>
                            <p class="text-gray-600 mb-2">Cette action est irréversible</p>
                            <p class="text-sm text-gray-500">${results.length} résultats seront supprimés</p>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Supprimer tout',
                    cancelButtonText: 'Annuler',
                    reverseButtons: true
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        try {
                            const batch = db.batch();
                            const snapshot = await db.collection('results').get();
                            snapshot.docs.forEach(doc => {
                                batch.delete(doc.ref);
                            });
                            await batch.commit();
                            
                            setResults([]);
                            setStats(null);
                            setSelectedStudent(null);
                            
                            Swal.fire({
                                icon: 'success',
                                title: 'Supprimé',
                                text: 'Tous les résultats ont été supprimés',
                                timer: 2000,
                                showConfirmButton: false
                            });
                        } catch (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Erreur',
                                text: 'Impossible de supprimer les résultats'
                            });
                        }
                    }
                });
            };

            const filterResults = () => {
                let filtered = [...results];
                
                if (filter === 'passed') filtered = filtered.filter(r => parseFloat(r.note) >= 10);
                else if (filter === 'failed') filtered = filtered.filter(r => parseFloat(r.note) < 10);
                else if (filter === 'cheating') filtered = filtered.filter(r => r.tentativesTriche > 0);
                
                if (classFilter !== 'all') {
                    filtered = filtered.filter(r => r.classe === classFilter);
                }
                
                return filtered;
            };

            const filteredResults = filterResults();

            // ÉCRAN DE CONNEXION
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div className="animate-fadeIn glass-effect rounded-3xl shadow-2xl p-8 md:p-12 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-20 h-20 bg-white bg-opacity-20 rounded-full mb-6">
                                    <i className="fas fa-shield-alt text-4xl text-white"></i>
                                </div>
                                <h1 className="text-4xl font-bold text-white mb-3">Administration</h1>
                                <p className="text-white text-opacity-90 text-lg">Quiz Python ISI Kaolack</p>
                                <p className="text-white text-opacity-70">Tableau de bord sécurisé</p>
                            </div>

                            <div className="space-y-6">
                                <div>
                                    <label className="block text-sm font-semibold text-white text-opacity-90 mb-2">
                                        <i className="fas fa-user mr-2"></i>
                                        Identifiant
                                    </label>
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                            <i className="fas fa-user text-white text-opacity-50"></i>
                                        </div>
                                        <input
                                            type="text"
                                            value={loginInput}
                                            onChange={(e) => setLoginInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                            className="w-full pl-12 pr-4 py-4 bg-white bg-opacity-20 border-2 border-white border-opacity-30 rounded-xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:border-opacity-60 transition"
                                            placeholder="Votre identifiant"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-white text-opacity-90 mb-2">
                                        <i className="fas fa-key mr-2"></i>
                                        Mot de passe
                                    </label>
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                            <i className="fas fa-lock text-white text-opacity-50"></i>
                                        </div>
                                        <input
                                            type="password"
                                            value={passwordInput}
                                            onChange={(e) => setPasswordInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                            className="w-full pl-12 pr-4 py-4 bg-white bg-opacity-20 border-2 border-white border-opacity-30 rounded-xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:border-opacity-60 transition"
                                            placeholder="Votre mot de passe"
                                        />
                                    </div>
                                </div>

                                <button
                                    onClick={handleLogin}
                                    className="w-full bg-white text-indigo-600 py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 transform hover:scale-105 transition-all duration-300 shadow-xl pulse-glow"
                                >
                                    <i className="fas fa-sign-in-alt mr-2"></i>
                                    Se connecter
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-white border-opacity-20 text-center">
                                <p className="text-white text-opacity-70 text-sm flex items-center justify-center">
                                    <i className="fas fa-lock mr-2"></i>
                                    Accès réservé aux administrateurs
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // TABLEAU DE BORD
            return (
                <div className="flex min-h-screen bg-gray-50">
                    {/* SIDEBAR */}
                    <div className={`${sidebarOpen ? 'w-64' : 'w-20'} bg-gradient-to-b from-indigo-800 via-purple-800 to-purple-900 text-white transition-all duration-300 shadow-2xl`}>
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-8">
                                {sidebarOpen ? (
                                    <>
                                        <div className="flex items-center space-x-3">
                                            <div className="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                                <i className="fas fa-chart-line text-white text-2xl"></i>
                                            </div>
                                            <div>
                                                <h1 className="text-xl font-bold">Dashboard</h1>
                                                <p className="text-xs text-white text-opacity-70">Admin Panel</p>
                                            </div>
                                        </div>
                                        <button onClick={() => setSidebarOpen(false)} className="text-white hover:text-gray-300 transition">
                                            <i className="fas fa-chevron-left"></i>
                                        </button>
                                    </>
                                ) : (
                                    <button onClick={() => setSidebarOpen(true)} className="w-full flex justify-center">
                                        <i className="fas fa-chevron-right text-xl"></i>
                                    </button>
                                )}
                            </div>

                            <nav className="space-y-2">
                                <div className={`p-3 rounded-xl flex items-center space-x-3 sidebar-hover cursor-pointer ${!showSessions ? 'bg-white bg-opacity-20' : ''}`}
                                     onClick={() => setShowSessions(false)}>
                                    <i className="fas fa-chart-bar text-lg"></i>
                                    {sidebarOpen && <span className="font-medium">Statistiques</span>}
                                </div>
                                
                                <div className={`p-3 rounded-xl flex items-center space-x-3 sidebar-hover cursor-pointer ${showSessions ? 'bg-white bg-opacity-20' : ''}`}
                                     onClick={() => setShowSessions(true)}>
                                    <i className="fas fa-play-circle text-lg"></i>
                                    {sidebarOpen && (
                                        <div className="flex items-center justify-between w-full">
                                            <span className="font-medium">Sessions</span>
                                            {activeSessions.length > 0 && (
                                                <span className="bg-red-500 text-white text-xs rounded-full px-2 py-1 font-bold animate-pulse">
                                                    {activeSessions.length}
                                                </span>
                                            )}
                                        </div>
                                    )}
                                </div>

                                <div className="p-3 rounded-xl flex items-center space-x-3 sidebar-hover cursor-pointer" onClick={exportToCSV}>
                                    <i className="fas fa-file-export text-lg"></i>
                                    {sidebarOpen && <span className="font-medium">Exporter CSV</span>}
                                </div>

                                <div className="p-3 rounded-xl flex items-center space-x-3 sidebar-hover cursor-pointer text-red-300 hover:bg-red-500 hover:bg-opacity-20" onClick={clearAllResults}>
                                    <i className="fas fa-trash-alt text-lg"></i>
                                    {sidebarOpen && <span className="font-medium">Effacer tout</span>}
                                </div>

                                <div className="p-3 rounded-xl flex items-center space-x-3 sidebar-hover cursor-pointer mt-8" onClick={handleLogout}>
                                    <i className="fas fa-sign-out-alt text-lg"></i>
                                    {sidebarOpen && <span className="font-medium">Déconnexion</span>}
                                </div>
                            </nav>
                        </div>
                    </div>

                    {/* CONTENU PRINCIPAL */}
                    <div className="flex-1 overflow-x-hidden">
                        {/* HEADER */}
                        <header className="bg-white shadow-sm border-b sticky top-0 z-40">
                            <div className="px-6 py-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center">
                                            <i className="fas fa-tachometer-alt mr-3"></i>
                                            Quiz Python - Administration
                                        </h2>
                                        <p className="text-gray-600 text-sm mt-1 flex items-center">
                                            {loading ? (
                                                <>
                                                    <i className="fas fa-sync-alt mr-2 text-blue-500 animate-spin"></i>
                                                    Synchronisation...
                                                </>
                                            ) : (
                                                <>
                                                    <div className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                                                    Données en temps réel
                                                </>
                                            )}
                                        </p>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl px-6 py-3 border-2 border-indigo-200">
                                            <div className="flex items-center space-x-3">
                                                <i className="fas fa-users text-indigo-600 text-xl"></i>
                                                <div>
                                                    <div className="text-2xl font-bold text-indigo-700">{results.length}</div>
                                                    <div className="text-xs text-gray-600">Étudiants</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="text-sm text-gray-500">
                                            <i className="far fa-clock mr-1"></i>
                                            {new Date().toLocaleTimeString('fr-FR')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <main className="p-6">
                            {/* SESSIONS ACTIVES */}
                            {showSessions && activeSessions.length > 0 && (
                                <div className="mb-6 animate-fadeIn">
                                    <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl shadow-xl p-6 border-2 border-green-200">
                                        <div className="flex items-center justify-between mb-6">
                                            <div className="flex items-center space-x-4">
                                                <div className="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i className="fas fa-play-circle text-3xl text-green-600"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-2xl font-bold text-gray-800">Quiz en cours</h3>
                                                    <p className="text-gray-600">{activeSessions.length} session(s) active(s)</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2 bg-green-100 px-4 py-2 rounded-full">
                                                <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                                <span className="text-sm font-bold text-green-700">EN DIRECT</span>
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {activeSessions.map(session => (
                                                <div key={session.id} className="bg-white rounded-xl border-2 border-green-200 p-5 hover:shadow-lg transition-all">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 className="font-bold text-gray-800 text-lg">{session.etudiant}</h4>
                                                            <p className="text-sm text-gray-600 flex items-center mt-1">
                                                                <i className="fas fa-graduation-cap mr-2"></i>
                                                                {session.classe}
                                                            </p>
                                                        </div>
                                                        {session.tabSwitches > 0 && (
                                                            <span className="bg-red-100 text-red-800 text-xs font-bold px-3 py-1 rounded-full flex items-center">
                                                                <i className="fas fa-exclamation-triangle mr-1"></i>
                                                                {session.tabSwitches}
                                                            </span>
                                                        )}
                                                    </div>
                                                    <div className="flex items-center justify-between text-sm pt-3 border-t border-gray-200">
                                                        <span className="text-gray-600 flex items-center">
                                                            <i className="far fa-question-circle mr-2"></i>
                                                            Q {session.currentQuestion || 0}/50
                                                        </span>
                                                        <span className="text-indigo-600 font-semibold flex items-center">
                                                            <i className="far fa-clock mr-1"></i>
                                                            En cours
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* STATISTIQUES */}
                            {!showSessions && stats && (
                                <div className="mb-6 animate-fadeIn space-y-6">
                                    {/* Cartes statistiques principales */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        <div className="bg-white rounded-2xl shadow-xl p-6 border-2 border-blue-100 hover:shadow-2xl transition-all">
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="w-14 h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i className="fas fa-users text-3xl text-white"></i>
                                                </div>
                                                <span className="text-4xl font-bold text-blue-600">{stats.total}</span>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-800 mb-1">Total Étudiants</h3>
                                            <p className="text-gray-600 text-sm">Tous les participants</p>
                                        </div>

                                        <div className="bg-white rounded-2xl shadow-xl p-6 border-2 border-green-100 hover:shadow-2xl transition-all">
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="w-14 h-14 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i className="fas fa-chart-line text-3xl text-white"></i>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-4xl font-bold text-green-600">{stats.moyenne}</div>
                                                    <div className="text-gray-500 text-sm">/20</div>
                                                </div>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-800 mb-1">Moyenne Générale</h3>
                                            <p className="text-gray-600 text-sm">Score moyen</p>
                                        </div>

                                        <div className="bg-white rounded-2xl shadow-xl p-6 border-2 border-purple-100 hover:shadow-2xl transition-all">
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="w-14 h-14 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i className="fas fa-trophy text-3xl text-white"></i>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-4xl font-bold text-purple-600">{stats.tauxReussite}</div>
                                                    <div className="text-gray-500 text-sm">%</div>
                                                </div>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-800 mb-1">Taux de Réussite</h3>
                                            <p className="text-gray-600 text-sm">{stats.totalAdmis} admis</p>
                                        </div>

                                        <div className="bg-white rounded-2xl shadow-xl p-6 border-2 border-red-100 hover:shadow-2xl transition-all">
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="w-14 h-14 bg-gradient-to-br from-red-400 to-red-600 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i className="fas fa-exclamation-triangle text-3xl text-white"></i>
                                                </div>
                                                <span className="text-4xl font-bold text-red-600">{stats.totalTriche}</span>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-800 mb-1">Tentatives Triche</h3>
                                            <p className="text-gray-600 text-sm">Changements détectés</p>
                                        </div>
                                    </div>

                                    {/* Détails statistiques */}
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200">
                                            <h4 className="font-bold text-gray-800 mb-4 flex items-center text-lg">
                                                <i className="fas fa-user-graduate mr-3 text-blue-600 text-xl"></i>
                                                Répartition par Classe
                                            </h4>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium">L2-IAGE</span>
                                                    <span className="font-bold text-blue-600 text-xl">{stats.totalIAGE}</span>
                                                </div>
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium">L2-GL</span>
                                                    <span className="font-bold text-teal-600 text-xl">{stats.totalGL}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-2 border-green-200">
                                            <h4 className="font-bold text-gray-800 mb-4 flex items-center text-lg">
                                                <i className="fas fa-chart-pie mr-3 text-green-600 text-xl"></i>
                                                Résultats
                                            </h4>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium flex items-center">
                                                        <i className="fas fa-check-circle text-green-500 mr-2"></i>
                                                        Admis
                                                    </span>
                                                    <span className="font-bold text-green-600 text-xl">{stats.totalAdmis}</span>
                                                </div>
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium flex items-center">
                                                        <i className="fas fa-times-circle text-red-500 mr-2"></i>
                                                        Échec
                                                    </span>
                                                    <span className="font-bold text-red-600 text-xl">{stats.totalEchec}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200">
                                            <h4 className="font-bold text-gray-800 mb-4 flex items-center text-lg">
                                                <i className="fas fa-star mr-3 text-purple-600 text-xl"></i>
                                                Performances
                                            </h4>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium">Note max</span>
                                                    <span className="font-bold text-purple-600 text-xl">{stats.noteMax}/20</span>
                                                </div>
                                                <div className="flex justify-between items-center bg-white rounded-lg p-3">
                                                    <span className="text-gray-700 font-medium">Note min</span>
                                                    <span className="font-bold text-orange-600 text-xl">{stats.noteMin}/20</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* FILTRES */}
                            <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 animate-fadeIn border">
                                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                                    <div>
                                        <h3 className="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                                            <i className="fas fa-filter mr-3 text-indigo-500"></i>
                                            Filtrer les Résultats
                                        </h3>
                                        <p className="text-gray-600">Affinez l'affichage selon vos critères</p>
                                    </div>
                                    <div className="flex items-center space-x-3 bg-indigo-50 px-4 py-2 rounded-xl">
                                        <span className="text-sm font-semibold text-gray-700">{filteredResults.length} résultat(s)</span>
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <h4 className="text-sm font-bold text-gray-700 mb-3 flex items-center">
                                            <i className="fas fa-chart-pie mr-2 text-indigo-500"></i>
                                            Par statut
                                        </h4>
                                        <div className="flex flex-wrap gap-3">
                                            <button onClick={() => setFilter('all')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${filter === 'all' ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                <i className="fas fa-list mr-2"></i>
                                                Tous ({results.length})
                                            </button>
                                            <button onClick={() => setFilter('passed')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${filter === 'passed' ? 'bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                <i className="fas fa-check-circle mr-2"></i>
                                                Admis ({results.filter(r => parseFloat(r.note) >= 10).length})
                                            </button>
                                            <button onClick={() => setFilter('failed')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${filter === 'failed' ? 'bg-gradient-to-r from-red-500 to-orange-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                <i className="fas fa-times-circle mr-2"></i>
                                                Échec ({results.filter(r => parseFloat(r.note) < 10).length})
                                            </button>
                                            <button onClick={() => setFilter('cheating')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${filter === 'cheating' ? 'bg-gradient-to-r from-orange-500 to-yellow-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                <i className="fas fa-exclamation-triangle mr-2"></i>
                                                Triche ({results.filter(r => r.tentativesTriche > 0).length})
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <h4 className="text-sm font-bold text-gray-700 mb-3 flex items-center">
                                            <i className="fas fa-graduation-cap mr-2 text-indigo-500"></i>
                                            Par classe
                                        </h4>
                                        <div className="flex flex-wrap gap-3">
                                            <button onClick={() => setClassFilter('all')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${classFilter === 'all' ? 'bg-gradient-to-r from-purple-500 to-pink-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                Toutes ({results.length})
                                            </button>
                                            <button onClick={() => setClassFilter('L2-IAGE')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${classFilter === 'L2-IAGE' ? 'bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                L2-IAGE ({results.filter(r => r.classe === 'L2-IAGE').length})
                                            </button>
                                            <button onClick={() => setClassFilter('L2-GL')} 
                                                    className={`px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${classFilter === 'L2-GL' ? 'bg-gradient-to-r from-teal-500 to-green-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                                L2-GL ({results.filter(r => r.classe === 'L2-GL').length})
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* TABLEAU DES RÉSULTATS */}
                            <div className="bg-white rounded-2xl shadow-xl overflow-hidden animate-fadeIn border">
                                <div className="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
                                    <div className="flex items-center justify-between">
                                        <h3 className="text-2xl font-bold text-gray-800 flex items-center">
                                            <i className="fas fa-table mr-3 text-indigo-600"></i>
                                            Résultats Détaillés
                                        </h3>
                                        <button onClick={exportToCSV} 
                                                className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg flex items-center">
                                            <i className="fas fa-download mr-2"></i>
                                            Exporter CSV
                                        </button>
                                    </div>
                                </div>

                                {filteredResults.length === 0 ? (
                                    <div className="text-center py-16">
                                        <i className="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                                        <p className="text-gray-500 text-xl font-semibold">Aucun résultat à afficher</p>
                                        <p className="text-gray-400 text-sm mt-2">Les résultats apparaîtront ici en temps réel</p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-user mr-2"></i>Étudiant
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-graduation-cap mr-2"></i>Classe
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-star mr-2"></i>Note
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-chart-bar mr-2"></i>Performance
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-shield-alt mr-2"></i>Surveillance
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-calendar mr-2"></i>Date
                                                    </th>
                                                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                                        <i className="fas fa-cog mr-2"></i>Actions
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {filteredResults.map((result, index) => (
                                                    <tr key={index} className="hover:bg-indigo-50 transition-all">
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <div className="flex items-center">
                                                                <div className="w-10 h-10 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-full flex items-center justify-center mr-3 shadow-md">
                                                                    <i className="fas fa-user text-white"></i>
                                                                </div>
                                                                <div className="font-semibold text-gray-800">{result.etudiant}</div>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <span className={`px-4 py-2 inline-flex text-sm font-bold rounded-full ${result.classe === 'L2-IAGE' ? 'bg-blue-100 text-blue-700' : 'bg-teal-100 text-teal-700'}`}>
                                                                {result.classe}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <div className={`text-2xl font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {result.note}/20
                                                            </div>
                                                            <div className="text-xs text-gray-500 font-medium">{result.correct}/{result.total} bonnes</div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <div className="flex items-center">
                                                                <div className="flex-1">
                                                                    <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                                                        <div className="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all" 
                                                                             style={{ width: `${result.pourcentage}%` }}></div>
                                                                    </div>
                                                                    <div className="text-xs font-semibold text-gray-700 mt-1">{result.pourcentage}%</div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            {result.tentativesTriche > 0 ? (
                                                                <div className="flex items-center text-red-600 font-bold">
                                                                    <i className="fas fa-exclamation-triangle mr-2 text-xl"></i>
                                                                    <span>{result.tentativesTriche} fois</span>
                                                                </div>
                                                            ) : (
                                                                <span className="text-green-600 font-semibold flex items-center">
                                                                    <i className="fas fa-check-circle mr-2"></i>
                                                                    Aucune
                                                                </span>
                                                            )}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                                            <i className="far fa-clock mr-1"></i>
                                                            {result.dateTest}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                            <button onClick={() => setSelectedStudent(result)} 
                                                                    className="text-indigo-600 hover:text-indigo-800 font-bold flex items-center hover:underline">
                                                                <i className="fas fa-eye mr-2"></i>
                                                                Détails
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>

                    {/* MODAL DÉTAILS ÉTUDIANT */}
                    {selectedStudent && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 animate-fadeIn">
                            <div className="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-8">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h2 className="text-3xl font-bold mb-2">{selectedStudent.etudiant}</h2>
                                            <p className="text-white text-opacity-90 text-lg">{selectedStudent.classe}</p>
                                        </div>
                                        <button onClick={() => setSelectedStudent(null)} 
                                                className="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                                            <i className="fas fa-times text-2xl"></i>
                                        </button>
                                    </div>
                                </div>

                                <div className="p-8 overflow-y-auto" style={{ maxHeight: 'calc(90vh - 180px)' }}>
                                    <div className="text-center mb-8">
                                        <div className={`inline-flex items-center justify-center w-28 h-28 ${parseFloat(selectedStudent.note) >= 10 ? 'bg-gradient-to-br from-green-400 to-emerald-500' : 'bg-gradient-to-br from-red-400 to-orange-500'} rounded-full mb-4 shadow-xl`}>
                                            <div className="text-center">
                                                <div className="text-5xl font-bold text-white">{selectedStudent.note}</div>
                                                <div className="text-xl text-white opacity-90">/20</div>
                                            </div>
                                        </div>
                                        <h3 className="text-3xl font-bold text-gray-800 mb-2">Résultat Final</h3>
                                        <p className="text-gray-600 text-lg">{selectedStudent.correct} / {selectedStudent.total} réponses correctes</p>
                                    </div>

                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-2xl text-center border-2 border-blue-200">
                                            <div className="text-3xl font-bold text-blue-600 mb-1">{selectedStudent.pourcentage}%</div>
                                            <div className="text-sm text-gray-700 font-semibold">Réussite</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-green-50 to-green-100 p-5 rounded-2xl text-center border-2 border-green-200">
                                            <div className="text-3xl font-bold text-green-600 mb-1">{selectedStudent.correct}</div>
                                            <div className="text-sm text-gray-700 font-semibold">Correctes</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-5 rounded-2xl text-center border-2 border-purple-200">
                                            <div className="text-3xl font-bold text-purple-600 mb-1">{selectedStudent.duree}</div>
                                            <div className="text-sm text-gray-700 font-semibold">Durée</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-red-50 to-red-100 p-5 rounded-2xl text-center border-2 border-red-200">
                                            <div className="text-3xl font-bold text-red-600 mb-1">{selectedStudent.tentativesTriche}</div>
                                            <div className="text-sm text-gray-700 font-semibold">Triches</div>
                                        </div>
                                    </div>

                                    {showDetailedAnswers && selectedStudent.detailsReponses && (
                                        <div className="space-y-6 mb-8">
                                            <h4 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                                <i className="fas fa-list-ul mr-3 text-indigo-500"></i>
                                                Analyse Détaillée
                                            </h4>
                                            {/* Section détails des réponses ici si nécessaire */}
                                        </div>
                                    )}

                                    <div className="flex flex-col sm:flex-row gap-3 mt-6">
                                        <button onClick={() => setShowDetailedAnswers(!showDetailedAnswers)} 
                                                className="flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg flex items-center justify-center">
                                            <i className={`fas ${showDetailedAnswers ? 'fa-eye-slash' : 'fa-chart-bar'} mr-2`}></i>
                                            {showDetailedAnswers ? 'Masquer' : 'Voir'} les détails
                                        </button>
                                        <button onClick={() => {
                                            const report = `=== RAPPORT DÉTAILLÉ ===\n\nÉtudiant: ${selectedStudent.etudiant}\nClasse: ${selectedStudent.classe}\nNote: ${selectedStudent.note}/20\nRéussite: ${selectedStudent.pourcentage}%\nRéponses correctes: ${selectedStudent.correct}/${selectedStudent.total}\nDurée: ${selectedStudent.duree}\nTentatives de triche: ${selectedStudent.tentativesTriche}\nDate: ${selectedStudent.dateTest}`;
                                            const blob = new Blob([report], { type: 'text/plain;charset=utf-8;' });
                                            const url = URL.createObjectURL(blob);
                                            const a = document.createElement('a');
                                            a.href = url;
                                            a.download = `rapport_${selectedStudent.etudiant.replace(/\s+/g, '_')}.txt`;
                                            a.click();
                                        }} 
                                                className="flex-1 bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-600 hover:to-cyan-700 transition-all shadow-lg flex items-center justify-center">
                                            <i className="fas fa-file-export mr-2"></i>
                                            Exporter
                                        </button>
                                        <button onClick={() => setSelectedStudent(null)} 
                                                className="px-8 bg-gray-200 text-gray-700 py-4 rounded-xl font-bold text-lg hover:bg-gray-300 transition-all">
                                            Fermer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
