<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Quiz Python</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
      @keyframes pulse-ring {
        0% { transform: scale(0.95); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.7; }
        100% { transform: scale(0.95); opacity: 1; }
      }
      .animate-pulse-ring {
        animation: pulse-ring 2s ease-in-out infinite;
      }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
      @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      
      @keyframes pulse-ring {
        0% { transform: scale(0.95); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.7; }
        100% { transform: scale(0.95); opacity: 1; }
      }
      
      @keyframes slideIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .gradient-bg {
        background: linear-gradient(-45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
      }
      
      .float-animation { animation: float 3s ease-in-out infinite; }
      .animate-pulse-ring { animation: pulse-ring 2s ease-in-out infinite; }
      .slide-in { animation: slideIn 0.5s ease-out; }
      .code-editor { font-family: 'Fira Code', 'Consolas', 'Monaco', monospace; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // CONFIGURATION FIREBASE
        const firebaseConfig = {
          apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
          authDomain: "quiz-python-isikm.firebaseapp.com",
          projectId: "quiz-python-isikm",
          storageBucket: "quiz-python-isikm.firebasestorage.app",
          messagingSenderId: "559369640769",
          appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ADMIN_CREDENTIALS = {
          login: 'mustafa',
          password: '14051994'
        };

        // Configuration du quiz - 50 QUESTIONS (pour affichage d√©tails)
        const QUIZ_CONFIG = {
          questions: [
            { id: 1, code: `x = int(4.9)\nprint(x)`, question: "Quelle est la sortie ? (conversion float vers int)", options: ["4.9", "4", "5", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 2, code: `texte = "Python"\nprint(len(texte))`, question: "Quelle est la longueur de la cha√Æne ?", options: ["5", "6", "7", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 3, code: `x = True\nprint(int(x))`, question: "Que retourne int(True) ?", options: ["True", "1", "0", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 4, code: `liste = [10, 20, 30]\nprint(liste[-1])`, question: "Quelle est la sortie ?", options: ["10", "30", "-1", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 5, code: `print(type(3.14))`, question: "Quel est le type de 3.14 ?", options: ["<class 'int'>", "<class 'float'>", "<class 'str'>", "<class 'decimal'>"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 6, code: `x = 10\nprint(x // 3)`, question: "Quelle est la sortie de la division enti√®re ?", options: ["3.33", "3", "4", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 7, code: `liste = [1, 2, 3]\nliste.append(4)\nprint(len(liste))`, question: "Quelle est la longueur finale ?", options: ["3", "4", "5", "7"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 8, code: `x = "hello"\nprint(x.upper())`, question: "Quelle est la sortie ?", options: ["hello", "HELLO", "Hello", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
            { id: 9, code: `print(10 % 3)`, question: "Que retourne l'op√©rateur modulo ?", options: ["3", "10", "1", "0"], correct: 2, points: 1, difficulty: "Facile" },
            { id: 10, code: `x = [5, 2, 8, 1]\nprint(max(x))`, question: "Quelle est la sortie ?", options: ["5", "2", "8", "1"], correct: 2, points: 1, difficulty: "Facile" },
            { id: 11, code: `mots = "Python est super".split()\nprint(len(mots))`, question: "Combien de mots dans la liste ?", options: ["1", "2", "3", "4"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
            { id: 12, code: `x = "123"\ny = int(x)\nprint(y + 7)`, question: "Quelle est la sortie ?", options: ["1237", "130", "Erreur", "123+7"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 13, code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, question: "Que retourne le slicing ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3, 4, 5]"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 14, code: `x = "bonjour"\nprint(x[0] + x[-1])`, question: "Quelle est la sortie ?", options: ["br", "jr", "bn", "bonjourr"], correct: 0, points: 1.25, difficulty: "Assez Facile" },
            { id: 15, code: `for i in range(3):\n    print(i, end="")`, question: "Quelle est la sortie compl√®te ?", options: ["123", "012", "0 1 2", "321"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 16, code: `x = 15\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["Pair", "Impair", "True", "False"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 17, code: `x = [1, 2, 3]\nx.extend([4, 5])\nprint(len(x))`, question: "Quelle est la longueur finale ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 18, code: `texte = "  Python  "\nprint(len(texte.strip()))`, question: "Quelle est la longueur apr√®s strip() ?", options: ["10", "8", "6", "Erreur"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
            { id: 19, code: `x = [5, 2, 8, 1]\nx.sort()\nprint(x[0])`, question: "Quel est le premier √©l√©ment apr√®s tri ?", options: ["5", "2", "8", "1"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
            { id: 20, code: `print("abc" * 3)`, question: "Quelle est la sortie ?", options: ["abc3", "abcabcabc", "aaa bbb ccc", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
            { id: 21, code: `liste = [1, 2, 3, 2, 1]\nprint(liste.count(2))`, question: "Combien de fois 2 appara√Æt ?", options: ["1", "2", "3", "5"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 22, code: `x = 5\ny = 2\nprint(x ** y)`, question: "Que retourne l'op√©rateur ** (puissance) ?", options: ["7", "10", "25", "52"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 23, code: `def somme(a, b):\n    return a + b\nprint(somme(3, 4))`, question: "Quelle est la sortie ?", options: ["34", "7", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 24, code: `texte = "nom,age,ville"\nelements = texte.split(',')\nprint(len(elements))`, question: "Combien d'√©l√©ments dans la liste ?", options: ["1", "2", "3", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 25, code: `x = [1, 2, 3]\nx[1] = 10\nprint(x)`, question: "Quelle est la sortie ?", options: ["[1, 10, 3]", "[10, 2, 3]", "[1, 2, 10]", "Erreur"], correct: 0, points: 1.5, difficulty: "Moyen" },
            { id: 26, code: `liste = [1, 2]\ny = [3, 4]\nz = liste + y\nprint(len(z))`, question: "Quelle est la longueur de z ?", options: ["2", "3", "4", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
            { id: 27, code: `mots = ["a", "b", "c"]\nresultat = "-".join(mots)\nprint(resultat)`, question: "Quelle est la sortie ?", options: ["abc", "a-b-c", "a b c", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 28, code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end=" ")`, question: "Quelle est la sortie ?", options: ["0 1 2 3 4", "0 1 3 4", "0 1 2", "3 4"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 29, code: `x = "abc"\ny = x.replace("b", "X")\nprint(y)`, question: "Quelle est la sortie ?", options: ["abc", "aXc", "Xbc", "abX"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 30, code: `x = 3\ny = 5\nx, y = y, x\nprint(x)`, question: "Que vaut x apr√®s l'√©change ?", options: ["3", "5", "8", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
            { id: 31, code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, question: "Quelle est la valeur finale de i ?", options: ["0", "2", "3", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 32, code: `x = 5\nfor i in range(3):\n    x += i\nprint(x)`, question: "Quelle est la valeur finale de x ? (x=5, puis +0, +1, +2)", options: ["5", "6", "8", "11"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 33, code: `x = 10\nwhile x > 0:\n    x -= 3\n    if x == 4:\n        break\nprint(x)`, question: "Quelle est la valeur de x √† la sortie ?", options: ["1", "4", "0", "7"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 34, code: `def test(n):\n    if n > 0:\n        return n\n    return 0\nprint(test(-5))`, question: "Quelle est la sortie ?", options: ["-5", "5", "0", "None"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 35, code: `texte = "je suis ingenieur"\nprint(texte.title())`, question: "Quelle est la sortie ?", options: ["je suis ingenieur", "Je Suis Ingenieur", "JE SUIS INGENIEUR", "Je suis ingenieur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 36, code: `liste = [5, 10, 15, 20]\nprint(liste[-2])`, question: "Quelle est la sortie avec l'index n√©gatif ?", options: ["20", "15", "10", "5"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 37, code: `x = [1, 2, 3, 4, 5]\nprint(x[::2])`, question: "Que retourne le slicing avec pas de 2 ?", options: ["[1, 2, 3]", "[1, 3, 5]", "[2, 4]", "[1, 2]"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 38, code: `x = "123"\nprint(x * 2)`, question: "Quelle est la sortie ?", options: ["246", "123123", "6", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
            { id: 39, code: `nums = [1, 2, 3]\nprint(sum(nums) / len(nums))`, question: "Quelle est la moyenne calcul√©e ?", options: ["1", "2", "2.0", "6"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 40, code: `x = [3, 1, 4, 1, 5]\nx.reverse()\nprint(x[0])`, question: "Quel est le premier √©l√©ment apr√®s reverse() ?", options: ["3", "1", "5", "4"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
            { id: 41, code: `for i in range(2, 10, 3):\n    print(i, end=" ")`, question: "Quelle est la sortie du range avec pas de 3 ?", options: ["2 5 8", "2 5 8 11", "3 6 9", "2 3 4"], correct: 0, points: 2, difficulty: "Difficile" },
            { id: 42, code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (r√©f√©rence)", options: ["3", "4", "7", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 43, code: `texte = "Python"\nprint(texte[1:4])`, question: "Que retourne ce slicing ?", options: ["Pyt", "yth", "ytho", "Pyth"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 44, code: `x = [1, 2, 3, 4, 5]\nprint(x[::-1])`, question: "Que fait le slicing avec pas -1 ?", options: ["[1, 2, 3, 4, 5]", "[5, 4, 3, 2, 1]", "[2, 4]", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 45, code: `x = "a,b,c"\ny = x.split(',')\nz = "-".join(y)\nprint(z)`, question: "Quelle transformation est effectu√©e ?", options: ["a,b,c", "a-b-c", "abc", "a b c"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 46, code: `x = 0\nfor i in range(4):\n    if i % 2 == 0:\n        x += i\nprint(x)`, question: "Quelle est la somme des nombres pairs ?", options: ["0", "2", "4", "6"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 47, code: `liste = [5, 2, 8, 1, 9]\nliste.sort()\nprint(liste[2])`, question: "Quel est l'√©l√©ment du milieu apr√®s tri ?", options: ["8", "5", "2", "9"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 48, code: `x = "ingenieur logiciel"\ny = x.replace("logiciel", "civil")\nprint(y)`, question: "Quelle est la cha√Æne finale ?", options: ["ingenieur logiciel", "ingenieur civil", "civil logiciel", "Erreur"], correct: 1, points: 2, difficulty: "Difficile" },
            { id: 49, code: `x = [1, 2, 3]\ny = x[:]\ny.append(4)\nprint(len(x))`, question: "Quelle est la longueur de x ? (copie superficielle)", options: ["3", "4", "7", "Erreur"], correct: 0, points: 2, difficulty: "Difficile" },
            { id: 50, code: `nombres = [10, 20, 30]\nsomme = sum(nombres)\nmoyenne = somme / len(nombres)\nprint(int(moyenne))`, question: "Quelle est la moyenne convertie en entier ?", options: ["10", "15", "20", "60"], correct: 2, points: 2, difficulty: "Difficile" },
          ]
        };

        function AdminDashboard() {
          const [isAuthenticated, setIsAuthenticated] = useState(() => {
            return localStorage.getItem('adminAuthenticated') === 'true';
          });
          const [loginInput, setLoginInput] = useState('');
          const [passwordInput, setPasswordInput] = useState('');
          const [results, setResults] = useState([]);
          const [activeSessions, setActiveSessions] = useState([]);
          const [selectedStudent, setSelectedStudent] = useState(null);
          const [filter, setFilter] = useState('all');
          const [classFilter, setClassFilter] = useState('all');
          const [loading, setLoading] = useState(false);
          const [showSessions, setShowSessions] = useState(false);
          const [showDetailedAnswers, setShowDetailedAnswers] = useState(false);

          // ECOUTER LES RESULTATS FINAUX
          useEffect(() => {
            if (isAuthenticated) {
              setLoading(true);
              const unsubscribe = db.collection('results')
                .orderBy('timestamp', 'desc')
                .onSnapshot((snapshot) => {
                  const resultsData = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                  }));
                  setResults(resultsData);
                  setLoading(false);
                }, (error) => {
                  console.error('Erreur Firebase:', error);
                  setLoading(false);
                });

              return () => unsubscribe();
            }
          }, [isAuthenticated]);

          // ECOUTER LES SESSIONS ACTIVES EN TEMPS REEL
          useEffect(() => {
            if (isAuthenticated) {
              const unsubscribe = db.collection('quiz_sessions')
                .where('status', 'in', ['started'])
                .onSnapshot((snapshot) => {
                  const sessionsData = [];
                  
                  snapshot.docChanges().forEach((change) => {
                    const session = { id: change.doc.id, ...change.doc.data() };
                    
                    if (change.type === 'added') {
                      // NOUVEAU QUIZ COMMENCE
                      const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 5000,
                        timerProgressBar: true
                      });
                      
                      Toast.fire({
                        icon: 'info',
                        title: 'üéØ Quiz commenc√©',
                        html: `<strong>${session.etudiant}</strong><br/>${session.classe}`
                      });
                    }
                    
                    if (change.type === 'modified') {
                      // CHANGEMENT D'ONGLET DETECTE
                      if (session.tabSwitches > 0 && session.lastWarning) {
                        const Toast = Swal.mixin({
                          toast: true,
                          position: 'top-end',
                          showConfirmButton: false,
                          timer: 8000,
                          timerProgressBar: true
                        });
                        
                        Toast.fire({
                          icon: 'warning',
                          title: '‚ö†Ô∏è TRICHE DETECTEE',
                          html: `
                            <div class="text-left">
                              <p><strong>${session.etudiant}</strong></p>
                              <p class="text-sm">${session.classe}</p>
                              <p class="text-red-600 font-bold mt-2">${session.tabSwitches} changement(s) d'onglet</p>
                              <p class="text-xs text-gray-600 mt-1">${session.lastWarning}</p>
                            </div>
                          `
                        });
                      }
                    }
                  });

                  // Mettre √† jour la liste des sessions actives
                  const currentSessions = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                  }));
                  setActiveSessions(currentSessions);
                }, (error) => {
                  console.error('Erreur sessions:', error);
                });

              return () => unsubscribe();
            }
          }, [isAuthenticated]);

          const handleLogin = () => {
            if (loginInput === ADMIN_CREDENTIALS.login && passwordInput === ADMIN_CREDENTIALS.password) {
              setIsAuthenticated(true);
              localStorage.setItem('adminAuthenticated', 'true');
              setLoginInput('');
              setPasswordInput('');
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'success',
                title: 'Connexion r√©ussie !',
                text: 'Surveillance en temps r√©el activ√©e'
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Echec de connexion',
                text: 'Identifiant ou mot de passe incorrect.',
                confirmButtonColor: '#DC2626'
              });
            }
          };

          const handleLogout = async () => {
            const result = await Swal.fire({
              icon: 'question',
              title: 'D√©connexion',
              text: 'Voulez-vous vraiment vous d√©connecter ?',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, d√©connecter',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              setIsAuthenticated(false);
              localStorage.removeItem('adminAuthenticated');
              setSelectedStudent(null);
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'info',
                title: 'D√©connect√© avec succ√®s'
              });
            }
          };

          const clearAllResults = async () => {
            const result = await Swal.fire({
              icon: 'warning',
              title: 'Etes-vous s√ªr ?',
              html: '<p>Supprimer <strong>TOUS</strong> les r√©sultats ?</p><p class="text-red-600 font-semibold mt-2">Action IRREVERSIBLE !</p>',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, tout supprimer',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              try {
                const batch = db.batch();
                const snapshot = await db.collection('results').get();
                snapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
                
                setSelectedStudent(null);
                
                Swal.fire({
                  icon: 'success',
                  title: 'Supprim√© !',
                  text: 'Tous les r√©sultats ont √©t√© supprim√©s.',
                  confirmButtonColor: '#10B981'
                });
              } catch (error) {
                Swal.fire({
                  icon: 'error',
                  title: 'Erreur',
                  text: 'Impossible de supprimer les r√©sultats.',
                  confirmButtonColor: '#DC2626'
                });
              }
            }
          };

          const exportToCSV = () => {
            if (results.length === 0) {
              Swal.fire({
                icon: 'info',
                title: 'Aucun r√©sultat',
                text: 'Il n\'y a aucun r√©sultat √† exporter.',
                confirmButtonColor: '#4F46E5'
              });
              return;
            }

            const csv = [
              ['Nom Complet', 'Classe', 'Note/20', 'Pourcentage', 'Bonnes R√©ponses', 'Total Questions', 'Points Obtenus', 'Points Max', 'Tentatives Triche', 'P√©nalit√©', 'Date', 'Dur√©e'],
              ...results.map(r => [
                r.etudiant,
                r.classe,
                r.note,
                r.pourcentage + '%',
                r.correct,
                r.total,
                r.points,
                r.maxPoints,
                r.tentativesTriche,
                r.penalite,
                r.dateTest,
                r.duree
              ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `resultats_quiz_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: `${results.length} r√©sultat(s) export√©(s) !`
            });
          };

          const exportDetailedReport = (student) => {
            const report = `
==============================================
RAPPORT DETAILLE - QUIZ PYTHON
==============================================

INFORMATIONS ETUDIANT
------------------------------
Nom complet : ${student.etudiant}
Classe : ${student.classe}
Date du test : ${student.dateTest}
Dur√©e du test : ${student.duree}

RESULTATS
------------------------------
Note finale : ${student.note}/20
Pourcentage de r√©ussite : ${student.pourcentage}%
R√©ponses correctes : ${student.correct}/${student.total}
Points obtenus : ${student.points}/${student.maxPoints}

SYSTEME ANTI-TRICHE
------------------------------
Tentatives d√©tect√©es : ${student.tentativesTriche}
P√©nalit√© appliqu√©e : -${student.penalite} points

${student.tentativesTriche > 0 ? `AVERTISSEMENTS ENREGISTRES :
${student.avertissements.map((w, i) => `${i + 1}. ${w}`).join('\n')}` : 'Aucun avertissement - Test effectu√© correctement'}

DETAIL DES REPONSES
------------------------------
${student.detailsReponses ? student.detailsReponses.map((d) => 
  `Question ${d.question} (${d.difficulte}) : ${d.estCorrecte ? '‚úÖ CORRECT' : '‚ùå INCORRECT'} - ${d.points} pts`
).join('\n') : 'D√©tails non disponibles'}

==============================================
Rapport g√©n√©r√© le ${new Date().toLocaleString('fr-FR')}
==============================================
            `.trim();

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `rapport_${student.etudiant.replace(/\s/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: 'Rapport t√©l√©charg√© !'
            });
          };

          const getStatistics = () => {
            if (results.length === 0) return null;

            const notes = results.map(r => parseFloat(r.note));
            const moyenne = (notes.reduce((a, b) => a + b, 0) / notes.length).toFixed(2);
            const noteMax = Math.max(...notes).toFixed(2);
            const noteMin = Math.min(...notes).toFixed(2);
            const tauxReussite = ((results.filter(r => parseFloat(r.note) >= 10).length / results.length) * 100).toFixed(2);
            const totalTriche = results.reduce((sum, r) => sum + r.tentativesTriche, 0);

            return {
              total: results.length,
              moyenne,
              noteMax,
              noteMin,
              tauxReussite,
              totalTriche,
              totalIAGE: results.filter(r => r.classe === 'L2-IAGE').length,
              totalGL: results.filter(r => r.classe === 'L2-GL').length
            };
          };

          const filterResults = () => {
            let filtered = results;
            
            if (filter === 'passed') filtered = filtered.filter(r => parseFloat(r.note) >= 10);
            else if (filter === 'failed') filtered = filtered.filter(r => parseFloat(r.note) < 10);
            else if (filter === 'cheating') filtered = filtered.filter(r => r.tentativesTriche > 0);
            
            if (classFilter !== 'all') {
              filtered = filtered.filter(r => r.classe === classFilter);
            }
            
            return filtered;
          };

          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-gray-900 to-indigo-900 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full">
                  <div className="text-center mb-8">
                    <svg className="w-12 h-12 sm:w-16 sm:h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Administration</h1>
                    <p className="text-sm sm:text-base text-gray-600">Tableau de bord - Quiz Python</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Identifiant</label>
                      <input
                        type="text"
                        value={loginInput}
                        onChange={(e) => setLoginInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre identifiant"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                      <input
                        type="password"
                        value={passwordInput}
                        onChange={(e) => setPasswordInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre mot de passe"
                      />
                    </div>

                    <button
                      onClick={handleLogin}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg"
                    >
                      Se connecter
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          const stats = getStatistics();
          const filteredResults = filterResults();

          return (
            <div className="min-h-screen bg-gray-50 p-3 sm:p-6">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                  <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                      <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">Tableau de Bord Admin</h1>
                      <p className="text-sm sm:text-base text-gray-600 flex items-center gap-2">
                        Quiz Python - L2 
                        {loading && <span className="text-green-600 text-xs">üîÑ Synchro...</span>}
                      </p>
                    </div>
                    <div className="flex gap-2 w-full sm:w-auto">
                      <button
                        onClick={() => setShowSessions(!showSessions)}
                        className="flex-1 sm:flex-none relative px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"
                      >
                        {activeSessions.length > 0 && (
                          <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center animate-pulse-ring">
                            {activeSessions.length}
                          </span>
                        )}
                        üéØ En cours
                      </button>
                      <button
                        onClick={handleLogout}
                        className="flex-1 sm:flex-none px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm sm:text-base"
                      >
                        D√©connexion
                      </button>
                    </div>
                  </div>
                </div>

                {/* Sessions actives */}
                {showSessions && activeSessions.length > 0 && (
                  <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                    <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                      <span className="w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></span>
                      Quiz en cours ({activeSessions.length})
                    </h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                      {activeSessions.map(session => (
                        <div key={session.id} className="border-2 border-green-500 rounded-lg p-3 sm:p-4 bg-green-50">
                          <p className="font-bold text-gray-800 text-sm sm:text-base">{session.etudiant}</p>
                          <p className="text-xs sm:text-sm text-gray-600">{session.classe}</p>
                          <div className="mt-2 flex items-center justify-between text-xs">
                            <span className="text-gray-600">
                              Question {session.currentQuestion || 0}/50
                            </span>
                            {session.tabSwitches > 0 && (
                              <span className="text-red-600 font-bold">
                                ‚ö†Ô∏è {session.tabSwitches}
                              </span>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Statistiques */}
                {stats && (
                  <div className="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Total</p>
                      <p className="text-xl sm:text-2xl font-bold text-indigo-600">{stats.total}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">L2-IAGE</p>
                      <p className="text-xl sm:text-2xl font-bold text-blue-600">{stats.totalIAGE}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">L2-GL</p>
                      <p className="text-xl sm:text-2xl font-bold text-teal-600">{stats.totalGL}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Moyenne</p>
                      <p className="text-xl sm:text-2xl font-bold text-purple-600">{stats.moyenne}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Note max</p>
                      <p className="text-xl sm:text-2xl font-bold text-green-600">{stats.noteMax}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Note min</p>
                      <p className="text-xl sm:text-2xl font-bold text-orange-600">{stats.noteMin}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">R√©ussite</p>
                      <p className="text-xl sm:text-2xl font-bold text-emerald-600">{stats.tauxReussite}%</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Triches</p>
                      <p className="text-xl sm:text-2xl font-bold text-red-600">{stats.totalTriche}</p>
                    </div>
                  </div>
                )}

                {/* Filtres */}
                <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                  <div className="space-y-4">
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par statut :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setFilter('all')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Tous ({results.length})
                        </button>
                        <button onClick={() => setFilter('passed')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'passed' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Admis ({results.filter(r => parseFloat(r.note) >= 10).length})
                        </button>
                        <button onClick={() => setFilter('failed')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'failed' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Echec ({results.filter(r => parseFloat(r.note) < 10).length})
                        </button>
                        <button onClick={() => setFilter('cheating')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'cheating' ? 'bg-orange-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Triche ({results.filter(r => r.tentativesTriche > 0).length})
                        </button>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par classe :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setClassFilter('all')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Toutes ({results.length})
                        </button>
                        <button onClick={() => setClassFilter('L2-IAGE')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'L2-IAGE' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          L2-IAGE ({results.filter(r => r.classe === 'L2-IAGE').length})
                        </button>
                        <button onClick={() => setClassFilter('L2-GL')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'L2-GL' ? 'bg-teal-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          L2-GL ({results.filter(r => r.classe === 'L2-GL').length})
                        </button>
                      </div>
                    </div>

                    <div className="flex flex-col sm:flex-row justify-end gap-2 pt-2 border-t">
                      <button onClick={exportToCSV} className="flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Exporter CSV
                      </button>
                      <button onClick={clearAllResults} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">
                        Effacer tout
                      </button>
                    </div>
                  </div>
                </div>

                {/* Liste des r√©sultats - Version mobile simplifi√©e */}
                {filteredResults.length === 0 ? (
                  <div className="bg-white rounded-lg shadow-md p-8 sm:p-12 text-center">
                    <p className="text-lg sm:text-xl text-gray-600">Aucun r√©sultat</p>
                    <p className="text-sm sm:text-base text-gray-500 mt-2">Les r√©sultats appara√Ætront ici en temps r√©el</p>
                  </div>
                ) : (
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    {/* Vue mobile */}
                    <div className="block sm:hidden">
                      {filteredResults.map((result, index) => (
                        <div key={result.id || index} className="border-b p-4">
                          <div className="flex justify-between items-start mb-2">
                            <div>
                              <p className="font-bold text-gray-800">{result.etudiant}</p>
                              <p className="text-sm text-gray-600">{result.classe}</p>
                            </div>
                            <p className={`text-2xl font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                              {result.note}/20
                            </p>
                          </div>
                          <div className="flex justify-between items-center">
                            <span className={`px-3 py-1 text-xs rounded-full ${parseFloat(result.note) >= 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                              {parseFloat(result.note) >= 10 ? 'Admis' : 'Echec'}
                            </span>
                            <button onClick={() => setSelectedStudent(result)} className="text-indigo-600 text-sm font-medium">
                              D√©tails ‚Üí
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Vue desktop - tableau complet */}
                    <div className="hidden sm:block overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Etudiant</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Classe</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Note</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">R√©ussite</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Triche</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {filteredResults.map((result, index) => (
                            <tr key={result.id || index} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm font-medium text-gray-900">{result.etudiant}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm text-gray-600">{result.classe}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className={`text-lg font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                                  {result.note}/20
                                </div>
                                <div className="text-xs text-gray-500">{result.correct}/{result.total} correct</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <span className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${parseFloat(result.note) >= 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                  {parseFloat(result.note) >= 10 ? 'Admis' : 'Echec'}
                                </span>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {result.tentativesTriche > 0 ? (
                                  <div className="flex items-center text-red-600">
                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    <span className="font-semibold">{result.tentativesTriche}</span>
                                  </div>
                                ) : (
                                  <span className="text-green-600">‚úÖ</span>
                                )}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{result.dateTest}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm">
                                <button onClick={() => setSelectedStudent(result)} className="flex items-center gap-1 text-indigo-600 hover:text-indigo-900 font-medium">
                                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                  </svg>
                                  D√©tails
                                </button>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* Modal d√©tails */}
                {selectedStudent && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                      <div className="sticky top-0 bg-white border-b p-4 sm:p-6">
                        <div className="flex justify-between items-start">
                          <div>
                            <h2 className="text-xl sm:text-2xl font-bold text-gray-800">{selectedStudent.etudiant}</h2>
                            <p className="text-sm sm:text-base text-gray-600">{selectedStudent.classe}</p>
                          </div>
                          <button onClick={() => {
                            setSelectedStudent(null);
                            setShowDetailedAnswers(false);
                          }} className="text-gray-400 hover:text-gray-600">
                            <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                          </button>
                        </div>
                      </div>

                      <div className="p-4 sm:p-6">
                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6 mb-6">
                          <div className="text-center">
                            <p className="text-sm opacity-90 mb-2">Note Finale</p>
                            <p className="text-5xl sm:text-6xl font-bold mb-2">{selectedStudent.note}/20</p>
                            <p className="text-sm opacity-90">{selectedStudent.correct}/{selectedStudent.total} bonnes r√©ponses</p>
                            {selectedStudent.penalite > 0 && (
                              <p className="text-sm mt-2 bg-red-500 bg-opacity-30 py-2 px-4 rounded">
                                P√©nalit√© : -{selectedStudent.penalite} points
                              </p>
                            )}
                          </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-6">
                          <div className="bg-blue-50 p-4 rounded-lg">
                            <p className="text-xs sm:text-sm text-gray-600">Points obtenus</p>
                            <p className="text-lg sm:text-xl font-bold text-blue-600">{selectedStudent.points}/{selectedStudent.maxPoints}</p>
                          </div>
                          <div className="bg-green-50 p-4 rounded-lg">
                            <p className="text-xs sm:text-sm text-gray-600">Pourcentage</p>
                            <p className="text-lg sm:text-xl font-bold text-green-600">{selectedStudent.pourcentage}%</p>
                          </div>
                          <div className="bg-purple-50 p-4 rounded-lg">
                            <p className="text-xs sm:text-sm text-gray-600">Dur√©e</p>
                            <p className="text-lg sm:text-xl font-bold text-purple-600">{selectedStudent.duree}</p>
                          </div>
                          <div className="bg-red-50 p-4 rounded-lg">
                            <p className="text-xs sm:text-sm text-gray-600">Tentatives triche</p>
                            <p className="text-lg sm:text-xl font-bold text-red-600">{selectedStudent.tentativesTriche}</p>
                          </div>
                        </div>

                        {selectedStudent.tentativesTriche > 0 && (
                          <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                            <p className="font-semibold text-yellow-700 mb-2 flex items-center text-sm">
                              <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                              </svg>
                              Avertissements :
                            </p>
                            <ul className="text-xs sm:text-sm text-yellow-600 space-y-1">
                              {selectedStudent.avertissements.map((warning, idx) => (
                                <li key={idx}>‚Ä¢ {warning}</li>
                              ))}
                            </ul>
                          </div>
                        )}

                        <div className="flex flex-col sm:flex-row gap-3">
                          <button onClick={() => setShowDetailedAnswers(!showDetailedAnswers)} className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm sm:text-base">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            {showDetailedAnswers ? 'Masquer' : 'Voir'} les d√©tails
                          </button>
                          <button onClick={() => exportDetailedReport(selectedStudent)} className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm sm:text-base">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Rapport
                          </button>
                          <button onClick={() => {
                            setSelectedStudent(null);
                            setShowDetailedAnswers(false);
                          }} className="px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm sm:text-base">
                            Fermer
                          </button>
                        </div>

                        {/* D√©tails des r√©ponses */}
                        {showDetailedAnswers && selectedStudent.detailsReponses && (
                          <div className="mt-6 space-y-4">
                            {/* Questions correctes */}
                            {(() => {
                              const correctQuestions = selectedStudent.detailsReponses.filter(d => d.estCorrecte);
                              if (correctQuestions.length === 0) return null;
                              return (
                                <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                                  <h3 className="text-lg font-bold text-green-600 mb-4 flex items-center gap-2">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    R√©ponses Correctes ({correctQuestions.length})
                                  </h3>
                                  <div className="space-y-3">
                                    {correctQuestions.map((detail) => {
                                      const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                                      if (!q) return null;
                                      return (
                                        <div key={detail.question} className="bg-white border-l-4 border-green-500 p-3 sm:p-4 rounded">
                                          <div className="flex justify-between items-start mb-2">
                                            <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                            <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">{q.points} pts</span>
                                          </div>
                                          <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                          <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                            <pre>{q.code}</pre>
                                          </div>
                                          <div className="flex items-center gap-2 text-green-700 text-sm">
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            <span className="font-semibold">{q.options[q.correct]}</span>
                                          </div>
                                        </div>
                                      );
                                    })}
                                  </div>
                                </div>
                              );
                            })()}

                            {/* Questions incorrectes */}
                            {(() => {
                              const incorrectQuestions = selectedStudent.detailsReponses.filter(d => !d.estCorrecte && d.reponse !== -1);
                              if (incorrectQuestions.length === 0) return null;
                              return (
                                <div className="bg-red-50 rounded-lg p-4 border-2 border-red-200">
                                  <h3 className="text-lg font-bold text-red-600 mb-4 flex items-center gap-2">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    R√©ponses Incorrectes ({incorrectQuestions.length})
                                  </h3>
                                  <div className="space-y-3">
                                    {incorrectQuestions.map((detail) => {
                                      const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                                      if (!q) return null;
                                      return (
                                        <div key={detail.question} className="bg-white border-l-4 border-red-500 p-3 sm:p-4 rounded">
                                          <div className="flex justify-between items-start mb-2">
                                            <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                            <span className="text-xs bg-red-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                          </div>
                                          <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                          <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                            <pre>{q.code}</pre>
                                          </div>
                                          <div className="space-y-2">
                                            <div className="flex items-center gap-2 text-red-700 text-sm">
                                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                              </svg>
                                              <div>
                                                <span className="font-semibold">R√©ponse donn√©e : </span>
                                                <span>{q.options[detail.reponse]}</span>
                                              </div>
                                            </div>
                                            <div className="flex items-center gap-2 text-green-700 text-sm">
                                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                              </svg>
                                              <div>
                                                <span className="font-semibold">Bonne r√©ponse : </span>
                                                <span>{q.options[q.correct]}</span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      );
                                    })}
                                  </div>
                                </div>
                              );
                            })()}

                            {/* Questions non r√©pondues */}
                            {(() => {
                              const unansweredQuestions = selectedStudent.detailsReponses.filter(d => d.reponse === -1);
                              if (unansweredQuestions.length === 0) return null;
                              return (
                                <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-300">
                                  <h3 className="text-lg font-bold text-gray-600 mb-4 flex items-center gap-2">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Questions Non R√©pondues ({unansweredQuestions.length})
                                  </h3>
                                  <div className="space-y-3">
                                    {unansweredQuestions.map((detail) => {
                                      const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                                      if (!q) return null;
                                      return (
                                        <div key={detail.question} className="bg-white border-l-4 border-gray-400 p-3 sm:p-4 rounded">
                                          <div className="flex justify-between items-start mb-2">
                                            <p className="font-semibold text-gray-800 text-sm sm:text-base">Question {q.id}</p>
                                            <span className="text-xs bg-gray-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                          </div>
                                          <p className="text-xs sm:text-sm text-gray-700 mb-2">{q.question}</p>
                                          <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                            <pre>{q.code}</pre>
                                          </div>
                                          <div className="flex items-center gap-2 text-green-700 text-sm">
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            <div>
                                              <span className="font-semibold">Bonne r√©ponse : </span>
                                              <span>{q.options[q.correct]}</span>
                                            </div>
                                          </div>
                                        </div>
                                      );
                                    })}
                                  </div>
                                </div>
                              );
                            })()}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
