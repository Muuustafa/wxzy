<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Quiz Python ISI Keur Massar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .gradient-bg {
      background: linear-gradient(-45deg, #1e3a8a, #3b82f6, #06b6d4, #8b5cf6);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }
    .code-block {
      background: #1e293b;
      color: #10b981;
      font-family: 'Courier New', monospace;
      padding: 0.75rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      font-size: 0.75rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyCcWSHWLTFPE3ixU6PBNL3jGmcbI4FoMuo",
      authDomain: "quizpython-8d65a.firebaseapp.com",
      databaseURL: "https://quizpython-8d65a-default-rtdb.firebaseio.com",
      projectId: "quizpython-8d65a",
      storageBucket: "quizpython-8d65a.firebasestorage.app",
      messagingSenderId: "297624690086",
      appId: "1:297624690086:web:3ecae0b3da6ad3aa2e906e"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    const ADMIN_CREDENTIALS = {
      login: 'mustafa',
      password: '14051994'
    };

    // LES 50 QUESTIONS (identiques à index.html)
    const QUIZ_CONFIG = {
      questions: [
        { id: 1, code: `x = 10\ny = 20\nprint(x + y)`, question: "Quelle est la sortie de ce code ?", options: ["1020", "30", "Erreur", "xy"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Variables" },
        { id: 2, code: `nom = "Python"\nprint(type(nom))`, question: "Quelle est la sortie de ce code ?", options: ["<class 'int'>", "<class 'str'>", "str", "string"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Types" },
        { id: 3, code: `liste = [1, 2, 3, 4, 5]\nprint(len(liste))`, question: "Quelle est la sortie de ce code ?", options: ["4", "5", "15", "Erreur"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Listes" },
        { id: 4, code: `x = 15\nprint(x % 4)`, question: "Quelle est la sortie de ce code ?", options: ["3", "3.75", "4", "0"], correct: 0, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Opérateurs" },
        { id: 5, code: `texte = "PYTHON"\nprint(texte.lower())`, question: "Quelle est la sortie de ce code ?", options: ["PYTHON", "python", "Python", "pYTHON"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Méthodes string" },
        { id: 6, code: `x = 7\nif x > 5:\n    print("Oui")`, question: "Quelle est la sortie de ce code ?", options: ["Oui", "Non", "7", "Rien"], correct: 0, points: 1, difficulty: "Facile", chapitre: "Chapitre 2 - if" },
        { id: 7, code: `print(10 - 7)`, question: "Quelle est la sortie de ce code ?", options: ["17", "3", "10", "-7"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Opérations" },
        { id: 8, code: `x = True\nprint(x)`, question: "Quelle est la sortie de ce code ?", options: ["1", "True", "true", "Vrai"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Booléens" },
        { id: 9, code: `liste = [10, 20, 30]\nprint(liste[0])`, question: "Quelle est la sortie de ce code ?", options: ["0", "10", "20", "[10]"], correct: 1, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Indexation" },
        { id: 10, code: `x = 3\ny = 4\nprint(x * y)`, question: "Quelle est la sortie de ce code ?", options: ["34", "7", "12", "Erreur"], correct: 2, points: 1, difficulty: "Facile", chapitre: "Chapitre 1 - Multiplication" },
        { id: 11, code: `for i in range(3):\n    print(i, end=" ")`, question: "Quelle est la sortie de ce code ?", options: ["1 2 3", "0 1 2", "0 1 2 3", "1 2"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 2 - Boucle for" },
        { id: 12, code: `x = "Hello"\ny = "World"\nprint(x + " " + y)`, question: "Quelle est la sortie de ce code ?", options: ["HelloWorld", "Hello World", "Hello+World", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Concaténation" },
        { id: 13, code: `liste = [5, 2, 8, 1]\nliste.sort()\nprint(liste)`, question: "Quelle est la sortie de ce code ?", options: ["[5, 2, 8, 1]", "[1, 2, 5, 8]", "[8, 5, 2, 1]", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Méthode sort" },
        { id: 14, code: `x = 17\nprint(x // 5)`, question: "Quelle est la sortie de ce code ?", options: ["3.4", "3", "4", "2"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Division entière" },
        { id: 15, code: `x = 10\nif x > 20:\n    print("A")\nelse:\n    print("B")`, question: "Quelle est la sortie de ce code ?", options: ["A", "B", "AB", "Rien"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 2 - if/else" },
        { id: 16, code: `texte = "python"\nprint(texte.upper())`, question: "Quelle est la sortie de ce code ?", options: ["python", "PYTHON", "Python", "pYTHON"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Méthode upper" },
        { id: 17, code: `x = [1, 2, 3]\nx.append(4)\nprint(len(x))`, question: "Quelle est la sortie de ce code ?", options: ["3", "4", "7", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Méthode append" },
        { id: 18, code: `i = 0\nwhile i < 3:\n    i += 1\nprint(i)`, question: "Quelle est la sortie de ce code ?", options: ["0", "2", "3", "4"], correct: 2, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 2 - Boucle while" },
        { id: 19, code: `x = 5 < 10\nprint(x)`, question: "Quelle est la sortie de ce code ?", options: ["False", "True", "5", "10"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 2 - Comparaison" },
        { id: 20, code: `texte = "Bonjour"\nprint(len(texte))`, question: "Quelle est la sortie de ce code ?", options: ["6", "7", "8", "Erreur"], correct: 1, points: 1.25, difficulty: "Assez Facile", chapitre: "Chapitre 1 - Fonction len" },
        { id: 21, code: `liste = [1, 2, 3, 4, 5]\nprint(liste[1:4])`, question: "Quelle est la sortie de ce code ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3]"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Slicing" },
        { id: 22, code: `phrase = "apprendre python"\nmots = phrase.split()\nprint(len(mots))`, question: "Quelle est la sortie de ce code ?", options: ["1", "2", "16", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Méthode split" },
        { id: 23, code: `x = 5\ny = 2\nprint(x ** y)`, question: "Quelle est la sortie de ce code ?", options: ["7", "10", "25", "52"], correct: 2, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Puissance" },
        { id: 24, code: `for i in range(5):\n    if i == 2:\n        continue\n    print(i, end="")`, question: "Quelle est la sortie de ce code ?", options: ["01234", "0134", "234", "012"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 2 - continue" },
        { id: 25, code: `liste = [10, 20, 30]\nliste.insert(1, 15)\nprint(liste)`, question: "Quelle est la sortie de ce code ?", options: ["[15, 10, 20, 30]", "[10, 15, 20, 30]", "[10, 20, 15, 30]", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Méthode insert" },
        { id: 26, code: `x = 12\nif x > 5 and x < 15:\n    print("Vrai")\nelse:\n    print("Faux")`, question: "Quelle est la sortie de ce code ?", options: ["Vrai", "Faux", "True", "12"], correct: 0, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 2 - Opérateur and" },
        { id: 27, code: `texte = "ISI"\nprint(texte * 2)`, question: "Quelle est la sortie de ce code ?", options: ["ISI ISI", "ISIISI", "Erreur", "2ISI"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Répétition string" },
        { id: 28, code: `liste = [1, 2, 3]\nliste.reverse()\nprint(liste)`, question: "Quelle est la sortie de ce code ?", options: ["[1, 2, 3]", "[3, 2, 1]", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Méthode reverse" },
        { id: 29, code: `def calculer(a, b):\n    return a + b\nprint(calculer(5, 3))`, question: "Quelle est la sortie de ce code ?", options: ["53", "8", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 1 - Fonctions" },
        { id: 30, code: `x = 8\nresultat = "Pair" if x % 2 == 0 else "Impair"\nprint(resultat)`, question: "Quelle est la sortie de ce code ?", options: ["Pair", "Impair", "8", "True"], correct: 0, points: 1.5, difficulty: "Moyen", chapitre: "Chapitre 2 - Opérateur ternaire" },
        { id: 31, code: `liste = [1, 2, 3]\nliste.extend([4, 5])\nprint(len(liste))`, question: "Quelle est la sortie de ce code ?", options: ["3", "4", "5", "2"], correct: 2, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Méthode extend" },
        { id: 32, code: `x = "42"\ny = int(x) + 8\nprint(y)`, question: "Quelle est la sortie de ce code ?", options: ["428", "50", "Erreur", "42"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Conversion int" },
        { id: 33, code: `somme = 0\nfor i in range(1, 4):\n    somme += i\nprint(somme)`, question: "Quelle est la sortie de ce code ?", options: ["4", "6", "10", "0"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 2 - Boucle accumulateur" },
        { id: 34, code: `phrase = "a,b,c,d"\nelements = phrase.split(',')\nprint(len(elements))`, question: "Quelle est la sortie de ce code ?", options: ["1", "3", "4", "7"], correct: 2, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Split avec séparateur" },
        { id: 35, code: `x = 10\nwhile x > 5:\n    x -= 2\n    if x == 6:\n        break\nprint(x)`, question: "Quelle est la sortie de ce code ?", options: ["5", "6", "4", "8"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 2 - break" },
        { id: 36, code: `def test(n):\n    if n > 10:\n        return "Grand"\n    return "Petit"\nprint(test(5))`, question: "Quelle est la sortie de ce code ?", options: ["Grand", "Petit", "5", "None"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Return conditionnel" },
        { id: 37, code: `mots = ["bon", "jour"]\nphrase = " ".join(mots)\nprint(phrase)`, question: "Quelle est la sortie de ce code ?", options: ["bonjour", "bon jour", "['bon', 'jour']", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Méthode join" },
        { id: 38, code: `x = "Python"\ny = x.replace("th", "TH")\nprint(y)`, question: "Quelle est la sortie de ce code ?", options: ["Python", "PyTHon", "python", "PYTHON"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Méthode replace" },
        { id: 39, code: `liste = [5, 2, 8, 1, 9]\nprint(max(liste) - min(liste))`, question: "Quelle est la sortie de ce code ?", options: ["4", "7", "8", "10"], correct: 2, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Fonctions min/max" },
        { id: 40, code: `x = 3\ny = 5\nx, y = y, x\nprint(x, y)`, question: "Quelle est la sortie de ce code ?", options: ["3 5", "5 3", "8 8", "Erreur"], correct: 1, points: 1.75, difficulty: "Assez Difficile", chapitre: "Chapitre 1 - Swap de variables" },
        { id: 41, code: `texte = "Python"\nprint(texte[::-1])`, question: "Quelle est la sortie de ce code ?", options: ["Python", "nohtyP", "Pyth", "thon"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Slicing inverse" },
        { id: 42, code: `def factorielle(n):\n    if n <= 1:\n        return 1\n    return n * factorielle(n - 1)\nprint(factorielle(4))`, question: "Quelle est la sortie de ce code ?", options: ["4", "10", "24", "Erreur"], correct: 2, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Récursion" },
        { id: 43, code: `nombres = [1, 2, 3, 4, 5]\nresultat = [x * 2 for x in nombres if x % 2 == 0]\nprint(resultat)`, question: "Quelle est la sortie de ce code ?", options: ["[2, 4, 6, 8, 10]", "[4, 8]", "[2, 4]", "[1, 2, 3, 4, 5]"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - List comprehension" },
        { id: 44, code: `x = [1, 2, 3]\ny = x\ny.append(4)\nprint(len(x))`, question: "Quelle est la sortie ? (Attention au piège!)", options: ["3", "4", "7", "Erreur"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Référence vs copie" },
        { id: 45, code: `def fonction(a, b=5, c=10):\n    return a + b + c\nprint(fonction(2, c=3))`, question: "Quelle est la sortie de ce code ?", options: ["10", "15", "20", "Erreur"], correct: 0, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Arguments nommés" },
        { id: 46, code: `matrice = [[1, 2], [3, 4]]\nprint(matrice[1][0])`, question: "Quelle est la sortie de ce code ?", options: ["1", "2", "3", "4"], correct: 2, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Liste de listes" },
        { id: 47, code: `compteur = 0\nfor i in range(10):\n    if i % 3 == 0:\n        compteur += 1\nprint(compteur)`, question: "Quelle est la sortie de ce code ?", options: ["3", "4", "5", "10"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 2 - Compteur conditionnel" },
        { id: 48, code: `def modifier(liste):\n    liste.append(100)\n\nma_liste = [1, 2, 3]\nmodifier(ma_liste)\nprint(len(ma_liste))`, question: "Quelle est la sortie de ce code ?", options: ["3", "4", "100", "Erreur"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "Chapitre 1 - Passage par référence" },
        { id: 49, code: `nombres = [3, 1, 4, 1, 5, 9, 2]\nprint(sum(nombres) / len(nombres))`, question: "Quelle est la sortie de ce code (arrondie) ?", options: ["3.5", "3.57", "4.0", "25"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "TP1 - Moyenne" },
        { id: 50, code: `liste = [5, 2, 8, 1, 9]\nliste_triee = sorted(liste)\nprint(liste_triee[len(liste_triee)//2])`, question: "Quelle est la sortie de ce code (médiane) ?", options: ["2", "5", "8", "9"], correct: 1, points: 2, difficulty: "Très Difficile", chapitre: "TP1 - Médiane" }
      ]
    };

    function AdminDashboard() {
      const [isAuthenticated, setIsAuthenticated] = useState(() => {
        return localStorage.getItem('adminAuthenticated') === 'true';
      });
      const [loginInput, setLoginInput] = useState('');
      const [passwordInput, setPasswordInput] = useState('');
      const [results, setResults] = useState([]);
      const [activeSessions, setActiveSessions] = useState([]);
      const [selectedStudent, setSelectedStudent] = useState(null);
      const [filter, setFilter] = useState('all');
      const [classFilter, setClassFilter] = useState('all');
      const [loading, setLoading] = useState(false);
      const [showSessions, setShowSessions] = useState(false);
      const [showDetailedAnswers, setShowDetailedAnswers] = useState(false);

      useEffect(() => {
        if (isAuthenticated) {
          const resultsRef = database.ref('resultats');
          resultsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const resultsArray = Object.keys(data).map(key => ({
                id: key,
                ...data[key]
              }));
              setResults(resultsArray);
            }
          });

          const sessionsRef = database.ref('sessions');
          sessionsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const sessionsArray = Object.keys(data).map(key => ({
                id: key,
                ...data[key]
              }));
              setActiveSessions(sessionsArray.filter(s => s.statut === 'en_cours'));
            }
          });

          return () => {
            resultsRef.off();
            sessionsRef.off();
          };
        }
      }, [isAuthenticated]);

      const handleLogin = () => {
        if (loginInput === ADMIN_CREDENTIALS.login && passwordInput === ADMIN_CREDENTIALS.password) {
          setIsAuthenticated(true);
          localStorage.setItem('adminAuthenticated', 'true');
          setLoginInput('');
          setPasswordInput('');
        } else {
          alert('Identifiant ou mot de passe incorrect !');
        }
      };

      const handleLogout = () => {
        setIsAuthenticated(false);
        localStorage.removeItem('adminAuthenticated');
      };

      const deleteResult = (id) => {
        if (confirm('Êtes-vous sûr de vouloir supprimer ce résultat ?')) {
          database.ref(`resultats/${id}`).remove();
        }
      };

      const exportToCSV = () => {
        const headers = ['Nom', 'Prénom', 'Classe', 'Score', 'Score Max', 'Pourcentage', 'Date'];
        const rows = filteredResults.map(r => [
          r.nom, r.prenom, r.classe, r.score, r.scoreMax, r.pourcentage + '%',
          new Date(r.dateFin).toLocaleString('fr-FR')
        ]);
        
        let csv = headers.join(',') + '\n';
        rows.forEach(row => {
          csv += row.join(',') + '\n';
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `resultats_quiz_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };

      const filteredResults = results.filter(r => {
        if (classFilter !== 'all' && r.classe !== classFilter) return false;
        if (filter === 'passed' && parseFloat(r.pourcentage) < 50) return false;
        if (filter === 'failed' && parseFloat(r.pourcentage) >= 50) return false;
        return true;
      });

      const stats = {
        total: results.length,
        average: results.length > 0 ? (results.reduce((sum, r) => sum + parseFloat(r.pourcentage), 0) / results.length).toFixed(2) : 0,
        passed: results.filter(r => parseFloat(r.pourcentage) >= 50).length,
        failed: results.filter(r => parseFloat(r.pourcentage) < 50).length
      };

      if (!isAuthenticated) {
        return (
          <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
              <div className="text-center mb-8">
                <div className="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i className="fas fa-shield-alt text-white text-3xl"></i>
                </div>
                <h1 className="text-3xl font-bold text-gray-800 mb-2">Administration</h1>
                <p className="text-gray-600">Quiz Python - ISI</p>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    <i className="fas fa-user mr-2"></i>Identifiant
                  </label>
                  <input
                    type="text"
                    value={loginInput}
                    onChange={(e) => setLoginInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    placeholder="Entrez votre identifiant"
                  />
                </div>

                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    <i className="fas fa-lock mr-2"></i>Mot de passe
                  </label>
                  <input
                    type="password"
                    value={passwordInput}
                    onChange={(e) => setPasswordInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    placeholder="Entrez votre mot de passe"
                  />
                </div>

                <button
                  onClick={handleLogin}
                  className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition"
                >
                  <i className="fas fa-sign-in-alt mr-2"></i>
                  Se connecter
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 p-4 md:p-8">
          {/* Header */}
          <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
                  <i className="fas fa-user-shield text-white text-2xl"></i>
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">Tableau de Bord Admin</h1>
                  <p className="text-gray-600">Quiz Python - ISI Keur Massar</p>
                </div>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={() => setShowSessions(!showSessions)}
                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2"
                >
                  <i className="fas fa-users"></i>
                  Sessions ({activeSessions.length})
                </button>
                <button
                  onClick={handleLogout}
                  className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                >
                  <i className="fas fa-sign-out-alt mr-2"></i>
                  Déconnexion
                </button>
              </div>
            </div>
          </div>

          {/* Statistiques */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div className="bg-white p-6 rounded-xl shadow-lg">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-gray-600 text-sm">Total</p>
                  <p className="text-3xl font-bold text-blue-600">{stats.total}</p>
                </div>
                <i className="fas fa-users text-blue-600 text-3xl"></i>
              </div>
            </div>
            <div className="bg-white p-6 rounded-xl shadow-lg">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-gray-600 text-sm">Moyenne</p>
                  <p className="text-3xl font-bold text-purple-600">{stats.average}%</p>
                </div>
                <i className="fas fa-chart-line text-purple-600 text-3xl"></i>
              </div>
            </div>
            <div className="bg-white p-6 rounded-xl shadow-lg">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-gray-600 text-sm">Réussis</p>
                  <p className="text-3xl font-bold text-green-600">{stats.passed}</p>
                </div>
                <i className="fas fa-check-circle text-green-600 text-3xl"></i>
              </div>
            </div>
            <div className="bg-white p-6 rounded-xl shadow-lg">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-gray-600 text-sm">Échoués</p>
                  <p className="text-3xl font-bold text-red-600">{stats.failed}</p>
                </div>
                <i className="fas fa-times-circle text-red-600 text-3xl"></i>
              </div>
            </div>
          </div>

          {/* Filtres et Export */}
          <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div className="flex flex-col md:flex-row gap-4 items-center">
              <div className="flex-1">
                <label className="block text-sm font-semibold text-gray-700 mb-2">Classe</label>
                <select
                  value={classFilter}
                  onChange={(e) => setClassFilter(e.target.value)}
                  className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                >
                  <option value="all">Toutes les classes</option>
                  <option value="L2 GL">L2 GL</option>
                  <option value="L2 IAGE">L2 IAGE</option>
                  <option value="L2 SR">L2 RI</option>
                  <option value="L2 IA">L2 CS</option>
                </select>
              </div>
              <div className="flex-1">
                <label className="block text-sm font-semibold text-gray-700 mb-2">Statut</label>
                <select
                  value={filter}
                  onChange={(e) => setFilter(e.target.value)}
                  className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                >
                  <option value="all">Tous</option>
                  <option value="passed">Réussis (≥50%)</option>
                  <option value="failed">Échoués (&lt;50%)</option>
                </select>
              </div>
              <div className="flex-1 flex items-end">
                <button
                  onClick={exportToCSV}
                  className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2"
                >
                  <i className="fas fa-file-csv"></i>
                  Exporter CSV
                </button>
              </div>
            </div>
          </div>

          {/* Liste des résultats */}
          <div className="bg-white rounded-xl shadow-lg overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                  <tr>
                    <th className="px-4 py-3 text-left">Étudiant</th>
                    <th className="px-4 py-3 text-left">Classe</th>
                    <th className="px-4 py-3 text-center">Score</th>
                    <th className="px-4 py-3 text-center">%</th>
                    <th className="px-4 py-3 text-left">Date</th>
                    <th className="px-4 py-3 text-center">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredResults.map((result, index) => (
                    <tr key={result.id} className={`border-b ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} hover:bg-blue-50 transition`}>
                      <td className="px-4 py-3 font-semibold">{result.prenom} {result.nom}</td>
                      <td className="px-4 py-3">{result.classe}</td>
                      <td className="px-4 py-3 text-center font-bold">{result.score.toFixed(2)} / {result.scoreMax}</td>
                      <td className="px-4 py-3 text-center">
                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                          parseFloat(result.pourcentage) >= 50 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                        }`}>
                          {result.pourcentage}%
                        </span>
                      </td>
                      <td className="px-4 py-3 text-sm">{new Date(result.dateFin).toLocaleString('fr-FR')}</td>
                      <td className="px-4 py-3">
                        <div className="flex gap-2 justify-center">
                          <button
                            onClick={() => {setSelectedStudent(result); setShowDetailedAnswers(false);}}
                            className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition text-sm"
                          >
                            <i className="fas fa-eye"></i>
                          </button>
                          <button
                            onClick={() => deleteResult(result.id)}
                            className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition text-sm"
                          >
                            <i className="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Modal Détails */}
          {selectedStudent && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={() => {setSelectedStudent(null); setShowDetailedAnswers(false);}}>
              <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6" onClick={(e) => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">Détails de l'étudiant</h2>
                  <button onClick={() => {setSelectedStudent(null); setShowDetailedAnswers(false);}} className="text-gray-400 hover:text-gray-600">
                    <i className="fas fa-times text-2xl"></i>
                  </button>
                </div>

                <div className="grid md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Nom complet</p>
                    <p className="text-xl font-bold text-gray-800">{selectedStudent.prenom} {selectedStudent.nom}</p>
                  </div>
                  <div className="bg-purple-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Classe</p>
                    <p className="text-xl font-bold text-gray-800">{selectedStudent.classe}</p>
                  </div>
                  <div className="bg-green-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Score</p>
                    <p className="text-xl font-bold text-gray-800">{selectedStudent.score.toFixed(2)} / {selectedStudent.scoreMax}</p>
                  </div>
                  <div className="bg-yellow-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Pourcentage</p>
                    <p className="text-xl font-bold text-gray-800">{selectedStudent.pourcentage}%</p>
                  </div>
                </div>

                <div className="flex flex-col sm:flex-row gap-3 mb-6">
                  <button onClick={() => setShowDetailedAnswers(!showDetailedAnswers)} className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    <i className={`fas fa-eye${showDetailedAnswers ? '-slash' : ''}`}></i>
                    {showDetailedAnswers ? 'Masquer' : 'Voir'} les détails
                  </button>
                  <button onClick={() => {setSelectedStudent(null); setShowDetailedAnswers(false);}} className="px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                    Fermer
                  </button>
                </div>

                {/* Détails des réponses */}
                {showDetailedAnswers && selectedStudent.detailsReponses && (
                  <div className="space-y-4">
                    {/* Réponses correctes */}
                    {(() => {
                      const correctQuestions = selectedStudent.detailsReponses.filter(d => d.estCorrecte);
                      if (correctQuestions.length === 0) return null;
                      return (
                        <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                          <h3 className="text-lg font-bold text-green-600 mb-4 flex items-center gap-2">
                            <i className="fas fa-check-circle"></i>
                            Réponses Correctes ({correctQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {correctQuestions.map((detail) => {
                              const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                              if (!q) return null;
                              return (
                                <div key={detail.question} className="bg-white border-l-4 border-green-500 p-3 rounded">
                                  <div className="flex justify-between items-start mb-2">
                                    <p className="font-semibold text-gray-800 text-sm">Question {q.id}</p>
                                    <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">{q.points} pts</span>
                                  </div>
                                  <p className="text-xs text-gray-700 mb-2">{q.question}</p>
                                  <div className="code-block mb-2">
                                    <pre>{q.code}</pre>
                                  </div>
                                  <div className="flex items-center gap-2 text-green-700 text-sm">
                                    <i className="fas fa-check"></i>
                                    <span className="font-semibold">{q.options[q.correct]}</span>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })()}

                    {/* Réponses incorrectes */}
                    {(() => {
                      const incorrectQuestions = selectedStudent.detailsReponses.filter(d => !d.estCorrecte && d.reponse !== -1);
                      if (incorrectQuestions.length === 0) return null;
                      return (
                        <div className="bg-red-50 rounded-lg p-4 border-2 border-red-200">
                          <h3 className="text-lg font-bold text-red-600 mb-4 flex items-center gap-2">
                            <i className="fas fa-times-circle"></i>
                            Réponses Incorrectes ({incorrectQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {incorrectQuestions.map((detail) => {
                              const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                              if (!q) return null;
                              return (
                                <div key={detail.question} className="bg-white border-l-4 border-red-500 p-3 rounded">
                                  <div className="flex justify-between items-start mb-2">
                                    <p className="font-semibold text-gray-800 text-sm">Question {q.id}</p>
                                    <span className="text-xs bg-red-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                  </div>
                                  <p className="text-xs text-gray-700 mb-2">{q.question}</p>
                                  <div className="code-block mb-2">
                                    <pre>{q.code}</pre>
                                  </div>
                                  <div className="space-y-2">
                                    <div className="flex items-center gap-2 text-red-700 text-sm">
                                      <i className="fas fa-times"></i>
                                      <div>
                                        <span className="font-semibold">Réponse donnée : </span>
                                        <span>{q.options[detail.reponse]}</span>
                                      </div>
                                    </div>
                                    <div className="flex items-center gap-2 text-green-700 text-sm">
                                      <i className="fas fa-check"></i>
                                      <div>
                                        <span className="font-semibold">Bonne réponse : </span>
                                        <span>{q.options[q.correct]}</span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })()}

                    {/* Questions non répondues */}
                    {(() => {
                      const unansweredQuestions = selectedStudent.detailsReponses.filter(d => d.reponse === -1);
                      if (unansweredQuestions.length === 0) return null;
                      return (
                        <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-300">
                          <h3 className="text-lg font-bold text-gray-600 mb-4 flex items-center gap-2">
                            <i className="fas fa-question-circle"></i>
                            Questions Non Répondues ({unansweredQuestions.length})
                          </h3>
                          <div className="space-y-3">
                            {unansweredQuestions.map((detail) => {
                              const q = QUIZ_CONFIG.questions.find(question => question.id === detail.question);
                              if (!q) return null;
                              return (
                                <div key={detail.question} className="bg-white border-l-4 border-gray-400 p-3 rounded">
                                  <div className="flex justify-between items-start mb-2">
                                    <p className="font-semibold text-gray-800 text-sm">Question {q.id}</p>
                                    <span className="text-xs bg-gray-600 text-white px-2 py-1 rounded">0 / {q.points} pts</span>
                                  </div>
                                  <p className="text-xs text-gray-700 mb-2">{q.question}</p>
                                  <div className="code-block mb-2">
                                    <pre>{q.code}</pre>
                                  </div>
                                  <div className="flex items-center gap-2 text-green-700 text-sm">
                                    <i className="fas fa-check"></i>
                                    <div>
                                      <span className="font-semibold">Bonne réponse : </span>
                                      <span>{q.options[q.correct]}</span>
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })()}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Sessions actives */}
          {showSessions && activeSessions.length > 0 && (
            <div className="fixed bottom-4 right-4 bg-white rounded-xl shadow-2xl p-6 max-w-md">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                  <i className="fas fa-circle text-green-500 animate-pulse"></i>
                  Sessions Actives
                </h3>
                <button onClick={() => setShowSessions(false)} className="text-gray-400 hover:text-gray-600">
                  <i className="fas fa-times"></i>
                </button>
              </div>
              <div className="space-y-2">
                {activeSessions.map(session => (
                  <div key={session.id} className="bg-green-50 p-3 rounded-lg border border-green-200">
                    <p className="font-semibold text-gray-800">{session.prenom} {session.nom}</p>
                    <p className="text-sm text-gray-600">{session.classe}</p>
                    <p className="text-xs text-gray-500">Début: {new Date(session.dateDebut).toLocaleTimeString('fr-FR')}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<AdminDashboard />, document.getElementById('root'));
  </script>
</body>
</html>

